{"config":{"lang":["en"],"separator":"[\\s\\-,:!=\\[\\]()\"/]+|(?!\\b)(?=[A-Z][a-z])|\\.(?!\\d)|&[lg]t;","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"elastic-script","text":"<ul> <li> <p> Procedural Power</p> <p>Write complex logic with variables, loops, conditionals, and error handling - all inside Elasticsearch.</p> <p> Getting Started</p> </li> <li> <p> Native ES|QL Integration</p> <p>Query your data with ES|QL and process results with cursors and loops.</p> <p> Elasticsearch Functions</p> </li> <li> <p> AI &amp; LLM Built-in</p> <p>Summarize logs, classify events, and generate insights with OpenAI or Elasticsearch Inference.</p> <p> AI Functions</p> </li> <li> <p> Async Execution</p> <p>Chain procedures with <code>ON_DONE</code>, <code>ON_FAIL</code>, and run tasks in parallel.</p> <p> Async Guide</p> </li> </ul>"},{"location":"#what-is-elastic-script","title":"What is elastic-script?","text":"<p>elastic-script is a procedural scripting language that runs inside Elasticsearch. It's designed for:</p> <ul> <li>Runbook Automation - Codify operational procedures that respond to alerts</li> <li>Data Processing - Transform and enrich data with complex logic</li> <li>AI/ML Integration - Leverage LLMs for log analysis and anomaly detection</li> <li>Cross-System Orchestration - Connect to Slack, PagerDuty, AWS, Kubernetes, and more</li> </ul>"},{"location":"#quick-example","title":"Quick Example","text":"<pre><code>CREATE PROCEDURE analyze_errors()\nBEGIN\n    -- Query recent errors\n    DECLARE errors CURSOR FOR\n        FROM logs-*\n        | WHERE level == \"ERROR\"\n        | WHERE @timestamp &gt; NOW() - 1 HOUR\n        | LIMIT 100;\n\n    -- Count and summarize\n    DECLARE error_count NUMBER = 0;\n    DECLARE messages STRING = '';\n\n    FOR error IN errors LOOP\n        SET error_count = error_count + 1;\n        SET messages = messages || error.message || '\\n';\n    END LOOP;\n\n    -- Use AI to summarize if many errors\n    IF error_count &gt; 10 THEN\n        DECLARE summary STRING = LLM_SUMMARIZE(messages);\n        PRINT 'Error Summary: ' || summary;\n    END IF;\n\n    RETURN error_count;\nEND PROCEDURE;\n</code></pre>"},{"location":"#key-features","title":"Key Features","text":""},{"location":"#106-built-in-functions","title":"\ud83d\udd27 106 Built-in Functions","text":"Category Functions String <code>LENGTH</code>, <code>SUBSTR</code>, <code>UPPER</code>, <code>LOWER</code>, <code>TRIM</code>, <code>REPLACE</code>, <code>REGEXP_REPLACE</code>... Array <code>ARRAY_LENGTH</code>, <code>ARRAY_APPEND</code>, <code>ARRAY_FILTER</code>, <code>ARRAY_MAP</code>, <code>ARRAY_REDUCE</code>... Elasticsearch <code>ESQL_QUERY</code>, <code>INDEX_DOCUMENT</code>, <code>GET_DOCUMENT</code>, <code>REFRESH_INDEX</code>... AI/LLM <code>LLM_COMPLETE</code>, <code>LLM_SUMMARIZE</code>, <code>LLM_CLASSIFY</code>, <code>INFERENCE</code>... Integrations <code>SLACK_SEND</code>, <code>PAGERDUTY_TRIGGER</code>, <code>K8S_SCALE</code>, <code>AWS_LAMBDA_INVOKE</code>..."},{"location":"#async-execution","title":"\u26a1 Async Execution","text":"<pre><code>-- Chain procedures with continuations\nanalyze_logs()\n    | ON_DONE notify_team(@result)\n    | ON_FAIL alert_oncall(@error)\n    | TRACK AS 'daily-analysis';\n\n-- Run in parallel\nPARALLEL [fetch_logs(), fetch_metrics()]\n    | ON_ALL_DONE merge_results(@results);\n</code></pre>"},{"location":"#full-observability","title":"\ud83d\udd0d Full Observability","text":"<ul> <li>Structured logging with execution IDs</li> <li>Elastic APM tracing (optional)</li> <li>Execution state persisted in <code>.escript_executions</code></li> </ul>"},{"location":"#installation","title":"Installation","text":"Quick StartManual Setup <pre><code>git clone https://github.com/bahaaldine/elastic-script.git\ncd elastic-script\n./scripts/quick-start.sh\n</code></pre> <pre><code># Build the plugin\ncd elasticsearch\n./gradlew :x-pack:plugin:elastic-script:assemble\n\n# Install in your ES cluster\nbin/elasticsearch-plugin install file:///path/to/elastic-script.zip\n</code></pre>"},{"location":"#try-it-now","title":"Try It Now","text":"<p>Once running, create and call procedures:</p> <pre><code># Create a procedure\ncurl -u elastic-admin:elastic-password http://localhost:9200/_escript \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"query\": \"CREATE PROCEDURE hello() BEGIN RETURN '\\''Hello, World!'\\''; END PROCEDURE;\"}'\n\n# Call it\ncurl -u elastic-admin:elastic-password http://localhost:9200/_escript \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"query\": \"CALL hello()\"}'\n\n# Response: {\"result\": \"Hello, World!\"}\n</code></pre> <p>Or use the Jupyter notebook interface for interactive development!</p> <ul> <li> <p> Read the Docs</p> <p> Language Guide</p> </li> <li> <p> Function Reference</p> <p> All 106 Functions</p> </li> <li> <p> Examples</p> <p> Real-world Use Cases</p> </li> </ul>"},{"location":"roadmap/","title":"Roadmap","text":"<p>Current status and future direction for elastic-script \u2014 a procedural language for Elasticsearch inspired by Oracle PL/SQL.</p>"},{"location":"roadmap/#completed-features-v10","title":"\u2705 Completed Features (v1.0)","text":""},{"location":"roadmap/#core-language","title":"Core Language","text":"<ul> <li> Procedure Creation - <code>CREATE PROCEDURE ... END PROCEDURE</code></li> <li> Variable System - <code>DECLARE</code>, <code>VAR</code>, <code>CONST</code> with type inference</li> <li> Control Flow - IF/THEN/ELSEIF/ELSE, FOR loops, WHILE loops</li> <li> Data Types - STRING, NUMBER, BOOLEAN, ARRAY, DOCUMENT, DATE</li> <li> Functions with Parameters - IN/OUT/INOUT parameter modes</li> </ul>"},{"location":"roadmap/#built-in-functions-106-total","title":"Built-in Functions (106 total)","text":"<ul> <li> String Functions (18) - LENGTH, SUBSTR, REPLACE, REGEXP_*, etc.</li> <li> Number Functions (11) - ABS, ROUND, SQRT, LOG, etc.</li> <li> Array Functions (18) - ARRAY_LENGTH, APPEND, FILTER, MAP, etc.</li> <li> Date Functions (8) - CURRENT_DATE, DATE_ADD, EXTRACT_*, etc.</li> <li> Document Functions (6) - DOCUMENT_GET, KEYS, VALUES, MERGE, etc.</li> <li> Elasticsearch Functions (5) - ESQL_QUERY, ES_GET, ES_INDEX, etc.</li> <li> AI/LLM Functions (6) - LLM_COMPLETE, LLM_SUMMARIZE, ES_INFERENCE</li> <li> Integration Functions (~30) - Slack, PagerDuty, K8s, AWS, HTTP</li> </ul>"},{"location":"roadmap/#async-execution-model","title":"Async Execution Model","text":"<ul> <li> Pipe-Driven Syntax - <code>procedure() | ON_DONE handler(@result)</code></li> <li> Error Continuations - <code>ON_FAIL</code>, <code>FINALLY</code> handlers</li> <li> Parallel Execution - <code>PARALLEL [proc1(), proc2()] | ON_ALL_DONE</code></li> <li> Execution Control - <code>EXECUTION('name') | STATUS/CANCEL/RETRY</code></li> <li> State Persistence - Execution state stored in <code>.escript_executions</code></li> </ul>"},{"location":"roadmap/#first-class-commands-new","title":"First-Class Commands (NEW)","text":"<ul> <li> INDEX Command - <code>INDEX document INTO 'index-name';</code></li> <li> DELETE Command - <code>DELETE FROM 'index-name' WHERE id;</code></li> <li> SEARCH Command - <code>SEARCH 'index-name' QUERY {...};</code></li> <li> REFRESH Command - <code>REFRESH 'index-name';</code></li> <li> CREATE INDEX Command - <code>CREATE INDEX 'name' WITH MAPPINGS {...};</code></li> </ul>"},{"location":"roadmap/#type-aware-esql-binding-new","title":"Type-Aware ES|QL Binding (NEW)","text":"<ul> <li> ARRAY Binding - <code>DECLARE errors ARRAY FROM FROM logs-* | WHERE level = 'ERROR';</code></li> <li> DOCUMENT Binding - <code>DECLARE user DOCUMENT FROM FROM users | WHERE id = 'john' | LIMIT 1;</code></li> <li> NUMBER Binding - <code>DECLARE count NUMBER FROM FROM logs-* | STATS count = COUNT(*);</code></li> <li> STRING Binding - <code>DECLARE name STRING FROM FROM config | KEEP value | LIMIT 1;</code></li> <li> DATE Binding - <code>DECLARE last_login DATE FROM FROM users | KEEP login_time | LIMIT 1;</code></li> <li> BOOLEAN Binding - <code>DECLARE has_errors BOOLEAN FROM FROM logs | STATS has = COUNT(*) &gt; 0;</code></li> </ul>"},{"location":"roadmap/#type-namespaced-functions-new","title":"Type-Namespaced Functions (NEW)","text":"<ul> <li> Namespaced Syntax - <code>NAMESPACE.METHOD()</code> for organized function calls</li> <li> Type Namespaces - <code>ARRAY.MAP()</code>, <code>STRING.UPPER()</code>, <code>DOCUMENT.KEYS()</code>, <code>DATE.ADD()</code></li> <li> Extension Namespaces - <code>K8S.GET_PODS()</code>, <code>AWS.S3_GET()</code>, <code>HTTP.GET()</code></li> <li> Keyword Support - Type keywords (ARRAY, STRING, etc.) work as namespace identifiers</li> </ul>"},{"location":"roadmap/#developer-experience","title":"Developer Experience","text":"<ul> <li> Quick Start Script - <code>./scripts/quick-start.sh</code> for one-command setup</li> <li> Jupyter Integration - Custom kernel for interactive development</li> <li> Sample Notebooks - 7 comprehensive tutorial notebooks + first-class commands demo</li> <li> E2E Test Framework - Automated notebook execution with HTML reports</li> <li> GitHub Pages Documentation - Full documentation site</li> </ul>"},{"location":"roadmap/#feature-gap-analysis-plsql-comparison","title":"\ud83d\udcca Feature Gap Analysis (PL/SQL Comparison)","text":"<p>The table below compares elastic-script to Oracle PL/SQL and identifies missing features:</p> Category Feature PL/SQL elastic-script Priority Error Handling TRY/CATCH blocks \u2705 \u274c \ud83d\udd34 P0 Named exceptions \u2705 \u274c \ud83d\udfe1 P1 RAISE/THROW \u2705 \u274c \ud83d\udd34 P0 Functions User-defined functions \u2705 \u274c \ud83d\udd34 P0 Function overloading \u2705 \u274c \ud83d\udfe2 P2 Recursive functions \u2705 \u2753 \ud83d\udfe1 P1 Cursors Explicit cursors \u2705 \u274c \ud83d\udd34 P0 FETCH INTO \u2705 \u274c \ud83d\udd34 P0 BULK COLLECT \u2705 \u274c \ud83d\udd34 P0 Modules Packages \u2705 \u274c \ud83d\udfe1 P1 Package state \u2705 \u274c \ud83d\udfe1 P1 Public/Private \u2705 \u274c \ud83d\udfe1 P1 Events Triggers \u2705 \u274c \ud83d\udd34 P0 Scheduled jobs \u2705 \u274c \ud83d\udd34 P0 Collections Associative arrays \u2705 \u274c \ud83d\udd34 P0 User-defined types \u2705 \u274c \ud83d\udfe1 P1 Dynamic EXECUTE IMMEDIATE \u2705 \u274c \ud83d\udd34 P0 Bind variables \u2705 \u274c \ud83d\udd34 P0 Bulk Ops FORALL \u2705 \u274c \ud83d\udd34 P0 SAVE EXCEPTIONS \u2705 \u274c \ud83d\udfe1 P1 Security GRANT/REVOKE \u2705 \u274c \ud83d\udfe1 P1 AUTHID \u2705 \u274c \ud83d\udfe1 P1 Debug Profiler \u2705 \u274c \ud83d\udfe1 P1 Breakpoints \u2705 \u274c \ud83d\udfe2 P2"},{"location":"roadmap/#phase-1-core-language-completeness-q1-q2-2026","title":"\ud83d\udea7 Phase 1: Core Language Completeness (Q1-Q2 2026)","text":""},{"location":"roadmap/#11-exception-handling-trycatch","title":"1.1 Exception Handling (TRY/CATCH)","text":"<p>Status: \ud83d\udd34 Not Started | Priority: P0</p> <p>Full exception handling with named exceptions and propagation.</p> <pre><code>TRY\n    SET result = HTTP_GET('https://api.example.com/data')\n    SET parsed = JSON_PARSE(result)\nCATCH http_error\n    PRINT 'HTTP call failed: ' || @error.message\n    CALL log_error(@error)\nCATCH parse_error\n    PRINT 'JSON parsing failed'\n    SET parsed = {}\nFINALLY\n    -- Always runs (cleanup)\n    CALL close_connections()\nEND TRY\n</code></pre> <p>Key Features:</p> <ul> <li>Named exception types (<code>http_error</code>, <code>division_error</code>, <code>timeout_error</code>)</li> <li><code>@error</code> binding with <code>message</code>, <code>code</code>, <code>stack_trace</code></li> <li><code>RAISE</code> statement to throw custom exceptions</li> <li>Exception propagation through procedure calls</li> <li><code>FINALLY</code> block for cleanup (always runs)</li> </ul>"},{"location":"roadmap/#12-user-defined-functions-create-function","title":"1.2 User-Defined Functions (CREATE FUNCTION)","text":"<p>Status: \ud83d\udd34 Not Started | Priority: P0</p> <p>Distinguish functions (return values) from procedures (side effects).</p> <pre><code>-- Define a function that returns a value\nCREATE FUNCTION calculate_severity(error_count NUMBER, warn_count NUMBER) \nRETURNS STRING AS\nBEGIN\n    DECLARE score NUMBER = error_count * 10 + warn_count\n\n    IF score &gt; 100 THEN\n        RETURN 'critical'\n    ELSIF score &gt; 50 THEN\n        RETURN 'high'\n    ELSIF score &gt; 20 THEN\n        RETURN 'medium'\n    ELSE\n        RETURN 'low'\n    END IF\nEND FUNCTION\n\n-- Usage: Functions can be used in expressions\nSET severity = calculate_severity(errors, warnings)\nSET message = 'Status: ' || calculate_severity(5, 10)\n</code></pre> <p>Key Differences from Procedures:</p> Aspect PROCEDURE FUNCTION Returns value No (OUT params only) Yes (RETURN statement) Use in expressions No Yes Side effects Expected Discouraged Call syntax <code>CALL proc()</code> <code>func()</code> in expressions"},{"location":"roadmap/#13-dynamic-esql-execute-immediate","title":"1.3 Dynamic ES|QL (EXECUTE IMMEDIATE)","text":"<p>Status: \ud83d\udd34 Not Started | Priority: P0</p> <p>Build and execute queries dynamically at runtime.</p> <pre><code>-- Build query dynamically based on conditions\nDECLARE query STRING = 'FROM logs-*'\n\nIF severity_filter IS NOT NULL THEN\n    SET query = query || ' | WHERE level = ''' || severity_filter || ''''\nEND IF\n\nIF service_filter IS NOT NULL THEN\n    SET query = query || ' | WHERE service = ''' || service_filter || ''''\nEND IF\n\nSET query = query || ' | LIMIT ' || max_results\n\n-- Execute the dynamic query\nEXECUTE IMMEDIATE query INTO results\n\n-- With bind variables (SQL injection safe)\nEXECUTE IMMEDIATE \n    'FROM logs-* | WHERE service = :svc AND level = :lvl | LIMIT :lim'\n    USING service_name, 'ERROR', 100\n    INTO results\n</code></pre> <p>Safety Features:</p> <ul> <li>Bind variables prevent injection attacks</li> <li>Query validation before execution</li> <li>Clear error messages for syntax errors</li> </ul>"},{"location":"roadmap/#14-associative-arrays-map-type","title":"1.4 Associative Arrays (MAP Type)","text":"<p>Status: \ud83d\udd34 Not Started | Priority: P0</p> <p>Key-value data structures for counting, grouping, and caching.</p> <pre><code>-- Declare a map\nDECLARE error_counts MAP&lt;STRING, NUMBER&gt; = {}\nDECLARE cache MAP&lt;STRING, DOCUMENT&gt; = {}\n\n-- Add/update entries\nSET error_counts['api-service'] = 42\nSET error_counts['db-service'] = (error_counts['db-service'] ?? 0) + 1\n\n-- Check existence\nIF error_counts.CONTAINS('api-service') THEN\n    PRINT 'API has ' || error_counts['api-service'] || ' errors'\nEND IF\n\n-- Iterate over map\nFOR service, count IN error_counts LOOP\n    IF count &gt; 10 THEN\n        CALL alert_team(service, count)\n    END IF\nEND LOOP\n\n-- Map methods\nPRINT 'Services with errors: ' || error_counts.KEYS()\nPRINT 'Total errors: ' || ARRAY_SUM(error_counts.VALUES())\n</code></pre>"},{"location":"roadmap/#phase-2-scale-performance-q2-q3-2026","title":"\ud83d\udea7 Phase 2: Scale &amp; Performance (Q2-Q3 2026)","text":""},{"location":"roadmap/#21-cursor-management-streaming","title":"2.1 Cursor Management &amp; Streaming","text":"<p>Status: \ud83d\udd34 Not Started | Priority: P0</p> <p>Handle large result sets without memory exhaustion.</p> <pre><code>-- Explicit cursor for large datasets\nDECLARE CURSOR log_cursor FOR \n    FROM logs-* \n    | WHERE @timestamp &gt; NOW() - 1 HOUR \n    | LIMIT 100000\n\nOPEN log_cursor\n\n-- Process in batches\nDECLARE batch ARRAY&lt;DOCUMENT&gt;\nDECLARE processed NUMBER = 0\n\nWHILE FETCH log_cursor LIMIT 1000 INTO batch LOOP\n    -- Process batch\n    FOR doc IN batch LOOP\n        CALL process_log(doc)\n    END LOOP\n\n    SET processed = processed + ARRAY_LENGTH(batch)\n    PRINT 'Processed: ' || processed || ' documents'\n\n    -- Optional: yield control for long-running operations\n    IF processed % 10000 = 0 THEN\n        COMMIT WORK  -- Checkpoint progress\n    END IF\nEND LOOP\n\nCLOSE log_cursor\n</code></pre> <p>Cursor Features:</p> Feature Description <code>OPEN cursor</code> Initialize and execute query <code>FETCH cursor INTO var</code> Get next row <code>FETCH cursor LIMIT n INTO arr</code> Get next n rows as array <code>CLOSE cursor</code> Release resources <code>cursor%ROWCOUNT</code> Number of rows fetched <code>cursor%NOTFOUND</code> True when no more rows"},{"location":"roadmap/#22-bulk-operations-forall","title":"2.2 Bulk Operations (FORALL)","text":"<p>Status: \ud83d\udd34 Not Started | Priority: P0</p> <p>Efficient batch processing with error handling.</p> <pre><code>-- Bulk collect from query\nDECLARE logs ARRAY&lt;DOCUMENT&gt;\nBULK COLLECT INTO logs\n    FROM logs-*\n    | WHERE level = 'ERROR'\n    | LIMIT 5000\n\n-- Bulk process with FORALL\nFORALL log IN logs\n    CALL process_and_archive(log)\n    SAVE EXCEPTIONS  -- Continue on individual failures\n\n-- Check for errors\nIF @bulk_errors.COUNT &gt; 0 THEN\n    PRINT @bulk_errors.COUNT || ' documents failed processing'\n    FOR err IN @bulk_errors LOOP\n        PRINT 'Index ' || err.index || ': ' || err.message\n    END LOOP\nEND IF\n\n-- Bulk index with retry\nFORALL doc IN transformed_docs\n    INDEX_DOCUMENT('output-index', doc)\n    ON_FAIL RETRY 3 THEN SKIP\n</code></pre>"},{"location":"roadmap/#23-scheduled-jobs-create-job","title":"2.3 Scheduled Jobs (CREATE JOB)","text":"<p>Status: \ud83d\udd34 Not Started | Priority: P0</p> <p>Built-in job scheduling with cron syntax.</p> <pre><code>-- Create a recurring job\nCREATE JOB daily_log_cleanup\nSCHEDULE '0 2 * * *'  -- 2 AM daily (cron syntax)\nTIMEZONE 'UTC'\nENABLED true\nAS\nBEGIN\n    PRINT 'Starting daily cleanup at ' || CURRENT_TIMESTAMP\n\n    -- Archive logs older than 30 days\n    CALL archive_old_logs(30)\n\n    -- Clean up temporary indices\n    CALL cleanup_temp_indices()\n\n    -- Send daily report\n    CALL generate_and_send_report()\n\n    PRINT 'Cleanup completed'\nEND JOB\n\n-- Job management\nALTER JOB daily_log_cleanup DISABLE\nALTER JOB daily_log_cleanup SCHEDULE '0 3 * * *'  -- Change to 3 AM\nDROP JOB daily_log_cleanup\n\n-- View job history\nSELECT * FROM @job_runs \n    WHERE job_name = 'daily_log_cleanup' \n    ORDER BY start_time DESC \n    LIMIT 10\n</code></pre> <p>Schedule Patterns:</p> Pattern Description <code>0 * * * *</code> Every hour <code>*/15 * * * *</code> Every 15 minutes <code>0 2 * * *</code> Daily at 2 AM <code>0 0 * * 0</code> Weekly on Sunday <code>0 0 1 * *</code> Monthly on 1<sup>st</sup> <code>@hourly</code> Alias for every hour <code>@daily</code> Alias for midnight daily"},{"location":"roadmap/#24-triggers-event-driven-execution","title":"2.4 Triggers &amp; Event-Driven Execution","text":"<p>Status: \ud83d\udd34 Not Started | Priority: P0</p> <p>React to Elasticsearch events automatically.</p> <pre><code>-- Trigger on new documents\nCREATE TRIGGER on_critical_error\nWHEN DOCUMENT INSERTED INTO logs-*\nWHERE level = 'ERROR' AND service IN ('payment', 'auth', 'checkout')\nBEGIN\n    -- @document contains the new document\n    DECLARE doc DOCUMENT = @document\n\n    -- Immediate alerting for critical services\n    CALL SLACK_SEND(\n        '#critical-alerts',\n        '\ud83d\udea8 Critical Error in ' || doc.service || ': ' || doc.message\n    )\n\n    -- Check if this is a pattern\n    DECLARE recent_count NUMBER\n    SET recent_count = ESQL_QUERY(\n        'FROM logs-* \n         | WHERE service = ''' || doc.service || ''' \n         AND level = ''ERROR'' \n         AND @timestamp &gt; NOW() - 5 MINUTES\n         | STATS count = COUNT(*)'\n    )[0].count\n\n    IF recent_count &gt; 10 THEN\n        CALL PAGERDUTY_TRIGGER(\n            'Error storm in ' || doc.service,\n            'critical',\n            {'service': doc.service, 'count': recent_count}\n        )\n    END IF\nEND TRIGGER\n\n-- Trigger on alert firing (Elasticsearch Alerting integration)\nCREATE TRIGGER on_alert_fire\nWHEN ALERT 'high-error-rate' FIRES\nBEGIN\n    -- @alert contains alert context\n    CALL escalate_to_oncall(@alert)\nEND TRIGGER\n\n-- Trigger on index lifecycle events\nCREATE TRIGGER on_index_rollover\nWHEN INDEX ROLLED OVER IN logs-*\nBEGIN\n    -- @old_index, @new_index available\n    PRINT 'Index rolled over: ' || @old_index || ' -&gt; ' || @new_index\n    CALL archive_to_s3(@old_index)\nEND TRIGGER\n\n-- Trigger management\nALTER TRIGGER on_critical_error DISABLE\nDROP TRIGGER on_critical_error\nSHOW TRIGGERS\n</code></pre> <p>Trigger Event Types:</p> Event Description Variables <code>DOCUMENT INSERTED INTO index</code> New document indexed <code>@document</code> <code>DOCUMENT UPDATED IN index</code> Document updated <code>@document</code>, <code>@old_document</code> <code>DOCUMENT DELETED FROM index</code> Document deleted <code>@document_id</code> <code>ALERT name FIRES</code> Elasticsearch alert fires <code>@alert</code> <code>INDEX ROLLED OVER IN pattern</code> ILM rollover <code>@old_index</code>, <code>@new_index</code> <code>INDEX CREATED pattern</code> New index created <code>@index</code> <code>CLUSTER STATUS CHANGED TO status</code> Cluster health change <code>@status</code>, <code>@previous_status</code>"},{"location":"roadmap/#phase-3-enterprise-features-q3-q4-2026","title":"\ud83d\udea7 Phase 3: Enterprise Features (Q3-Q4 2026)","text":""},{"location":"roadmap/#31-packages-modules","title":"3.1 Packages &amp; Modules","text":"<p>Status: \ud83d\udfe1 Planned | Priority: P1</p> <p>Organize related procedures and functions into packages.</p> <pre><code>-- Package specification (public interface)\nCREATE PACKAGE incident_response AS\n    -- Public procedures\n    PROCEDURE handle_incident(incident_id STRING)\n    PROCEDURE escalate(incident_id STRING, level NUMBER)\n    PROCEDURE resolve(incident_id STRING, resolution STRING)\n\n    -- Public functions\n    FUNCTION get_severity(incident_id STRING) RETURNS STRING\n    FUNCTION get_oncall() RETURNS STRING\n\n    -- Package constants\n    CONSTANT DEFAULT_TIMEOUT NUMBER = 300\n    CONSTANT ESCALATION_LEVELS ARRAY = ['low', 'medium', 'high', 'critical']\nEND PACKAGE\n\n-- Package body (implementation)\nCREATE PACKAGE BODY incident_response AS\n    -- Private state (per-session)\n    DECLARE active_incidents MAP&lt;STRING, DOCUMENT&gt; = {}\n\n    -- Private helper (not visible outside package)\n    PROCEDURE internal_notify(channel STRING, message STRING) AS\n    BEGIN\n        CALL SLACK_SEND(channel, message)\n    END\n\n    -- Public procedure implementation\n    PROCEDURE handle_incident(incident_id STRING) AS\n    BEGIN\n        CALL internal_notify('#incidents', 'Handling: ' || incident_id)\n        SET active_incidents[incident_id] = {'status': 'in_progress'}\n    END\n\n    -- Public function implementation\n    FUNCTION get_severity(incident_id STRING) RETURNS STRING AS\n    BEGIN\n        DECLARE incident DOCUMENT\n        SET incident = active_incidents[incident_id]\n        RETURN incident.severity ?? 'unknown'\n    END\nEND PACKAGE BODY\n\n-- Usage\nCALL incident_response.handle_incident('INC-001')\nSET sev = incident_response.get_severity('INC-001')\nPRINT incident_response.DEFAULT_TIMEOUT\n</code></pre>"},{"location":"roadmap/#32-security-access-control","title":"3.2 Security &amp; Access Control","text":"<p>Status: \ud83d\udfe1 Planned | Priority: P1</p> <p>Fine-grained access control for procedures and packages.</p> <pre><code>-- Grant execute permission\nGRANT EXECUTE ON PROCEDURE analyze_logs TO ROLE 'analyst'\nGRANT EXECUTE ON PACKAGE incident_response TO ROLE 'sre'\n\n-- Revoke permission\nREVOKE EXECUTE ON PROCEDURE delete_old_data FROM ROLE 'analyst'\n\n-- Invoker vs definer rights\nCREATE PROCEDURE admin_cleanup()\nAUTHID DEFINER  -- Runs with procedure owner's privileges\nAS\nBEGIN\n    -- Can perform admin operations even if caller is limited user\n    CALL delete_old_indices()\n    CALL vacuum_data()\nEND\n\nCREATE PROCEDURE user_report()\nAUTHID CURRENT_USER  -- Runs with caller's privileges (default)\nAS\nBEGIN\n    -- Limited to what the calling user can access\n    CALL generate_report()\nEND\n\n-- Secure credential reference (no plaintext secrets)\nCALL HTTP_POST(\n    'https://api.pagerduty.com/incidents',\n    headers = {'Authorization': CREDENTIAL('pagerduty_api_key')},\n    body = incident_data\n)\n</code></pre>"},{"location":"roadmap/#33-debugging-profiling","title":"3.3 Debugging &amp; Profiling","text":"<p>Status: \ud83d\udfe1 Planned | Priority: P1</p> <p>Built-in performance analysis and debugging.</p> <pre><code>-- Enable profiling for session\nSET PROFILING ON\n\n-- Run procedure\nCALL complex_data_pipeline()\n\n-- View execution profile\nSHOW PROFILE\n\n-- Output:\n-- \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n-- \u2502 Line \u2502 Statement                        \u2502 Time    \u2502 Calls  \u2502\n-- \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n-- \u2502 10   \u2502 SET results = ESQL_QUERY(...)    \u2502 2.345s  \u2502 1      \u2502 &lt;-- Bottleneck\n-- \u2502 15   \u2502 FOR doc IN results LOOP          \u2502 0.523s  \u2502 1000   \u2502\n-- \u2502 20   \u2502   CALL process_document(doc)     \u2502 0.412s  \u2502 1000   \u2502\n-- \u2502 25   \u2502   CALL HTTP_POST(...)            \u2502 1.890s  \u2502 1000   \u2502 &lt;-- Bottleneck\n-- \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n-- \u2502      \u2502 TOTAL                            \u2502 5.170s  \u2502        \u2502\n-- \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n-- Assertions for testing\nASSERT result &gt; 0, 'Result should be positive'\nASSERT response.status = 200, 'HTTP call should succeed'\nASSERT ARRAY_LENGTH(items) &lt;= 100, 'Too many items returned'\n\n-- Debug logging\nSET DEBUG ON\n-- Shows variable assignments, function calls, branch decisions\n</code></pre>"},{"location":"roadmap/#phase-4-elasticsearch-native-features-2027","title":"\ud83d\udea7 Phase 4: Elasticsearch-Native Features (2027+)","text":"<p>These features leverage Elasticsearch's unique capabilities beyond traditional databases.</p>"},{"location":"roadmap/#41-vector-search-ml-integration","title":"4.1 Vector Search &amp; ML Integration","text":"<pre><code>-- Semantic search with embeddings\nDECLARE similar_docs ARRAY&lt;DOCUMENT&gt;\nVECTOR_SEARCH INTO similar_docs\n    FROM knowledge-base\n    QUERY_VECTOR LLM_EMBED(user_question)\n    FIELD 'embedding'\n    K 10\n    NUM_CANDIDATES 100\n\n-- RAG (Retrieval Augmented Generation) pattern\nDECLARE context STRING = ARRAY_JOIN(\n    ARRAY_MAP(similar_docs, d =&gt; d.content),\n    '\\n---\\n'\n)\n\nSET answer = LLM_COMPLETE(\n    'Answer based on context:\\n' || context || '\\n\\nQuestion: ' || user_question\n)\n</code></pre>"},{"location":"roadmap/#42-index-lifecycle-automation","title":"4.2 Index Lifecycle Automation","text":"<pre><code>-- Programmatic ILM\nCREATE PROCEDURE smart_retention(pattern STRING, hot_days NUMBER, warm_days NUMBER) AS\nBEGIN\n    FOR idx IN (SHOW INDICES pattern) LOOP\n        DECLARE age_days NUMBER = DATE_DIFF(NOW(), idx.creation_date, 'days')\n\n        IF age_days &gt; hot_days + warm_days THEN\n            CALL archive_to_s3(idx.name)\n            CALL delete_index(idx.name)\n        ELSIF age_days &gt; hot_days THEN\n            CALL move_to_warm_tier(idx.name)\n        END IF\n    END LOOP\nEND\n</code></pre>"},{"location":"roadmap/#43-cross-cluster-operations","title":"4.3 Cross-Cluster Operations","text":"<pre><code>-- Query remote clusters\nDECLARE remote_errors ARRAY&lt;DOCUMENT&gt;\nFROM cluster:us-west/logs-* | WHERE level = 'ERROR' INTO remote_errors\n\n-- Aggregate across clusters\nDECLARE global_stats DOCUMENT\nAGGREGATE INTO global_stats\n    FROM cluster:*/logs-*\n    | STATS total = COUNT(*), errors = COUNT(*) WHERE level = 'ERROR'\n    BY cluster\n</code></pre>"},{"location":"roadmap/#modernization-framework","title":"\ud83e\udd16 Modernization Framework","text":""},{"location":"roadmap/#guiding-principles","title":"Guiding Principles","text":"<p>The procedural style (<code>BEGIN/END</code>, <code>DECLARE</code>, <code>PROCEDURE</code>) is a strength \u2014 familiar to database developers, SREs, and data engineers. Modernization focuses on capabilities and tooling, not syntax changes.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        ELASTIC-SCRIPT PRINCIPLES                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502   AI    \u2502  \u2502   EASE   \u2502  \u2502   DATA     \u2502  \u2502    ELASTICSEARCH       \u2502   \u2502\n\u2502   \u2502 NATIVE  \u2502  \u2502  OF USE  \u2502  \u2502  DRIVEN    \u2502  \u2502      EVERYTHING        \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                 \u2502\n\u2502                              \u2502                                               \u2502\n\u2502        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                        \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510                \u2502\n\u2502   \u2502  MODERN  \u2502        \u2502 INTEROPER-  \u2502       \u2502  PLUGGABLE  \u2502                \u2502\n\u2502   \u2502   TECH   \u2502        \u2502    ABLE     \u2502       \u2502             \u2502                \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"roadmap/#key-design-decisions","title":"Key Design Decisions","text":"<p>ES|QL is Untouched</p> <p>elastic-script augments ES|QL with new commands (like <code>INTO</code>, <code>PROCESS WITH</code>) \u2014 it does not modify ES|QL itself. ES|QL remains the standard query language.</p> <p>Leverage Existing Elastic Platform APIs</p> <p>elastic-script is an orchestration layer that uses existing Elastic APIs:</p> <ul> <li>Agent Builder \u2192 Build and manage AI agents</li> <li>One Workflow \u2192 Create and execute workflows  </li> <li>Dashboard-as-Code \u2192 Define dashboards programmatically</li> <li>Elasticsearch APIs \u2192 Full access to all ES functionality</li> <li>Kibana APIs \u2192 Saved objects, spaces, features</li> </ul>"},{"location":"roadmap/#1-ai-native","title":"1. AI Native","text":"<p>Vision: elastic-script is the language AI agents speak to operate Elasticsearch.</p>"},{"location":"roadmap/#agent-first-architecture-via-agent-builder-api","title":"Agent-First Architecture (via Agent Builder API)","text":"<pre><code>-- Create agent using Elastic Agent Builder\nCREATE AGENT log_analyst\n    USING AGENT_BUILDER {\n        MODEL 'azure-openai-gpt4'\n        CAPABILITIES ['query_logs', 'identify_patterns', 'summarize']\n        PROMPT \"You are an expert at analyzing log data and identifying anomalies\"\n        TOOLS [\n            PROCEDURE analyze_errors,\n            PROCEDURE summarize_trends,\n            FUNCTION ESQL_QUERY\n        ]\n    }\n\n-- Invoke agent\nDECLARE analysis = AGENT log_analyst \n    TASK \"Analyze payment errors in the last hour and identify patterns\"\n\n-- Multi-agent orchestration\nCREATE WORKFLOW incident_investigation \n    USING ONE_WORKFLOW AS\nBEGIN\n    SET analysis = AGENT log_analyst TASK \"Investigate errors\"\n    IF analysis.severity = 'critical' THEN\n        AGENT incident_responder TASK \"Create P1 incident\"\n    END IF\nEND WORKFLOW\n</code></pre>"},{"location":"roadmap/#mcp-server-model-context-protocol","title":"MCP Server (Model Context Protocol)","text":"<p>Enable external AI agents (Claude, GPT, etc.) to operate Elasticsearch:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    External AI Agents                            \u2502\n\u2502              (Claude, GPT, Custom Agents)                        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                    MCP Protocol                                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502              elastic-script MCP Server                           \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502execute_code  \u2502 \u2502call_procedure\u2502 \u2502 discover_procedures     \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                    Elasticsearch                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> MCP Tool Description <code>execute_escript</code> Run arbitrary elastic-script code <code>call_procedure</code> Call a stored procedure with arguments <code>discover_procedures</code> List available procedures with descriptions <code>query_elasticsearch</code> Execute ES|QL queries"},{"location":"roadmap/#natural-language-interface","title":"Natural Language Interface","text":"<pre><code>-- Direct natural language execution\nEXECUTE \"Find all payment errors in the last hour and alert the team\"\n\n-- Generate procedures from description\nGENERATE PROCEDURE \"Monitor payment service, alert on 5+ errors in 5 minutes\"\n    SAVE AS payment_monitor\n\n-- Semantic procedure discovery\nDISCOVER PROCEDURES LIKE \"handle incidents\"\n-- Returns: incident_response, alert_handler, on_call_escalation\n\n-- AI-powered recommendations\nRECOMMEND PROCEDURES FOR \"I need to set up monitoring for a new microservice\"\n</code></pre>"},{"location":"roadmap/#agent-memory-context","title":"Agent Memory &amp; Context","text":"<pre><code>-- Persistent context across sessions\nREMEMBER \"The payment service has been unstable since deployment v2.3.1\"\n\n-- Recall in procedures\nCREATE PROCEDURE smart_alert()\nBEGIN\n    DECLARE context = RECALL \"recent incidents for payment service\"\n    IF context.has_ongoing_incident THEN\n        PRINT \"Suppressing alert - ongoing incident exists\"\n    ELSE\n        CALL create_incident()\n    END IF\nEND PROCEDURE\n</code></pre>"},{"location":"roadmap/#2-ease-of-use","title":"2. Ease of Use","text":"<p>Vision: From zero to productive in minutes. Progressive complexity.</p>"},{"location":"roadmap/#smart-defaults-one-liners","title":"Smart Defaults &amp; One-Liners","text":"<pre><code>-- Minimal syntax, sensible defaults\nCREATE JOB cleanup SCHEDULE '@daily' AS\n    CALL delete_old_logs()\nEND JOB\n-- Defaults: ENABLED true, TIMEZONE UTC\n\n-- One-liners for common tasks\nALERT ON (FROM logs-* | WHERE level = 'ERROR' | STATS count) &gt; 10 \n    SEND SLACK '#alerts'\n\n-- Quick monitoring\nMONITOR 'payment-service' EVERY 5 MINUTES \n    ALERT IF error_rate &gt; 0.01\n</code></pre>"},{"location":"roadmap/#progressive-disclosure","title":"Progressive Disclosure","text":"<pre><code>-- Level 1: Simple inline\nFROM logs-* | WHERE level = 'ERROR' | STATS count\n\n-- Level 2: Named procedure\nCREATE PROCEDURE count_errors()\n    RETURN FROM logs-* | WHERE level = 'ERROR' | STATS count\nEND PROCEDURE\n\n-- Level 3: Parameterized with defaults\nCREATE PROCEDURE count_errors(time_range STRING DEFAULT '24h')\n    RETURN FROM logs-* \n        | WHERE level = 'ERROR' AND @timestamp &gt; NOW() - @time_range\n        | STATS count\nEND PROCEDURE\n\n-- Level 4: Full-featured with security, observability\n@description \"Counts errors with alerting\"\nCREATE PROCEDURE count_errors(time_range STRING, alert_threshold NUMBER)\nWITH { TRACING ON, MAX_EXECUTION_TIME = 30 SECONDS }\nBEGIN\n    TRY\n        DECLARE count = FROM logs-* | WHERE ... | STATS count\n        IF count &gt; alert_threshold THEN CALL alert_team(count) END IF\n        RETURN count\n    CATCH\n        CALL log_error(@error)\n        RAISE\n    END TRY\nEND PROCEDURE\n</code></pre>"},{"location":"roadmap/#contextual-help","title":"Contextual Help","text":"<pre><code>-- Inline help\nHELP SLACK_SEND\n-- Shows: signature, parameters, examples\n\n-- Interactive examples\nEXAMPLE \"send slack notification\"\n-- Returns runnable example code\n\n-- Smart error messages\n&gt; CALL SLCK_SEND('#alerts', 'test')\n-- Error: Unknown function 'SLCK_SEND'. Did you mean 'SLACK_SEND'?\n</code></pre>"},{"location":"roadmap/#3-data-driven-close-to-esql","title":"3. Data-Driven (Close to ES|QL)","text":"<p>Vision: ES|QL is the native query language. elastic-script augments it, never replaces it.</p>"},{"location":"roadmap/#esql-augmentation-not-modification","title":"ES|QL Augmentation (Not Modification)","text":"<pre><code>-- ES|QL is used as-is\nDECLARE errors = FROM logs-* | WHERE level = 'ERROR' | LIMIT 100\n\n-- elastic-script ADDS commands that work with ES|QL results\nFROM logs-* \n| WHERE level = 'ERROR' \n| INTO my_results                    -- NEW: Store results\n\nFROM logs-* \n| PROCESS WITH analyze_error         -- NEW: Call procedure per row\n\n-- ES|QL in expressions (ES|QL unchanged, elastic-script wraps)\nIF (FROM metrics-* | STATS AVG(cpu)) &gt; 80 THEN\n    CALL alert_high_cpu()\nEND IF\n</code></pre>"},{"location":"roadmap/#query-composition","title":"Query Composition","text":"<pre><code>-- Build queries programmatically (generates valid ES|QL)\nCREATE FUNCTION build_log_query(\n    indices STRING DEFAULT 'logs-*',\n    level STRING DEFAULT NULL,\n    service STRING DEFAULT NULL\n) RETURNS QUERY AS\nBEGIN\n    DECLARE q = QUERY FROM @indices\n    IF level IS NOT NULL THEN\n        SET q = q | WHERE level = @level\n    END IF\n    IF service IS NOT NULL THEN\n        SET q = q | WHERE service = @service\n    END IF\n    RETURN q\nEND FUNCTION\n\n-- Execute composed query\nDECLARE results = EXECUTE build_log_query(level := 'ERROR') | LIMIT 100\n</code></pre>"},{"location":"roadmap/#schema-awareness","title":"Schema Awareness","text":"<pre><code>-- Introspect index mappings (uses ES _mapping API)\nDECLARE schema = SCHEMA FOR 'logs-*'\nPRINT schema.fields.level.type  -- 'keyword'\n\n-- Validate data against schema\nVALIDATE document AGAINST SCHEMA 'logs-*'\n</code></pre>"},{"location":"roadmap/#streaming-continuous-queries","title":"Streaming &amp; Continuous Queries","text":"<pre><code>-- Continuous query (uses ES async search / PIT)\nCREATE STREAM error_monitor AS\n    FROM logs-* \n    | WHERE level = 'ERROR'\n    | WINDOW TUMBLING 5 MINUTES\n    | STATS count BY service\n    | EMIT TO PROCEDURE handle_high_errors\n</code></pre>"},{"location":"roadmap/#4-everything-elasticsearch","title":"4. Everything Elasticsearch","text":"<p>Vision: Full access to the Elasticsearch ecosystem via existing APIs.</p>"},{"location":"roadmap/#complete-api-coverage","title":"Complete API Coverage","text":"<pre><code>-- Uses ES Cluster APIs\nCLUSTER HEALTH\nCLUSTER SETTINGS SET 'cluster.routing.allocation.enable' = 'all'\n\n-- Uses ES Index APIs  \nCREATE INDEX 'my-index' WITH MAPPINGS { ... }\nREINDEX FROM 'source-*' TO 'dest'\n\n-- Uses ES Alias APIs\nCREATE ALIAS 'current' FOR 'logs-2026.01'\nSWAP ALIAS 'current' FROM 'logs-2026.01' TO 'logs-2026.02'\n</code></pre>"},{"location":"roadmap/#ilm-integration","title":"ILM Integration","text":"<pre><code>-- Uses ES ILM APIs\nCREATE ILM POLICY 'logs-policy' AS {\n    HOT { ROLLOVER MAX_SIZE '50GB' MAX_AGE '1d' }\n    WARM { MIN_AGE '7d', SHRINK NUMBER_OF_SHARDS 1 }\n    DELETE { MIN_AGE '90d' }\n}\n\nAPPLY ILM POLICY 'logs-policy' TO INDEX TEMPLATE 'logs-template'\n</code></pre>"},{"location":"roadmap/#alerting-integration","title":"Alerting Integration","text":"<pre><code>-- Uses ES Alerting / Watcher APIs\nCREATE ALERT high_error_rate\n    TRIGGER SCHEDULE EVERY 5 MINUTES\n    INPUT (FROM logs-* | WHERE level = 'ERROR' | STATS count)\n    CONDITION result.count &gt; 100\n    ACTIONS {\n        SLACK '#alerts' MESSAGE 'High error rate: {{count}}'\n    }\n</code></pre>"},{"location":"roadmap/#ml-integration","title":"ML Integration","text":"<pre><code>-- Uses ES ML APIs\nCREATE ML JOB error_anomaly\n    ANALYSIS_CONFIG { DETECTORS [{ FUNCTION 'count' }], BUCKET_SPAN '15m' }\n    DATAFEED (FROM logs-* | WHERE level = 'ERROR')\n\n-- Uses ES Inference APIs\nDECLARE sentiment = INFER 'sentiment-model' WITH { text: message }\n</code></pre>"},{"location":"roadmap/#ingest-pipeline-integration","title":"Ingest Pipeline Integration","text":"<pre><code>-- Uses ES Ingest APIs\nCREATE INGEST PIPELINE 'enrich-logs' AS {\n    GROK FIELD 'message' PATTERNS ['%{TIMESTAMP:ts} %{LOGLEVEL:level}']\n    ENRICH POLICY 'geo-lookup' FIELD 'ip' TARGET 'geo'\n}\n\nINDEX document INTO 'logs' PIPELINE 'enrich-logs'\n</code></pre>"},{"location":"roadmap/#5-modern-technologies","title":"5. Modern Technologies","text":"<p>Vision: Built with and for modern infrastructure.</p>"},{"location":"roadmap/#real-time-streaming","title":"Real-Time Streaming","text":"<pre><code>-- Uses ES async capabilities\nWEBSOCKET NOTIFY '#channel' ON \n    FROM logs-* | WHERE level = 'ERROR' | STATS count &gt; 10\n\n-- Event publishing (to Kafka, etc.)\nPUBLISH EVENT 'order.created' TO 'events-topic' WITH order_data\n</code></pre>"},{"location":"roadmap/#container-kubernetes-native","title":"Container &amp; Kubernetes Native","text":"<pre><code>-- Uses K8s API\nDECLARE pods = K8S_GET_PODS(namespace := 'production')\n\nFOR pod IN pods LOOP\n    IF (FROM logs-* | WHERE k8s.pod.name = pod.name | WHERE level = 'ERROR' | STATS count) &gt; 10 THEN\n        CALL K8S_RESTART_POD(pod.name)\n    END IF\nEND LOOP\n</code></pre>"},{"location":"roadmap/#serverless-functions","title":"Serverless Functions","text":"<pre><code>-- Serverless execution model\nCREATE FUNCTION process_webhook(event DOCUMENT)\nSERVERLESS\nTRIGGER HTTP POST '/webhook/github'\nAS\nBEGIN\n    CALL handle_github_event(event.body)\nEND FUNCTION\n</code></pre>"},{"location":"roadmap/#gitops-infrastructure-as-code","title":"GitOps &amp; Infrastructure as Code","text":"<pre><code>-- Procedures stored as files, deployed via CI/CD\n-- File: procedures/incident_response.escript\n\n-- Deploy command\nDEPLOY FROM GIT 'main'\nPREVIEW DEPLOY 'procedures/*.escript'\n</code></pre>"},{"location":"roadmap/#6-interoperable","title":"6. Interoperable","text":"<p>Vision: Works with everything. Standards-based.</p>"},{"location":"roadmap/#opentelemetry-native","title":"OpenTelemetry Native","text":"<pre><code>-- Automatic OTEL instrumentation\nCREATE PROCEDURE my_operation()\nWITH OTEL { SERVICE_NAME 'my-service' }\nAS\nBEGIN\n    -- Traces automatically created and sent to APM\nEND PROCEDURE\n\n-- Custom spans\nOTEL_SPAN 'process-batch' BEGIN\n    FOR item IN batch LOOP\n        OTEL_METRIC 'items.processed' INCREMENT 1\n    END LOOP\nEND OTEL_SPAN\n</code></pre>"},{"location":"roadmap/#protocol-support","title":"Protocol Support","text":"<pre><code>-- HTTP\nDECLARE response = HTTP_GET('https://api.example.com/data')\n\n-- gRPC  \nDECLARE response = GRPC_CALL('orders.OrderService/GetOrder', { id: '123' })\n\n-- GraphQL\nDECLARE response = GRAPHQL_QUERY('https://api/graphql', \n    'query { user(id: \"123\") { name } }')\n\n-- Message Queues\nKAFKA_PRODUCE('topic', message)\nRABBITMQ_PUBLISH('exchange', 'routing.key', message)\n</code></pre>"},{"location":"roadmap/#data-format-support","title":"Data Format Support","text":"<pre><code>-- Parquet (for data interchange)\nEXPORT (FROM logs-* | LIMIT 10000) TO PARQUET 's3://bucket/logs.parquet'\nIMPORT PARQUET 's3://bucket/data.parquet' INTO 'imported-data'\n\n-- CSV, JSON, YAML, XML\nDECLARE records = PARSE_CSV(csv_string)\nDECLARE config = PARSE_YAML(yaml_string)\n</code></pre>"},{"location":"roadmap/#cloud-provider-integration","title":"Cloud Provider Integration","text":"<pre><code>-- AWS\nDECLARE secret = AWS_SECRETS_MANAGER_GET('my-secret')\nCALL AWS_LAMBDA_INVOKE('my-function', payload)\n\n-- GCP\nCALL GCP_PUBSUB_PUBLISH('projects/.../topics/my-topic', message)\n\n-- Azure\nDECLARE secret = AZURE_KEYVAULT_GET('my-secret')\n</code></pre>"},{"location":"roadmap/#7-pluggable","title":"7. Pluggable","text":"<p>Vision: Extensible at every layer without forking.</p>"},{"location":"roadmap/#custom-functions","title":"Custom Functions","text":"<pre><code>-- Register custom function (Java)\nREGISTER FUNCTION my_custom_function\n    CLASS 'com.mycompany.escript.MyFunction'\n    JAR 's3://plugins/my-functions.jar'\n\n-- Register from external service\nREGISTER FUNCTION external_calc\n    HTTP POST 'https://calc.service/compute'\n</code></pre>"},{"location":"roadmap/#function-registries","title":"Function Registries","text":"<pre><code>-- Connect to function registry\nCONNECT REGISTRY 'https://registry.company.com/escript-functions'\n\n-- Install functions from registry\nINSTALL FUNCTIONS FROM 'company/data-quality' VERSION '^2.0'\n</code></pre>"},{"location":"roadmap/#middleware-interceptors","title":"Middleware / Interceptors","text":"<pre><code>-- Define middleware\nCREATE MIDDLEWARE audit_all\nBEFORE EXECUTE ANY PROCEDURE\nAS\nBEGIN\n    CALL log_execution_start(@procedure, @args, @user)\nEND MIDDLEWARE\n\nAFTER EXECUTE ANY PROCEDURE\nAS\nBEGIN\n    CALL log_execution_end(@procedure, @result, @duration)\nEND MIDDLEWARE\n\n-- Apply middleware\nAPPLY MIDDLEWARE audit_all TO ALL PROCEDURES\n</code></pre>"},{"location":"roadmap/#custom-statements-dsl-extensions","title":"Custom Statements (DSL Extensions)","text":"<pre><code>-- Extend grammar with domain-specific syntax\nEXTEND GRAMMAR WITH {\n    'MONITOR' service:STRING 'FOR' duration:DURATION 'ALERT' 'IF' condition:EXPRESSION\n    =&gt; CREATE TRIGGER ... (generates standard elastic-script)\n}\n\n-- Use new syntax\nMONITOR 'payment-api' FOR 5 MINUTES ALERT IF error_rate &gt; 0.05\n</code></pre>"},{"location":"roadmap/#security-governance","title":"Security &amp; Governance","text":"<p>Enterprise-grade security controls.</p>"},{"location":"roadmap/#sandboxing-resource-limits","title":"Sandboxing &amp; Resource Limits","text":"<pre><code>CREATE PROCEDURE untrusted_operation()\nWITH {\n    -- Execution limits\n    MAX_EXECUTION_TIME = 60 SECONDS\n    MAX_MEMORY = 256MB\n    MAX_ES_QUERIES = 100\n    MAX_RESULT_SIZE = 10MB\n\n    -- Data access restrictions  \n    ALLOWED_INDICES = ['logs-*', 'metrics-*']\n    DENIED_INDICES = ['security-*', '.kibana*']\n\n    -- Network restrictions\n    NETWORK = DENY\n    -- OR\n    ALLOWED_HOSTS = ['api.slack.com', 'api.pagerduty.com']\n\n    -- Function restrictions\n    DENIED_FUNCTIONS = ['ES_DELETE', 'DROP_INDEX']\n}\nBEGIN\n    -- Runs in sandboxed environment\nEND PROCEDURE\n</code></pre>"},{"location":"roadmap/#execution-policies","title":"Execution Policies","text":"<pre><code>CREATE POLICY production_safety AS\nBEGIN\n    REQUIRE MAX_EXECUTION_TIME &lt;= 300 SECONDS\n    DENY FUNCTION 'ES_DELETE' UNLESS ROLE IN ('admin')\n    DENY INDEX_PATTERN '.security-*'\n    REQUIRE APPROVAL FOR FUNCTION 'DROP_INDEX'\nEND POLICY\n\nAPPLY POLICY production_safety TO ROLE 'developer'\n</code></pre>"},{"location":"roadmap/#secrets-management","title":"Secrets Management","text":"<pre><code>-- Reference secrets by name (uses ES keystore or external vault)\nCALL HTTP_POST(\n    'https://api.pagerduty.com/incidents',\n    headers = {'Authorization': SECRET('pagerduty_key')}\n)\n</code></pre>"},{"location":"roadmap/#audit-trail-rbac","title":"Audit Trail &amp; RBAC","text":"<pre><code>-- Audit logging\nSHOW AUDIT LOG FOR PROCEDURE sensitive_operation\n    WHERE user = 'john' AND @timestamp &gt; NOW() - 7 DAYS\n\n-- Role-based access\nGRANT EXECUTE ON PROCEDURE analyze_logs TO ROLE 'analyst'\nREVOKE EXECUTE ON PROCEDURE delete_data FROM ROLE 'developer'\n</code></pre>"},{"location":"roadmap/#developer-experience_1","title":"Developer Experience","text":"<p>Modern tooling around the procedural language.</p>"},{"location":"roadmap/#language-server-protocol-lsp","title":"Language Server Protocol (LSP)","text":"Feature Description Autocomplete Procedures, functions, variables, ES|QL fields Hover docs Function signatures, procedure documentation Go to definition Jump to procedure source Diagnostics Real-time error detection <p>Enables: VS Code extension, Cursor extension, JetBrains plugin.</p>"},{"location":"roadmap/#rich-notebook-outputs","title":"Rich Notebook Outputs","text":"<pre><code>-- Rich output in Jupyter notebooks\nDISPLAY TABLE errors WITH { TITLE 'Errors by Service', CHART 'bar' }\nDISPLAY CHART { TYPE 'timeseries', DATA query_results }\n</code></pre>"},{"location":"roadmap/#procedure-versioning","title":"Procedure Versioning","text":"<pre><code>SHOW PROCEDURE HISTORY my_procedure\nDIFF PROCEDURE my_procedure VERSION 3 WITH VERSION 5\nROLLBACK PROCEDURE my_procedure TO VERSION 3\n</code></pre>"},{"location":"roadmap/#built-in-opentelemetry","title":"Built-in OpenTelemetry","text":"<pre><code>CREATE PROCEDURE process_orders()\nWITH TRACING ON\nBEGIN\n    -- Traces automatically created and sent to APM\nEND PROCEDURE\n\nSHOW PROCEDURE METRICS my_procedure\n-- Shows: executions, success rate, P50/P99 duration\n</code></pre>"},{"location":"roadmap/#syntax-modernization-commands-type-namespaced-functions","title":"Syntax Modernization: Commands &amp; Type-Namespaced Functions","text":"<p>Status: \ud83d\udd34 Not Started | Priority: P0</p>"},{"location":"roadmap/#first-class-commands","title":"First-Class Commands","text":"<p>Core Elasticsearch operations become language keywords (not functions):</p> <pre><code>-- \u2705 Proposed: First-class commands\nINDEX document INTO 'my-index';\nDELETE FROM 'my-index' WHERE _id = '123';\nSEARCH 'my-index' QUERY { \"match\": { \"title\": \"elastic\" } };\nREFRESH 'my-index';\nCREATE INDEX 'new-index' WITH { \"mappings\": {...} };\n\n-- \u274c Current: Function calls (will be deprecated)\nINDEX_DOCUMENT('my-index', document);\nES_DELETE('my-index', '123');\n</code></pre>"},{"location":"roadmap/#type-namespaced-functions-uppercase","title":"Type-Namespaced Functions (UPPERCASE)","text":"<p>Functions use <code>TYPE.FUNCTION()</code> pattern for clarity and to avoid ambiguity:</p> <pre><code>-- \u2705 Proposed: Type-namespaced functions\nDECLARE len = ARRAY.LENGTH(my_array);\nDECLARE keys = DOCUMENT.KEYS(my_doc);\nDECLARE upper_name = STRING.UPPER(name);\nDECLARE tomorrow = DATE.ADD(today, 1, 'DAY');\n\n-- Extensions follow same pattern\nDECLARE pods = K8S.GET_PODS('default');\nDECLARE result = OPENAI.COMPLETE(prompt);\nDECLARE msg = SLACK.POST_MESSAGE(channel, text);\n\n-- \u274c Current: SNAKE_CASE functions (will be deprecated)\nARRAY_LENGTH(my_array);\nDOCUMENT_KEYS(my_doc);\nSTRING_UPPER(name);\n</code></pre> <p>Benefits: - No ambiguity with variable names - Self-documenting type expectations - Consistent UPPERCASE style - Extensible namespace pattern</p>"},{"location":"roadmap/#type-aware-esql-binding","title":"Type-Aware ES|QL Binding","text":"<p>Status: \ud83d\udd34 Not Started | Priority: P0</p> <p>Inline ES|QL with type-specific result binding:</p> <pre><code>-- \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n-- CURSOR: Multiple rows \u2192 Iterate one at a time\n-- \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\nDECLARE logs CURSOR FOR \n    FROM logs-* | WHERE level = 'ERROR' | LIMIT 100;\n\nFOR log IN logs LOOP\n    PRINT log.message;\nEND LOOP\n\n-- \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n-- ARRAY: Multiple rows \u2192 Capture all rows at once\n-- \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\nDECLARE logs ARRAY FROM logs-* | WHERE level = 'ERROR' | LIMIT 100;\nPRINT 'Found ' || ARRAY.LENGTH(logs) || ' errors';\n\n-- \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n-- DOCUMENT: Single row with multiple fields \u2192 One document\n-- \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\nDECLARE stats DOCUMENT FROM logs-* \n    | STATS count = COUNT(*), errors = COUNT(*) WHERE level = 'ERROR';\n\nPRINT 'Total: ' || stats.count || ', Errors: ' || stats.errors;\n\n-- \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n-- SCALAR: Single row, single column \u2192 Direct value\n-- \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\nDECLARE total_count NUMBER FROM logs-* | STATS c = COUNT(*);\nPRINT 'Total logs: ' || total_count;  -- Directly a number, not {c: 42}\n\nDECLARE latest DATE FROM logs-* | STATS latest = MAX(@timestamp);\nPRINT 'Latest: ' || latest;\n\nDECLARE service STRING FROM services \n    | WHERE id = 'svc-001' | KEEP name | LIMIT 1;\nPRINT 'Service: ' || service;\n</code></pre> <p>Type Binding Summary:</p> Declaration ES|QL Result Expected Binding <code>DECLARE x CURSOR FOR &lt;esql&gt;</code> Multiple rows Iterate with FOR <code>DECLARE x ARRAY FROM &lt;esql&gt;</code> Multiple rows All rows as array <code>DECLARE x DOCUMENT FROM &lt;esql&gt;</code> Single row Row as document <code>DECLARE x NUMBER FROM &lt;esql&gt;</code> 1 row, 1 column Scalar value <code>DECLARE x STRING FROM &lt;esql&gt;</code> 1 row, 1 column Scalar value <code>DECLARE x DATE FROM &lt;esql&gt;</code> 1 row, 1 column Scalar value <code>DECLARE x BOOLEAN FROM &lt;esql&gt;</code> 1 row, 1 column Scalar value <p>Runtime Validation:</p> <pre><code>-- ERROR: Expected scalar but got multiple rows\nDECLARE count NUMBER FROM logs-* | LIMIT 10;  \n-- \u2192 RuntimeError: Query returned 10 rows, expected 1 for NUMBER\n\n-- ERROR: Expected scalar but got multiple columns  \nDECLARE count NUMBER FROM logs-* | STATS a = COUNT(*), b = SUM(size);\n-- \u2192 RuntimeError: Query returned 2 columns, expected 1 for NUMBER\n</code></pre>"},{"location":"roadmap/#modernization-priority","title":"Modernization Priority","text":"Strategy Impact Effort Priority Syntax: First-Class Commands \ud83d\udd25\ud83d\udd25\ud83d\udd25 Medium \u2b50 P0 Syntax: Type-Namespaced Functions \ud83d\udd25\ud83d\udd25\ud83d\udd25 Medium \u2b50 P0 Type-Aware ES|QL Binding \ud83d\udd25\ud83d\udd25\ud83d\udd25 Medium \u2b50 P0 MCP Server \ud83d\udd25\ud83d\udd25\ud83d\udd25 Medium \u2b50 P0 Agent Builder Integration \ud83d\udd25\ud83d\udd25\ud83d\udd25 Medium \u2b50 P0 Sandboxing &amp; Resource Limits \ud83d\udd25\ud83d\udd25\ud83d\udd25 Medium \u2b50 P0 Natural Language Interface \ud83d\udd25\ud83d\udd25\ud83d\udd25 High P1 ES|QL Augmentation (INTO, PROCESS) \ud83d\udd25\ud83d\udd25 Medium P1 One Workflow Integration \ud83d\udd25\ud83d\udd25 Medium P1 Dashboard-as-Code Integration \ud83d\udd25\ud83d\udd25 Medium P1 Secrets Management \ud83d\udd25\ud83d\udd25 Low P1 LSP Implementation \ud83d\udd25\ud83d\udd25 High P1 OpenTelemetry Integration \ud83d\udd25\ud83d\udd25 Medium P1 Custom Function Registry \ud83d\udd25\ud83d\udd25 High P2 Procedure Versioning \ud83d\udd25 Low P2"},{"location":"roadmap/#app-deployment-platform-vercel-style","title":"\ud83d\ude80 App Deployment Platform (Vercel-Style)","text":"<p>Deploy data-driven applications directly from elastic-script. Write code, get a deployed app URL.</p>"},{"location":"roadmap/#vision","title":"Vision","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     Developer Experience                         \u2502\n\u2502  CREATE APP inventory_manager                                    \u2502\n\u2502  ROUTE '/inventory'                                              \u2502\n\u2502  AS BEGIN                                                        \u2502\n\u2502      RENDER EUI.Page { ... }                                     \u2502\n\u2502      RENDER DASHBOARD 'inventory-overview'                       \u2502\n\u2502  END APP                                                         \u2502\n\u2502                            \u2193 DEPLOY                              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                     EScript App Runtime                          \u2502\n\u2502  \u2022 Hosts apps at /apps/{app-name}                                \u2502\n\u2502  \u2022 Renders EUI components                                        \u2502\n\u2502  \u2022 Embeds Dashboards-as-Code                                     \u2502\n\u2502  \u2022 Executes elastic-script logic                                 \u2502\n\u2502  \u2022 Connects to Elasticsearch for data                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                     Elasticsearch                                \u2502\n\u2502  .escript_apps      Your Data Indices      .kibana_dashboards   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"roadmap/#architecture","title":"Architecture","text":"<p>Standalone Runtime (not a Kibana plugin):</p> <ul> <li>Serves apps at routes like <code>https://apps.company.com/inventory</code></li> <li>Uses Kibana's rendering stack (EUI, Elastic Charts, React)</li> <li>Embeds dashboards via dashboards-as-code API (March 2026)</li> <li>Executes elastic-script for business logic</li> <li>Authenticates via Elasticsearch security</li> <li>Apps can work standalone OR be embedded in Kibana later</li> </ul>"},{"location":"roadmap/#app-definition-syntax","title":"App Definition Syntax","text":"<pre><code>CREATE APP incident_response\n    ROUTE '/incidents'                    -- URL path\n    TITLE 'Incident Response Center'      -- Browser title\n    ICON 'alert'                          -- EUI icon\n    AUTH REQUIRED                         -- Requires login\n    ROLES ['sre', 'oncall']               -- Who can access\nAS\nBEGIN\n    -- App state (reactive)\n    STATE selected_incident DOCUMENT DEFAULT NULL\n    STATE severity_filter STRING DEFAULT 'all'\n\n    -- UI components\n    RENDER HEADER 'Incident Response' WITH {\n        ACTIONS [\n            BUTTON 'Create' ON_CLICK =&gt; MODAL create_modal\n        ]\n    }\n\n    RENDER STATS { ... }\n    RENDER TABLE { ... }\n    RENDER CHART { ... }\n    RENDER FORM { ... }\n    RENDER DASHBOARD 'service-health' { ... }\n\nEND APP\n</code></pre>"},{"location":"roadmap/#eui-component-mapping","title":"EUI Component Mapping","text":""},{"location":"roadmap/#data-display","title":"Data Display","text":"<pre><code>-- Table (EUI.EuiBasicTable)\nRENDER TABLE inventory_table {\n    DATA (FROM inventory-* | SORT last_updated DESC | LIMIT 100)\n    COLUMNS [\n        { FIELD 'sku' LABEL 'SKU' SORTABLE },\n        { FIELD 'name' LABEL 'Product Name' },\n        { FIELD 'quantity' LABEL 'Qty' TYPE 'number' }\n    ]\n    PAGINATION { PAGE_SIZE 25 }\n    ACTIONS [\n        { LABEL 'Edit' ON_CLICK (row) =&gt; CALL edit_item(row) }\n    ]\n}\n\n-- Stats (EUI.EuiStat)\nRENDER STATS {\n    STAT { TITLE 'Total Items' VALUE (FROM inventory-* | STATS COUNT(*)) }\n    STAT { TITLE 'Low Stock' VALUE (...) COLOR 'danger' }\n}\n\n-- Chart (Elastic Charts)\nRENDER CHART inventory_trend {\n    TYPE 'area'\n    DATA (FROM inventory-* | STATS sum(quantity) BY @timestamp BUCKET 1d)\n    X '@timestamp'\n    Y 'sum_quantity'\n}\n</code></pre>"},{"location":"roadmap/#forms-input","title":"Forms &amp; Input","text":"<pre><code>RENDER FORM add_item_form {\n    FIELD sku { TYPE 'text' LABEL 'SKU' REQUIRED }\n    FIELD quantity { TYPE 'number' DEFAULT 0 }\n    FIELD category { \n        TYPE 'select' \n        OPTIONS (FROM categories-* | STATS DISTINCT(name))\n    }\n\n    ON_SUBMIT (values) =&gt; BEGIN\n        CALL add_inventory_item(values)\n        TOAST 'Item added' TYPE 'success'\n        REFRESH inventory_table\n    END\n}\n\nRENDER SEARCH {\n    PLACEHOLDER 'Search...'\n    FILTERS [\n        { FIELD 'category' TYPE 'select' OPTIONS [...] }\n    ]\n    ON_CHANGE (query) =&gt; REFRESH table WITH FILTER query\n}\n</code></pre>"},{"location":"roadmap/#dashboard-embedding","title":"Dashboard Embedding","text":"<pre><code>-- Embed existing dashboard\nRENDER DASHBOARD 'abc-123-def' {\n    HEIGHT '600px'\n    FILTERS { 'service' = @selected_service }\n}\n\n-- Or define inline (dashboards-as-code)\nRENDER DASHBOARD {\n    TITLE 'Error Analysis'\n    TIME_RANGE 'now-24h' TO 'now'\n\n    PANEL 'errors_over_time' {\n        TYPE 'lens'\n        VISUALIZATION 'line'\n        DATA (FROM logs-* | WHERE level = 'ERROR' | STATS count BY @timestamp)\n    }\n}\n</code></pre>"},{"location":"roadmap/#layout","title":"Layout","text":"<pre><code>RENDER ROW {\n    RENDER COLUMN { WIDTH '30%' ... }\n    RENDER COLUMN { WIDTH '70%' ... }\n}\n\nRENDER TABS {\n    TAB 'Overview' { ... }\n    TAB 'Details' { ... }\n}\n\nMODAL create_modal {\n    TITLE 'Create New Item'\n    RENDER FORM { ... }\n    ON_SUBMIT =&gt; BEGIN ... CLOSE MODAL END\n}\n</code></pre>"},{"location":"roadmap/#state-interactivity","title":"State &amp; Interactivity","text":"<pre><code>CREATE APP interactive_demo ROUTE '/demo' AS\nBEGIN\n    -- Reactive state\n    STATE selected_service STRING DEFAULT 'all'\n    STATE date_range STRING DEFAULT 'now-24h'\n\n    -- Components react to state changes\n    RENDER SELECT {\n        VALUE @selected_service\n        ON_CHANGE (val) =&gt; SET selected_service = val\n    }\n\n    RENDER TABLE {\n        DATA (FROM logs-* | WHERE service = @selected_service)\n        REFRESH EVERY 30 SECONDS\n    }\n\n    -- Lifecycle hooks\n    ON_MOUNT =&gt; CALL log_app_access()\n    ON_UNMOUNT =&gt; CALL cleanup()\nEND APP\n</code></pre>"},{"location":"roadmap/#deployment-management","title":"Deployment Management","text":"<pre><code>-- Deploy an app\nDEPLOY APP incident_response\n\n-- View all apps\nSHOW APPS\n-- \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n-- \u2502 Name              \u2502 Route      \u2502 Status  \u2502 Version\u2502\n-- \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n-- \u2502 incident_response \u2502 /incidents \u2502 Running \u2502 v3     \u2502\n-- \u2502 inventory_manager \u2502 /inventory \u2502 Running \u2502 v1     \u2502\n-- \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n-- Version management\nROLLBACK APP incident_response TO VERSION 2\nSTOP APP my_app\nSTART APP my_app\nDROP APP my_app\n</code></pre> <p>Access URLs:</p> <pre><code>https://your-cluster.com/escript-apps/incidents\nhttps://apps.company.com/incidents  (custom domain)\n</code></pre>"},{"location":"roadmap/#implementation-phases","title":"Implementation Phases","text":"Phase Deliverables Duration 1. Runtime Foundation App Server, Router, Auth 2 weeks 2. Core Components TABLE, STATS, CHART, FORM 2 weeks 3. Dashboard Integration Embed dashboards-as-code 1 week 4. Interactivity STATE, Events, Modals 2 weeks 5. Advanced Components Search, Filters, Tabs 1 week 6. Deployment CLI DEPLOY, SHOW, ROLLBACK 1 week"},{"location":"roadmap/#release-timeline","title":"\ud83d\uddd3\ufe0f Release Timeline","text":"Version Target Focus v1.0 \u2705 Current Core language, 106 functions, async execution v1.1 Q1 2026 Exception handling, user-defined functions v1.2 Q2 2026 Dynamic ES|QL, associative arrays, sandboxing v1.3 Q3 2026 Cursors, bulk operations v2.0 Q4 2026 Triggers, scheduled jobs v2.1 Q1 2027 Packages, security, secrets management v2.5 Q2 2027 MCP Server, natural language interface v3.0 Q3 2027 App Deployment Platform (Phase 1-3) v3.5 Q4 2027 App Platform (Phase 4-6), LSP v4.0 2028 Vector search, cross-cluster, package registry"},{"location":"roadmap/#known-issues","title":"\ud83d\udc1b Known Issues","text":"Issue Status Workaround <code>.escript_executions</code> index not auto-created \ud83d\udd04 In Progress Create manually before STATUS calls 106 functions registered per-request \ud83d\udd04 Planned Move to startup registration No transaction support \ud83d\udccb Backlog Use compensating actions"},{"location":"roadmap/#feature-requests","title":"\ud83d\udca1 Feature Requests","text":"<p>Have an idea for elastic-script? We'd love to hear it!</p> <p> Open a Feature Request</p>"},{"location":"roadmap/#contributing","title":"\ud83e\udd1d Contributing","text":"<p>Want to help build these features? Check out the Contributing Guide to get started!</p>"},{"location":"roadmap/#current-implementation-triggers-scheduling","title":"\ud83d\ude80 Current Implementation: Triggers &amp; Scheduling","text":""},{"location":"roadmap/#overview","title":"Overview","text":"<p>Polling-based architecture for non-invasive event automation:</p> <ul> <li>Scheduled Jobs: Cron-based recurring execution</li> <li>Event Triggers: React to new documents in indices</li> <li>No indexing impact: Polling doesn't affect write performance</li> </ul>"},{"location":"roadmap/#syntax-preview","title":"Syntax Preview","text":"<pre><code>-- Scheduled Job\nCREATE JOB daily_cleanup\nSCHEDULE '0 2 * * *'\nAS\nBEGIN\n    CALL archive_old_logs(30)\nEND JOB\n\n-- Event Trigger\nCREATE TRIGGER on_payment_error\nON INDEX 'logs-*'\nWHEN level = 'ERROR' AND service = 'payment'\nEVERY 5 SECONDS\nAS\nBEGIN\n    FOR doc IN @documents LOOP\n        CALL SLACK_SEND('#alerts', doc.message)\n    END LOOP\nEND TRIGGER\n</code></pre>"},{"location":"roadmap/#implementation-phases_1","title":"Implementation Phases","text":"Phase Deliverables Duration 1. Grammar &amp; Storage ANTLR rules, index mappings 1 week 2. Statement Handlers CREATE/ALTER/DROP/SHOW handlers 1 week 3. Execution Services Scheduler, polling, leader election 1 week 4. Testing &amp; Docs Unit tests, E2E notebooks 1 week <p>See Triggers &amp; Scheduling for full documentation.</p>"},{"location":"triggers-and-scheduling/","title":"Triggers &amp; Scheduling","text":"<p>Event-driven automation and scheduled job execution in elastic-script.</p>"},{"location":"triggers-and-scheduling/#overview","title":"Overview","text":"<p>elastic-script provides two mechanisms for automated execution:</p> Feature Description Use Case Scheduled Jobs Cron-based recurring execution Daily cleanup, hourly reports Event Triggers React to new documents in indices Alert on errors, process events <p>Both use a polling-based architecture that is: - \u2705 Non-invasive (no indexing performance impact) - \u2705 Scalable (configurable poll intervals) - \u2705 Reliable (checkpoint-based, survives restarts)</p>"},{"location":"triggers-and-scheduling/#scheduled-jobs","title":"Scheduled Jobs","text":""},{"location":"triggers-and-scheduling/#create-job","title":"CREATE JOB","text":"<pre><code>CREATE JOB job_name\nSCHEDULE 'cron_expression'\n[TIMEZONE 'timezone']\n[ENABLED true|false]\n[DESCRIPTION 'description']\nAS\nBEGIN\n    -- procedure body\nEND JOB\n</code></pre>"},{"location":"triggers-and-scheduling/#examples","title":"Examples","text":"<p>Daily cleanup at 2 AM: <pre><code>CREATE JOB daily_cleanup\nSCHEDULE '0 2 * * *'\nTIMEZONE 'UTC'\nDESCRIPTION 'Archive logs older than 30 days'\nAS\nBEGIN\n    DECLARE old_logs ARRAY\n    SET old_logs = ESQL_QUERY('FROM logs-* | WHERE @timestamp &lt; NOW() - 30 DAYS | LIMIT 10000')\n    PRINT 'Archiving ' || ARRAY_LENGTH(old_logs) || ' old logs'\n\n    FOR doc IN old_logs LOOP\n        CALL archive_to_s3(doc)\n    END LOOP\nEND JOB\n</code></pre></p> <p>Hourly health check: <pre><code>CREATE JOB hourly_health_check\nSCHEDULE '@hourly'\nAS\nBEGIN\n    DECLARE error_count NUMBER\n    SET error_count = ESQL_QUERY(\n        'FROM logs-* | WHERE level = ''ERROR'' AND @timestamp &gt; NOW() - 1 HOUR | STATS count = COUNT(*)'\n    )[0].count\n\n    IF error_count &gt; 100 THEN\n        CALL SLACK_SEND('#alerts', '\u26a0\ufe0f High error rate: ' || error_count || ' errors in last hour')\n    END IF\nEND JOB\n</code></pre></p>"},{"location":"triggers-and-scheduling/#schedule-patterns","title":"Schedule Patterns","text":"Pattern Description <code>* * * * *</code> Every minute <code>*/5 * * * *</code> Every 5 minutes <code>0 * * * *</code> Every hour at :00 <code>0 2 * * *</code> Daily at 2:00 AM <code>0 0 * * 0</code> Weekly on Sunday at midnight <code>0 0 1 * *</code> Monthly on 1<sup>st</sup> at midnight <code>@hourly</code> Alias for <code>0 * * * *</code> <code>@daily</code> Alias for <code>0 0 * * *</code> <code>@weekly</code> Alias for <code>0 0 * * 0</code> <code>@monthly</code> Alias for <code>0 0 1 * *</code>"},{"location":"triggers-and-scheduling/#managing-jobs","title":"Managing Jobs","text":"<pre><code>-- Disable a job\nALTER JOB daily_cleanup DISABLE\n\n-- Enable a job\nALTER JOB daily_cleanup ENABLE\n\n-- Change schedule\nALTER JOB daily_cleanup SCHEDULE '0 3 * * *'\n\n-- Delete a job\nDROP JOB daily_cleanup\n\n-- List all jobs\nSHOW JOBS\n\n-- Show job details\nSHOW JOB daily_cleanup\n\n-- Show execution history\nSHOW JOB RUNS FOR daily_cleanup\n</code></pre>"},{"location":"triggers-and-scheduling/#event-triggers","title":"Event Triggers","text":""},{"location":"triggers-and-scheduling/#create-trigger","title":"CREATE TRIGGER","text":"<pre><code>CREATE TRIGGER trigger_name\nON INDEX 'index_pattern'\n[WHEN condition]\n[EVERY interval]\n[ENABLED true|false]\n[DESCRIPTION 'description']\nAS\nBEGIN\n    -- @documents: array of matched documents\n    -- @document_count: number of matched documents\nEND TRIGGER\n</code></pre>"},{"location":"triggers-and-scheduling/#examples_1","title":"Examples","text":"<p>Alert on payment errors: <pre><code>CREATE TRIGGER on_payment_error\nON INDEX 'logs-*'\nWHEN level = 'ERROR' AND service = 'payment'\nEVERY 5 SECONDS\nDESCRIPTION 'Alert team on payment service errors'\nAS\nBEGIN\n    FOR doc IN @documents LOOP\n        CALL SLACK_SEND('#payment-alerts', \n            '\ud83d\udea8 Payment Error: ' || doc.message || ' | User: ' || doc.user_id\n        )\n\n        IF doc.error_code = 'PAYMENT_DECLINED' THEN\n            CALL PAGERDUTY_TRIGGER('Payment system issue', 'high', doc)\n        END IF\n    END LOOP\nEND TRIGGER\n</code></pre></p> <p>Security event monitoring: <pre><code>CREATE TRIGGER on_security_event\nON INDEX 'security-events-*'\nWHEN event_type IN ('login_failed', 'unauthorized_access')\nEVERY 10 SECONDS\nAS\nBEGIN\n    IF @document_count &gt; 10 THEN\n        CALL SLACK_SEND('#security', \n            '\ud83d\udd12 Security Alert: ' || @document_count || ' suspicious events'\n        )\n    END IF\n\n    FOR doc IN @documents LOOP\n        CALL log_security_event(doc)\n    END LOOP\nEND TRIGGER\n</code></pre></p> <p>Error spike detection: <pre><code>CREATE TRIGGER on_error_spike\nON INDEX 'logs-*'\nWHEN level = 'ERROR'\nEVERY 1 MINUTE\nAS\nBEGIN\n    IF @document_count &gt; 50 THEN\n        CALL SLACK_SEND('#alerts', \n            '\ud83d\udcc8 Error spike: ' || @document_count || ' errors in last minute'\n        )\n    END IF\nEND TRIGGER\n</code></pre></p>"},{"location":"triggers-and-scheduling/#poll-intervals","title":"Poll Intervals","text":"Interval Syntax 1 second <code>EVERY 1 SECOND</code> 5 seconds <code>EVERY 5 SECONDS</code> 30 seconds <code>EVERY 30 SECONDS</code> 1 minute <code>EVERY 1 MINUTE</code> 5 minutes <code>EVERY 5 MINUTES</code> <p>Default: <code>EVERY 30 SECONDS</code></p>"},{"location":"triggers-and-scheduling/#managing-triggers","title":"Managing Triggers","text":"<pre><code>-- Disable a trigger\nALTER TRIGGER on_payment_error DISABLE\n\n-- Enable a trigger\nALTER TRIGGER on_payment_error ENABLE\n\n-- Change poll interval\nALTER TRIGGER on_payment_error EVERY 10 SECONDS\n\n-- Delete a trigger\nDROP TRIGGER on_payment_error\n\n-- List all triggers\nSHOW TRIGGERS\n\n-- Show trigger details\nSHOW TRIGGER on_payment_error\n\n-- Show execution history\nSHOW TRIGGER RUNS FOR on_payment_error\n</code></pre>"},{"location":"triggers-and-scheduling/#architecture","title":"Architecture","text":""},{"location":"triggers-and-scheduling/#polling-based-design","title":"Polling-Based Design","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    TRIGGER POLLING                           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  .escript_triggers (stored trigger definition)               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u2502\n\u2502  \u2502 name: on_payment_error                                  \u2502\u2502\n\u2502  \u2502 index_pattern: logs-*                                   \u2502\u2502\n\u2502  \u2502 condition: level = 'ERROR' AND service = 'payment'      \u2502\u2502\n\u2502  \u2502 poll_interval: 5 seconds                                \u2502\u2502\n\u2502  \u2502 last_checkpoint: 2026-01-12T10:00:00Z                   \u2502\u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2502\n\u2502                              \u2502                               \u2502\n\u2502                              \u25bc                               \u2502\n\u2502  Every poll_interval:                                        \u2502\n\u2502  1. Query: FROM logs-* WHERE @timestamp &gt; last_checkpoint   \u2502\n\u2502  2. Filter: Apply WHEN condition                            \u2502\n\u2502  3. Execute: Trigger procedure with @documents bound        \u2502\n\u2502  4. Update: last_checkpoint = max(@timestamp)               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"triggers-and-scheduling/#leader-election","title":"Leader Election","text":"<p>Only one node executes jobs and triggers to prevent duplicates:</p> <ul> <li>Uses <code>.escript_leader</code> index with TTL-based lock</li> <li>Leader refreshes lock periodically</li> <li>If leader fails, another node takes over</li> </ul>"},{"location":"triggers-and-scheduling/#storage-indices","title":"Storage Indices","text":"Index Purpose <code>.escript_jobs</code> Job definitions <code>.escript_triggers</code> Trigger definitions <code>.escript_job_runs</code> Job execution history <code>.escript_trigger_runs</code> Trigger execution history <code>.escript_leader</code> Leader election lock"},{"location":"triggers-and-scheduling/#best-practices","title":"Best Practices","text":""},{"location":"triggers-and-scheduling/#1-choose-appropriate-intervals","title":"1. Choose Appropriate Intervals","text":"<pre><code>-- Critical alerts: short interval\nCREATE TRIGGER critical_alerts ON INDEX 'logs-*'\nWHEN level = 'CRITICAL'\nEVERY 1 SECOND  -- Fast response needed\n...\n\n-- Regular monitoring: longer interval\nCREATE TRIGGER daily_summary ON INDEX 'metrics-*'\nEVERY 5 MINUTES  -- Aggregated view is fine\n...\n</code></pre>"},{"location":"triggers-and-scheduling/#2-use-batch-processing","title":"2. Use Batch Processing","text":"<pre><code>-- Good: Process all documents together\nCREATE TRIGGER batch_processor\nON INDEX 'events-*'\nEVERY 30 SECONDS\nAS\nBEGIN\n    -- Process all at once\n    CALL bulk_process(@documents)\nEND TRIGGER\n\n-- Avoid: Individual processing with external calls\nCREATE TRIGGER slow_processor\nON INDEX 'events-*'\nEVERY 1 SECOND\nAS\nBEGIN\n    -- This could be slow with many documents\n    FOR doc IN @documents LOOP\n        CALL HTTP_POST('https://api.example.com', doc)  -- Slow!\n    END LOOP\nEND TRIGGER\n</code></pre>"},{"location":"triggers-and-scheduling/#3-handle-failures-gracefully","title":"3. Handle Failures Gracefully","text":"<pre><code>CREATE TRIGGER robust_handler\nON INDEX 'logs-*'\nWHEN level = 'ERROR'\nEVERY 10 SECONDS\nAS\nBEGIN\n    FOR doc IN @documents LOOP\n        TRY\n            CALL SLACK_SEND('#alerts', doc.message)\n        CATCH\n            PRINT 'Failed to send alert: ' || @error.message\n            -- Don't fail entire trigger\n        END TRY\n    END LOOP\nEND TRIGGER\n</code></pre>"},{"location":"development/architecture/","title":"Architecture","text":"<p>Technical overview of elastic-script internals.</p>"},{"location":"development/architecture/#system-overview","title":"System Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        Elasticsearch                             \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u2502\n\u2502  \u2502                    elastic-script Plugin                     \u2502\u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\u2502\n\u2502  \u2502  \u2502   Parser    \u2502  \u2502  Executor   \u2502  \u2502   Function Registry \u2502 \u2502\u2502\n\u2502  \u2502  \u2502  (ANTLR4)   \u2502\u2500\u2500\u2502             \u2502\u2500\u2500\u2502   (106 functions)   \u2502 \u2502\u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\u2502\n\u2502  \u2502         \u2502                \u2502                    \u2502             \u2502\u2502\n\u2502  \u2502         \u25bc                \u25bc                    \u25bc             \u2502\u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\u2502\n\u2502  \u2502  \u2502    AST      \u2502  \u2502  Handlers   \u2502  \u2502  External Services  \u2502 \u2502\u2502\n\u2502  \u2502  \u2502             \u2502  \u2502             \u2502  \u2502  (OpenAI, Slack...) \u2502 \u2502\u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2502\n\u2502                              \u2502                                   \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502          Elasticsearch Internal APIs                       \u2502  \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502  \u2502\n\u2502  \u2502  \u2502  ES|QL   \u2502  \u2502  Search  \u2502  \u2502  Index   \u2502  \u2502 Inference \u2502  \u2502  \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"development/architecture/#core-components","title":"Core Components","text":""},{"location":"development/architecture/#1-parser-antlr4","title":"1. Parser (ANTLR4)","text":"<p>The parser converts elastic-script source code into an Abstract Syntax Tree (AST).</p> <p>Grammar file: <code>elastic-script/src/main/java/org/elasticsearch/xpack/escript/parser/ElasticScript.g4</code></p> <pre><code>// Example grammar rules\nprocedure\n    : CREATE PROCEDURE identifier '(' parameterList? ')' \n      BEGIN statementList END PROCEDURE\n    ;\n\nstatement\n    : declareStatement\n    | setStatement\n    | ifStatement\n    | forStatement\n    | printStatement\n    | returnStatement\n    // ... more statement types\n    ;\n</code></pre> <p>Key classes:</p> <ul> <li><code>ElasticScriptLexer</code> - Tokenizes input</li> <li><code>ElasticScriptParser</code> - Builds parse tree</li> <li><code>ElasticScriptVisitor</code> - Traverses AST</li> </ul>"},{"location":"development/architecture/#2-statement-handlers","title":"2. Statement Handlers","text":"<p>Each statement type has a dedicated handler:</p> Handler Responsibility <code>DeclareStatementHandler</code> Variable declarations <code>SetStatementHandler</code> Variable assignments <code>IfStatementHandler</code> Conditional execution <code>ForStatementHandler</code> FOR loops <code>WhileStatementHandler</code> WHILE loops <code>PrintStatementHandler</code> Output statements <code>ReturnStatementHandler</code> Return values <code>TryCatchHandler</code> Exception handling <code>AsyncProcedureStatementHandler</code> Async execution <code>ParallelStatementHandler</code> Parallel execution <p>Location: <code>elastic-script/src/main/java/org/elasticsearch/xpack/escript/handlers/</code></p>"},{"location":"development/architecture/#3-function-registry","title":"3. Function Registry","text":"<p>Built-in functions are organized by category:</p> <pre><code>functions/builtin/\n\u251c\u2500\u2500 primitives/\n\u2502   \u251c\u2500\u2500 StringBuiltInFunctions.java\n\u2502   \u251c\u2500\u2500 NumberBuiltInFunctions.java\n\u2502   \u251c\u2500\u2500 ArrayBuiltInFunctions.java\n\u2502   \u251c\u2500\u2500 DateBuiltInFunctions.java\n\u2502   \u2514\u2500\u2500 DocumentBuiltInFunctions.java\n\u251c\u2500\u2500 datasources/\n\u2502   \u251c\u2500\u2500 ESFunctions.java\n\u2502   \u2514\u2500\u2500 EsqlBuiltInFunctions.java\n\u251c\u2500\u2500 ai/\n\u2502   \u251c\u2500\u2500 OpenAIFunctions.java\n\u2502   \u2514\u2500\u2500 InferenceFunctions.java\n\u2514\u2500\u2500 thirdparty/\n    \u251c\u2500\u2500 SlackFunctions.java\n    \u251c\u2500\u2500 PagerDutyFunctions.java\n    \u251c\u2500\u2500 KubernetesFunctions.java\n    \u2514\u2500\u2500 AWSFunctions.java\n</code></pre>"},{"location":"development/architecture/#4-execution-context","title":"4. Execution Context","text":"<p>The <code>ExecutionContext</code> maintains state during procedure execution:</p> <pre><code>public class ExecutionContext {\n    private final String executionId;          // Unique execution ID\n    private final Map&lt;String, Object&gt; variables;  // Variable storage\n    private final List&lt;String&gt; printOutput;    // PRINT output capture\n    private final long startTimeMs;            // Execution timing\n\n    // Methods\n    public void setVariable(String name, Object value);\n    public Object getVariable(String name);\n    public void addPrintOutput(String message);\n}\n</code></pre>"},{"location":"development/architecture/#5-procedure-executor","title":"5. Procedure Executor","text":"<p>The main execution engine that orchestrates statement execution:</p> <pre><code>public class ProcedureExecutor {\n    // Statement handlers\n    private final DeclareStatementHandler declareHandler;\n    private final SetStatementHandler setHandler;\n    private final IfStatementHandler ifHandler;\n    // ... more handlers\n\n    // Execute a procedure\n    public CompletableFuture&lt;Object&gt; executeProcedure(\n        String procedureName, \n        List&lt;Object&gt; arguments\n    );\n\n    // Execute individual statements\n    public CompletableFuture&lt;Object&gt; visitStatementAsync(\n        ParseTree statement, \n        ExecutionContext context\n    );\n}\n</code></pre>"},{"location":"development/architecture/#async-execution-model","title":"Async Execution Model","text":"<p>elastic-script uses Java's <code>CompletableFuture</code> for async execution:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Async Execution Flow                       \u2502\n\u2502                                                               \u2502\n\u2502  procedure_a()                                                \u2502\n\u2502       \u2502                                                       \u2502\n\u2502       \u25bc                                                       \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    ON_DONE    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    FINALLY            \u2502\n\u2502  \u2502 Execute \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 handler \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6 Done   \u2502\n\u2502  \u2502         \u2502               \u2502         \u2502                        \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                        \u2502\n\u2502       \u2502                                                       \u2502\n\u2502       \u2502 ON_FAIL            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                        \u2502\n\u2502       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 handler \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6 Done  \u2502\n\u2502                            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Key classes:</p> <ul> <li><code>ExecutionState</code> - Tracks async execution state</li> <li><code>ExecutionPipeline</code> - Manages continuation chain</li> <li><code>Continuation</code> - Single step in pipeline</li> <li><code>ExecutionRegistry</code> - Persists state to Elasticsearch</li> </ul>"},{"location":"development/architecture/#rest-api","title":"REST API","text":""},{"location":"development/architecture/#endpoint","title":"Endpoint","text":"<pre><code>POST /_escript\n{\n    \"query\": \"CALL my_procedure(arg1, arg2)\"\n}\n</code></pre>"},{"location":"development/architecture/#response","title":"Response","text":"<pre><code>{\n    \"result\": \"procedure return value\",\n    \"execution_id\": \"uuid\",\n    \"duration_ms\": 150,\n    \"output\": [\"PRINT statement 1\", \"PRINT statement 2\"]\n}\n</code></pre> <p>Handler: <code>RestRunEScriptAction.java</code></p>"},{"location":"development/architecture/#storage","title":"Storage","text":""},{"location":"development/architecture/#procedure-storage","title":"Procedure Storage","text":"<p>Procedures are stored in the <code>.elastic_script_procedures</code> index:</p> <pre><code>{\n    \"name\": \"my_procedure\",\n    \"source\": \"CREATE PROCEDURE my_procedure() BEGIN ... END PROCEDURE\",\n    \"parameters\": [...],\n    \"created_at\": \"2026-01-09T10:00:00Z\",\n    \"updated_at\": \"2026-01-09T10:00:00Z\"\n}\n</code></pre>"},{"location":"development/architecture/#execution-state-storage","title":"Execution State Storage","text":"<p>Async execution state is stored in <code>.escript_executions</code>:</p> <pre><code>{\n    \"execution_id\": \"exec-abc123\",\n    \"procedure_name\": \"my_procedure\",\n    \"status\": \"RUNNING\",\n    \"progress\": {\"percentage\": 50, \"message\": \"Processing...\"},\n    \"result\": null,\n    \"error\": null,\n    \"created_at\": \"2026-01-09T10:00:00Z\"\n}\n</code></pre>"},{"location":"development/architecture/#error-handling","title":"Error Handling","text":"<p>Errors bubble up through the async chain:</p> <pre><code>TRY block\n    \u2502\n    \u251c\u2500\u2500 Success \u2500\u2500\u25b6 Continue execution\n    \u2502\n    \u2514\u2500\u2500 Error \u2500\u2500\u25b6 CATCH block\n                      \u2502\n                      \u2514\u2500\u2500 FINALLY block (always runs)\n</code></pre>"},{"location":"development/architecture/#thread-safety","title":"Thread Safety","text":"<ul> <li>Each execution gets its own <code>ExecutionContext</code></li> <li>Variables are scoped to the execution</li> <li>No shared mutable state between executions</li> <li>Elasticsearch client handles connection pooling</li> </ul>"},{"location":"development/architecture/#performance-considerations","title":"Performance Considerations","text":"<ol> <li> <p>Function Registration: Currently happens on every execution. Optimize to register once at startup.</p> </li> <li> <p>ESQL Queries: Use <code>LIMIT</code> to avoid processing too much data.</p> </li> <li> <p>Async Execution: Long-running procedures should use async execution to avoid timeouts.</p> </li> <li> <p>Memory: Large result sets are streamed via cursors to avoid memory issues.</p> </li> </ol>"},{"location":"development/contributing/","title":"Contributing","text":"<p>Guide for contributing to elastic-script development.</p>"},{"location":"development/contributing/#getting-started","title":"Getting Started","text":""},{"location":"development/contributing/#prerequisites","title":"Prerequisites","text":"<ul> <li>Java 21+ - Required for Elasticsearch development</li> <li>Git - Version control</li> <li>Python 3.9+ - For notebooks and testing</li> </ul>"},{"location":"development/contributing/#clone-the-repository","title":"Clone the Repository","text":"<pre><code>git clone https://github.com/bahaaldine/elastic-script.git\ncd elastic-script\n\n# Initialize Elasticsearch submodule\ngit submodule init\ngit submodule update\n</code></pre>"},{"location":"development/contributing/#quick-start","title":"Quick Start","text":"<p>Use the quick-start script to set up everything:</p> <pre><code>./scripts/quick-start.sh\n</code></pre> <p>This will:</p> <ol> <li>\u2705 Build the elastic-script plugin</li> <li>\u2705 Start Elasticsearch with the plugin</li> <li>\u2705 Load sample data</li> <li>\u2705 Set up Jupyter notebooks</li> <li>\u2705 Launch the notebook server</li> </ol>"},{"location":"development/contributing/#development-workflow","title":"Development Workflow","text":""},{"location":"development/contributing/#1-make-your-changes","title":"1. Make Your Changes","text":"<p>Edit files in the <code>elastic-script/</code> directory:</p> <pre><code>elastic-script/\n\u251c\u2500\u2500 src/main/java/org/elasticsearch/xpack/escript/\n\u2502   \u251c\u2500\u2500 parser/           # ANTLR grammar\n\u2502   \u251c\u2500\u2500 handlers/         # Statement handlers\n\u2502   \u251c\u2500\u2500 functions/        # Built-in functions\n\u2502   \u251c\u2500\u2500 executors/        # Execution engine\n\u2502   \u2514\u2500\u2500 actions/          # REST API\n\u2514\u2500\u2500 src/test/java/        # Unit tests\n</code></pre>"},{"location":"development/contributing/#2-rebuild-the-plugin","title":"2. Rebuild the Plugin","text":"<p>After making changes:</p> <pre><code>cd elasticsearch\n./gradlew :elastic-script:build\n</code></pre>"},{"location":"development/contributing/#3-restart-elasticsearch","title":"3. Restart Elasticsearch","text":"<pre><code>./scripts/quick-start.sh --stop\n./scripts/quick-start.sh\n</code></pre>"},{"location":"development/contributing/#4-test-your-changes","title":"4. Test Your Changes","text":"<pre><code># Run unit tests\n./gradlew :elastic-script:test\n\n# Run E2E tests\ncd tests/e2e\npython run_notebook_tests.py\n</code></pre>"},{"location":"development/contributing/#adding-new-functions","title":"Adding New Functions","text":""},{"location":"development/contributing/#1-choose-the-right-category","title":"1. Choose the Right Category","text":"Category Location Example Functions String <code>primitives/StringBuiltInFunctions.java</code> LENGTH, UPPER, TRIM Number <code>primitives/NumberBuiltInFunctions.java</code> ABS, ROUND, SQRT Array <code>primitives/ArrayBuiltInFunctions.java</code> ARRAY_LENGTH, ARRAY_APPEND Date <code>primitives/DateBuiltInFunctions.java</code> CURRENT_DATE, DATE_ADD Document <code>primitives/DocumentBuiltInFunctions.java</code> DOCUMENT_GET, DOCUMENT_KEYS Elasticsearch <code>datasources/ESFunctions.java</code> ES_GET, ES_INDEX AI <code>ai/OpenAIFunctions.java</code> LLM_COMPLETE Integration <code>thirdparty/</code> SLACK_SEND, K8S_GET_PODS"},{"location":"development/contributing/#2-implement-the-function","title":"2. Implement the Function","text":"<pre><code>// In the appropriate *Functions.java file:\n\npublic static void register(BuiltInFunctionRegistry registry) {\n    registry.register(\"MY_FUNCTION\", (args) -&gt; {\n        // Validate arguments\n        if (args.size() != 2) {\n            throw new IllegalArgumentException(\n                \"MY_FUNCTION expects 2 arguments\"\n            );\n        }\n\n        String input = (String) args.get(0);\n        int count = ((Number) args.get(1)).intValue();\n\n        // Implement logic\n        return input.repeat(count);\n    });\n}\n</code></pre>"},{"location":"development/contributing/#3-add-documentation","title":"3. Add Documentation","text":"<p>Update <code>docs/functions/</code> with your new function:</p> <pre><code>### MY_FUNCTION\n\nRepeats a string a specified number of times.\n\n\\`\\`\\`sql\nDECLARE result STRING = MY_FUNCTION('hello', 3);\n-- Returns: 'hellohellohello'\n\\`\\`\\`\n\n**Syntax:** `MY_FUNCTION(string, count)`\n</code></pre>"},{"location":"development/contributing/#4-add-tests","title":"4. Add Tests","text":"<pre><code>// In src/test/java/.../MyFunctionTests.java\n\n@Test\npublic void testMyFunction() {\n    String result = executeProcedure(\"\"\"\n        CREATE PROCEDURE test()\n        BEGIN\n            RETURN MY_FUNCTION('hi', 2);\n        END PROCEDURE;\n        CALL test()\n        \"\"\");\n    assertEquals(\"hihi\", result);\n}\n</code></pre>"},{"location":"development/contributing/#adding-new-statement-types","title":"Adding New Statement Types","text":""},{"location":"development/contributing/#1-update-the-grammar","title":"1. Update the Grammar","text":"<p>Edit <code>ElasticScript.g4</code>:</p> <pre><code>statement\n    : declareStatement\n    | setStatement\n    | myNewStatement    // Add your statement type\n    // ...\n    ;\n\nmyNewStatement\n    : MY_KEYWORD expression ';'\n    ;\n\n// Add lexer token\nMY_KEYWORD: 'MY_KEYWORD';\n</code></pre>"},{"location":"development/contributing/#2-regenerate-parser","title":"2. Regenerate Parser","text":"<pre><code>cd elastic-script\n./gradlew :regen\n</code></pre>"},{"location":"development/contributing/#3-create-handler","title":"3. Create Handler","text":"<pre><code>// handlers/MyNewStatementHandler.java\n\npublic class MyNewStatementHandler {\n\n    public CompletableFuture&lt;Object&gt; handle(\n        MyNewStatementContext ctx,\n        ExecutionContext context,\n        ProcedureExecutor executor\n    ) {\n        // Implementation\n        return CompletableFuture.completedFuture(result);\n    }\n}\n</code></pre>"},{"location":"development/contributing/#4-register-in-executor","title":"4. Register in Executor","text":"<pre><code>// In ProcedureExecutor.java\n\nif (statement instanceof MyNewStatementContext) {\n    return myNewStatementHandler.handle(\n        (MyNewStatementContext) statement,\n        context,\n        this\n    );\n}\n</code></pre>"},{"location":"development/contributing/#code-style","title":"Code Style","text":""},{"location":"development/contributing/#java","title":"Java","text":"<ul> <li>Follow Elasticsearch coding conventions</li> <li>Use descriptive variable names</li> <li>Add Javadoc for public methods</li> <li>Handle errors with appropriate exceptions</li> </ul> <pre><code>/**\n * Executes a procedure by name.\n *\n * @param name the procedure name\n * @param args the procedure arguments\n * @return the procedure result\n * @throws ProcedureNotFoundException if procedure doesn't exist\n */\npublic CompletableFuture&lt;Object&gt; callProcedure(\n    String name, \n    List&lt;Object&gt; args\n) {\n    // Implementation\n}\n</code></pre>"},{"location":"development/contributing/#grammar","title":"Grammar","text":"<ul> <li>Use UPPER_CASE for keywords</li> <li>Use camelCase for rule names</li> <li>Add comments for complex rules</li> </ul>"},{"location":"development/contributing/#pull-request-process","title":"Pull Request Process","text":"<ol> <li>Fork the repository</li> <li>Create a branch for your feature/fix</li> <li>Write tests for your changes</li> <li>Update documentation as needed</li> <li>Submit a PR with a clear description</li> </ol>"},{"location":"development/contributing/#pr-checklist","title":"PR Checklist","text":"<ul> <li> Unit tests pass (<code>./gradlew :elastic-script:test</code>)</li> <li> E2E tests pass (<code>python tests/e2e/run_notebook_tests.py</code>)</li> <li> Documentation updated</li> <li> Code follows style guidelines</li> <li> Commit messages are clear</li> </ul>"},{"location":"development/contributing/#getting-help","title":"Getting Help","text":"<ul> <li>Issues: Open a GitHub issue for bugs or features</li> <li>Discussions: Use GitHub Discussions for questions</li> <li>Documentation: Check the docs at elastic-script docs</li> </ul>"},{"location":"development/testing/","title":"Testing","text":"<p>Comprehensive testing guide for elastic-script.</p>"},{"location":"development/testing/#test-types","title":"Test Types","text":"Type Location Purpose Unit Tests <code>src/test/java/</code> Test individual components E2E Tests <code>tests/e2e/</code> Test full user workflows Notebooks <code>notebooks/</code> Interactive testing"},{"location":"development/testing/#unit-tests","title":"Unit Tests","text":""},{"location":"development/testing/#running-unit-tests","title":"Running Unit Tests","text":"<pre><code># Run all unit tests\ncd elasticsearch\n./gradlew :elastic-script:test\n\n# Run specific test class\n./gradlew :elastic-script:test --tests \"LanguagePrimitivesTests\"\n\n# Run with verbose output\n./gradlew :elastic-script:test --info\n</code></pre>"},{"location":"development/testing/#test-categories","title":"Test Categories","text":""},{"location":"development/testing/#language-primitives-tests","title":"Language Primitives Tests","text":"<p>Tests for basic language features:</p> <pre><code>// LanguagePrimitivesTests.java\n\n@Test\npublic void testBooleanCaseInsensitivity() {\n    assertParseSuccess(\"DECLARE x BOOLEAN = TRUE;\");\n    assertParseSuccess(\"DECLARE y BOOLEAN = true;\");\n    assertParseSuccess(\"DECLARE z BOOLEAN = True;\");\n}\n\n@Test\npublic void testArrayLiterals() {\n    assertParseSuccess(\"DECLARE arr ARRAY = [1, 2, 3];\");\n    assertParseSuccess(\"DECLARE arr ARRAY = ['a', 'b', 'c'];\");\n}\n</code></pre>"},{"location":"development/testing/#syntax-parsing-tests","title":"Syntax Parsing Tests","text":"<p>Tests for grammar correctness:</p> <pre><code>// AsyncExecutionSyntaxTests.java\n\n@Test\npublic void testPipeDrivenSyntax() {\n    assertParseSuccess(\"\"\"\n        CREATE PROCEDURE test()\n        BEGIN\n            analyze_logs() | ON_DONE process_results(@result);\n        END PROCEDURE\n        \"\"\");\n}\n</code></pre>"},{"location":"development/testing/#handler-tests","title":"Handler Tests","text":"<p>Tests for statement execution:</p> <pre><code>// PrintStatementHandlerTests.java\n\n@Test\npublic void testPrintStatement() {\n    ExecutionContext ctx = new ExecutionContext();\n    handler.handle(parseTree, ctx, executor);\n\n    assertTrue(ctx.getPrintOutput().contains(\"Hello World\"));\n}\n</code></pre>"},{"location":"development/testing/#end-to-end-tests","title":"End-to-End Tests","text":"<p>E2E tests execute Jupyter notebooks to validate complete workflows.</p>"},{"location":"development/testing/#setup","title":"Setup","text":"<pre><code>cd tests/e2e\npip install -r requirements.txt\n</code></pre>"},{"location":"development/testing/#running-e2e-tests","title":"Running E2E Tests","text":"<pre><code># Run all notebook tests\npython run_notebook_tests.py\n\n# Run specific notebook\npython run_notebook_tests.py --notebook 01\n\n# Verbose output\npython run_notebook_tests.py --verbose\n\n# List available notebooks\npython run_notebook_tests.py --list\n</code></pre>"},{"location":"development/testing/#test-results","title":"Test Results","text":"<pre><code>\ud83d\udcd3 Running 6 notebook(s)...\n============================================================\n\n\u25b6\ufe0f  00-complete-reference.ipynb\n   \u2705 PASSED (4.3s)\n\n\u25b6\ufe0f  01-getting-started.ipynb\n   \u2705 PASSED (1.0s)\n\n\u25b6\ufe0f  02-esql-integration.ipynb\n   \u2705 PASSED (2.1s)\n\n\u23ed\ufe0f  03-ai-observability.ipynb - SKIPPED\n   Reason: Requires OpenAI API key\n\n\u25b6\ufe0f  04-async-execution.ipynb\n   \u2705 PASSED (1.5s)\n\n\u25b6\ufe0f  05-runbook-integrations.ipynb\n   \u2705 PASSED (1.0s)\n\n============================================================\n\ud83d\udcca TEST SUMMARY\n============================================================\nTotal: 6 passed, 0 failed (10.1s)\n\u2705 All tests passed!\n</code></pre>"},{"location":"development/testing/#skip-configuration","title":"Skip Configuration","text":"<p>Some tests may need to be skipped due to external dependencies:</p> <pre><code>// tests/e2e/skip_cells.json\n{\n  \"03-ai-observability.ipynb\": {\n    \"skip_all\": true,\n    \"reason\": \"Requires OpenAI API key and Elasticsearch license\"\n  },\n  \"04-async-execution.ipynb\": {\n    \"skip_cells\": [7],\n    \"reason\": \"STATUS storage bug - known issue\"\n  }\n}\n</code></pre>"},{"location":"development/testing/#writing-tests","title":"Writing Tests","text":""},{"location":"development/testing/#unit-test-template","title":"Unit Test Template","text":"<pre><code>package org.elasticsearch.xpack.escript.myfeature;\n\nimport org.elasticsearch.test.ESTestCase;\nimport org.junit.Before;\nimport org.junit.Test;\n\npublic class MyFeatureTests extends ESTestCase {\n\n    private MyFeature feature;\n\n    @Before\n    public void setUp() {\n        super.setUp();\n        feature = new MyFeature();\n    }\n\n    @Test\n    public void testBasicFunctionality() {\n        // Arrange\n        String input = \"test input\";\n\n        // Act\n        String result = feature.process(input);\n\n        // Assert\n        assertEquals(\"expected output\", result);\n    }\n\n    @Test\n    public void testErrorHandling() {\n        assertThrows(IllegalArgumentException.class, () -&gt; {\n            feature.process(null);\n        });\n    }\n}\n</code></pre>"},{"location":"development/testing/#testing-async-code","title":"Testing Async Code","text":"<pre><code>@Test\npublic void testAsyncExecution() throws Exception {\n    CompletableFuture&lt;Object&gt; future = executor.executeProcedure(\n        \"my_procedure\", \n        List.of(\"arg1\", \"arg2\")\n    );\n\n    Object result = future.get(10, TimeUnit.SECONDS);\n    assertEquals(\"expected\", result);\n}\n</code></pre>"},{"location":"development/testing/#testing-with-elasticsearch","title":"Testing with Elasticsearch","text":"<p>For tests that need Elasticsearch:</p> <pre><code>public class IntegrationTests extends ESIntegTestCase {\n\n    @Test\n    public void testWithElasticsearch() {\n        // Index a document\n        client().index(new IndexRequest(\"test-index\")\n            .source(\"field\", \"value\"))\n            .actionGet();\n\n        // Execute procedure\n        Object result = executeProcedure(\"CALL my_procedure()\");\n\n        // Verify\n        assertNotNull(result);\n    }\n}\n</code></pre>"},{"location":"development/testing/#test-coverage","title":"Test Coverage","text":""},{"location":"development/testing/#checking-coverage","title":"Checking Coverage","text":"<pre><code>./gradlew :elastic-script:test jacocoTestReport\n\n# View report\nopen elastic-script/build/reports/jacoco/test/html/index.html\n</code></pre>"},{"location":"development/testing/#coverage-goals","title":"Coverage Goals","text":"Component Target Handlers 80%+ Functions 90%+ Parser 70%+ Executor 80%+"},{"location":"development/testing/#continuous-integration","title":"Continuous Integration","text":"<p>Tests run automatically on:</p> <ul> <li>Pull request creation</li> <li>Push to main branch</li> </ul>"},{"location":"development/testing/#github-actions-workflow","title":"GitHub Actions Workflow","text":"<pre><code># .github/workflows/test.yml\nname: Tests\n\non: [push, pull_request]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n        with:\n          submodules: true\n\n      - name: Set up Java\n        uses: actions/setup-java@v3\n        with:\n          java-version: '21'\n\n      - name: Run tests\n        run: ./gradlew :elastic-script:test\n</code></pre>"},{"location":"development/testing/#debugging-tests","title":"Debugging Tests","text":""},{"location":"development/testing/#verbose-logging","title":"Verbose Logging","text":"<p>Enable debug logging in tests:</p> <pre><code>@Before\npublic void setUp() {\n    // Set log level\n    System.setProperty(\n        \"org.elasticsearch.xpack.escript.logging.level\", \n        \"DEBUG\"\n    );\n}\n</code></pre>"},{"location":"development/testing/#running-in-ide","title":"Running in IDE","text":"<ol> <li>Open the project in IntelliJ IDEA</li> <li>Navigate to test class</li> <li>Right-click \u2192 Run/Debug</li> </ol>"},{"location":"development/testing/#test-output","title":"Test Output","text":"<pre><code># Save test output to file\n./gradlew :elastic-script:test 2&gt;&amp;1 | tee test-output.log\n\n# Filter for failures\ngrep -A 20 \"FAILED\" test-output.log\n</code></pre>"},{"location":"development/testing/#common-issues","title":"Common Issues","text":""},{"location":"development/testing/#test-isolation","title":"Test Isolation","text":"<p>Ensure tests don't depend on each other:</p> <pre><code>@Before\npublic void setUp() {\n    // Fresh context for each test\n    context = new ExecutionContext();\n}\n\n@After\npublic void tearDown() {\n    // Cleanup\n    context = null;\n}\n</code></pre>"},{"location":"development/testing/#flaky-tests","title":"Flaky Tests","text":"<p>If tests fail intermittently:</p> <ol> <li>Check for timing issues</li> <li>Ensure proper async handling</li> <li>Verify test isolation</li> <li>Check for shared state</li> </ol>"},{"location":"development/testing/#external-dependencies","title":"External Dependencies","text":"<p>Mock external services:</p> <pre><code>@Test\npublic void testSlackIntegration() {\n    // Mock Slack client\n    SlackClient mockClient = mock(SlackClient.class);\n    when(mockClient.send(any())).thenReturn(true);\n\n    // Inject mock\n    slackHandler.setClient(mockClient);\n\n    // Test\n    handler.handle(\"SLACK_SEND('#test', 'message')\");\n\n    verify(mockClient).send(any());\n}\n</code></pre>"},{"location":"development/testing/#best-practices","title":"Best Practices","text":"<ol> <li>Test one thing - Each test should verify one behavior</li> <li>Clear naming - <code>testFeature_condition_expectedResult()</code></li> <li>Arrange-Act-Assert - Structure tests clearly</li> <li>No hardcoded waits - Use proper async handling</li> <li>Clean up resources - Prevent test pollution</li> <li>Document edge cases - Comment unusual test scenarios</li> </ol>"},{"location":"examples/data-pipeline/","title":"Data Pipeline Examples","text":"<p>ETL, data transformation, and processing workflows with elastic-script.</p>"},{"location":"examples/data-pipeline/#basic-data-transformation","title":"Basic Data Transformation","text":"<p>Transform and enrich documents:</p> <pre><code>CREATE PROCEDURE enrich_logs(source_index STRING, target_index STRING)\nBEGIN\n    PRINT '=== Enriching logs from ' || source_index || ' ===';\n\n    DECLARE logs CURSOR FOR ESQL_QUERY('\n        FROM ' || source_index || '\n        | LIMIT 1000\n    ');\n\n    DECLARE processed NUMBER = 0;\n    DECLARE errors NUMBER = 0;\n\n    FOR log IN logs LOOP\n        TRY\n            -- Get original fields\n            DECLARE message STRING = DOCUMENT_GET(log, 'message');\n            DECLARE level STRING = DOCUMENT_GET(log, 'level');\n            DECLARE timestamp DATE = DOCUMENT_GET(log, '@timestamp');\n\n            -- Enrich with computed fields\n            DECLARE enriched DOCUMENT = DOCUMENT_MERGE(log, {\n                \"message_length\": LENGTH(message),\n                \"level_normalized\": UPPER(level),\n                \"day_of_week\": EXTRACT_DAY(timestamp),\n                \"processed_at\": CURRENT_TIMESTAMP(),\n                \"processed_by\": \"elastic-script-pipeline\"\n            });\n\n            -- Classify severity\n            DECLARE severity NUMBER;\n            IF level = 'ERROR' THEN\n                SET severity = 1;\n            ELSEIF level = 'WARN' THEN\n                SET severity = 2;\n            ELSEIF level = 'INFO' THEN\n                SET severity = 3;\n            ELSE\n                SET severity = 4;\n            END IF;\n            SET enriched = DOCUMENT_MERGE(enriched, {\"severity_score\": severity});\n\n            -- Index to target\n            ES_INDEX(target_index, NULL, enriched);\n            SET processed = processed + 1;\n\n        CATCH error\n            SET errors = errors + 1;\n            PRINT 'Error processing document: ' || error;\n        END TRY;\n    END LOOP;\n\n    PRINT 'Processed: ' || processed || ', Errors: ' || errors;\n    RETURN processed;\nEND PROCEDURE;\n</code></pre>"},{"location":"examples/data-pipeline/#aggregation-pipeline","title":"Aggregation Pipeline","text":"<p>Compute and store aggregated metrics:</p> <pre><code>CREATE PROCEDURE aggregate_metrics(time_window STRING)\nBEGIN\n    PRINT '=== Computing Metrics (' || time_window || ') ===';\n\n    -- Aggregate by service\n    DECLARE service_metrics CURSOR FOR ESQL_QUERY('\n        FROM logs-*\n        | WHERE @timestamp &gt; NOW() - ' || time_window || '\n        | STATS \n            request_count = COUNT(*),\n            error_count = COUNT(*) WHERE level = \"ERROR\",\n            avg_response_time = AVG(response_time_ms)\n          BY service.name\n    ');\n\n    DECLARE timestamp DATE = CURRENT_TIMESTAMP();\n\n    FOR svc IN service_metrics LOOP\n        DECLARE service STRING = DOCUMENT_GET(svc, 'service.name');\n        DECLARE requests NUMBER = DOCUMENT_GET(svc, 'request_count');\n        DECLARE errors NUMBER = DOCUMENT_GET(svc, 'error_count');\n        DECLARE avg_time NUMBER = DOCUMENT_GET(svc, 'avg_response_time');\n\n        -- Calculate error rate\n        DECLARE error_rate NUMBER = 0;\n        IF requests &gt; 0 THEN\n            SET error_rate = ROUND((errors * 100.0) / requests, 2);\n        END IF;\n\n        -- Create metric document\n        DECLARE metric DOCUMENT = {\n            \"@timestamp\": timestamp,\n            \"service\": service,\n            \"time_window\": time_window,\n            \"metrics\": {\n                \"request_count\": requests,\n                \"error_count\": errors,\n                \"error_rate_percent\": error_rate,\n                \"avg_response_time_ms\": ROUND(avg_time, 2)\n            }\n        };\n\n        -- Store metric\n        ES_INDEX('service-metrics', NULL, metric);\n\n        PRINT service || ': ' || requests || ' requests, ' || error_rate || '% errors';\n    END LOOP;\nEND PROCEDURE;\n</code></pre>"},{"location":"examples/data-pipeline/#data-migration","title":"Data Migration","text":"<p>Migrate data between indices with transformation:</p> <pre><code>CREATE PROCEDURE migrate_index(\n    source_index STRING, \n    target_index STRING,\n    batch_size NUMBER\n)\nBEGIN\n    PRINT '=== Migrating ' || source_index || ' to ' || target_index || ' ===';\n\n    DECLARE total_migrated NUMBER = 0;\n    DECLARE batch_number NUMBER = 0;\n    DECLARE continue_migration BOOLEAN = TRUE;\n\n    WHILE continue_migration LOOP\n        SET batch_number = batch_number + 1;\n        DECLARE offset NUMBER = (batch_number - 1) * batch_size;\n\n        PRINT 'Processing batch ' || batch_number || ' (offset: ' || offset || ')';\n\n        DECLARE docs CURSOR FOR ESQL_QUERY('\n            FROM ' || source_index || '\n            | SORT @timestamp\n            | LIMIT ' || batch_size || '\n        ');\n\n        DECLARE batch_count NUMBER = 0;\n\n        FOR doc IN docs LOOP\n            -- Apply any transformations here\n            DECLARE transformed DOCUMENT = DOCUMENT_MERGE(doc, {\n                \"migrated_at\": CURRENT_TIMESTAMP(),\n                \"source_index\": source_index\n            });\n\n            -- Remove any fields you don't want\n            SET transformed = DOCUMENT_REMOVE(transformed, '_score');\n\n            ES_INDEX(target_index, NULL, transformed);\n            SET batch_count = batch_count + 1;\n        END LOOP;\n\n        SET total_migrated = total_migrated + batch_count;\n\n        -- Check if we've processed all documents\n        IF batch_count &lt; batch_size THEN\n            SET continue_migration = FALSE;\n        END IF;\n\n        PRINT '  Migrated ' || batch_count || ' documents (total: ' || total_migrated || ')';\n    END LOOP;\n\n    PRINT '';\n    PRINT 'Migration complete: ' || total_migrated || ' documents';\n    RETURN total_migrated;\nEND PROCEDURE;\n</code></pre>"},{"location":"examples/data-pipeline/#data-quality-checks","title":"Data Quality Checks","text":"<p>Validate data quality and generate reports:</p> <pre><code>CREATE PROCEDURE data_quality_check(index_name STRING)\nBEGIN\n    PRINT '\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557';\n    PRINT '\u2551        DATA QUALITY REPORT               \u2551';\n    PRINT '\u2551        Index: ' || RPAD(index_name, 26, ' ') || '\u2551';\n    PRINT '\u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d';\n    PRINT '';\n\n    DECLARE issues ARRAY = [];\n\n    -- Check 1: Document count\n    DECLARE count_result CURSOR FOR ESQL_QUERY('\n        FROM ' || index_name || ' | STATS count = COUNT(*)\n    ');\n    DECLARE total_docs NUMBER = 0;\n    FOR row IN count_result LOOP\n        SET total_docs = DOCUMENT_GET(row, 'count');\n    END LOOP;\n    PRINT '\ud83d\udcca Total documents: ' || total_docs;\n\n    -- Check 2: Missing required fields\n    DECLARE missing_timestamp CURSOR FOR ESQL_QUERY('\n        FROM ' || index_name || '\n        | WHERE @timestamp IS NULL\n        | STATS count = COUNT(*)\n    ');\n    FOR row IN missing_timestamp LOOP\n        DECLARE missing NUMBER = DOCUMENT_GET(row, 'count');\n        IF missing &gt; 0 THEN\n            PRINT '\u26a0\ufe0f  Missing @timestamp: ' || missing || ' documents';\n            SET issues = ARRAY_APPEND(issues, 'Missing @timestamp: ' || missing);\n        ELSE\n            PRINT '\u2705 All documents have @timestamp';\n        END IF;\n    END LOOP;\n\n    -- Check 3: Date range\n    DECLARE date_range CURSOR FOR ESQL_QUERY('\n        FROM ' || index_name || '\n        | STATS \n            oldest = MIN(@timestamp),\n            newest = MAX(@timestamp)\n    ');\n    FOR row IN date_range LOOP\n        PRINT '\ud83d\udcc5 Date range: ' || DOCUMENT_GET(row, 'oldest') \n            || ' to ' || DOCUMENT_GET(row, 'newest');\n    END LOOP;\n\n    -- Check 4: Field cardinality\n    DECLARE level_dist CURSOR FOR ESQL_QUERY('\n        FROM ' || index_name || '\n        | STATS count = COUNT(*) BY level\n    ');\n    PRINT '';\n    PRINT '\ud83d\udcca Level distribution:';\n    FOR row IN level_dist LOOP\n        DECLARE level STRING = DOCUMENT_GET(row, 'level');\n        DECLARE count NUMBER = DOCUMENT_GET(row, 'count');\n        DECLARE pct NUMBER = ROUND((count * 100.0) / total_docs, 1);\n        PRINT '   ' || RPAD(level, 10, ' ') || count || ' (' || pct || '%)';\n    END LOOP;\n\n    -- Summary\n    PRINT '';\n    IF ARRAY_LENGTH(issues) = 0 THEN\n        PRINT '\u2705 No data quality issues found';\n    ELSE\n        PRINT '\u26a0\ufe0f  Found ' || ARRAY_LENGTH(issues) || ' issues:';\n        FOR i IN 0..(ARRAY_LENGTH(issues)-1) LOOP\n            PRINT '   \u2022 ' || issues[i];\n        END LOOP;\n    END IF;\n\n    RETURN issues;\nEND PROCEDURE;\n</code></pre>"},{"location":"examples/data-pipeline/#etl-with-external-apis","title":"ETL with External APIs","text":"<p>Fetch external data and load into Elasticsearch:</p> <pre><code>CREATE PROCEDURE load_external_data(api_url STRING, target_index STRING)\nBEGIN\n    PRINT '=== Loading data from external API ===';\n    PRINT 'Source: ' || api_url;\n\n    TRY\n        -- Fetch data from API\n        DECLARE response STRING = HTTP_GET(api_url);\n\n        -- Parse JSON response (assuming array of objects)\n        -- Note: Actual JSON parsing implementation may vary\n        DECLARE items ARRAY = JSON_PARSE(response);\n\n        PRINT 'Received ' || ARRAY_LENGTH(items) || ' items';\n\n        DECLARE loaded NUMBER = 0;\n        FOR i IN 0..(ARRAY_LENGTH(items)-1) LOOP\n            DECLARE item DOCUMENT = items[i];\n\n            -- Add metadata\n            SET item = DOCUMENT_MERGE(item, {\n                \"loaded_at\": CURRENT_TIMESTAMP(),\n                \"source_url\": api_url\n            });\n\n            ES_INDEX(target_index, NULL, item);\n            SET loaded = loaded + 1;\n        END LOOP;\n\n        PRINT 'Loaded ' || loaded || ' documents to ' || target_index;\n        RETURN loaded;\n\n    CATCH error\n        PRINT 'Failed to load data: ' || error;\n        RETURN 0;\n    END TRY;\nEND PROCEDURE;\n</code></pre>"},{"location":"examples/data-pipeline/#scheduled-cleanup","title":"Scheduled Cleanup","text":"<p>Remove old data based on retention policy:</p> <pre><code>CREATE PROCEDURE cleanup_old_data(index_pattern STRING, retention_days NUMBER)\nBEGIN\n    DECLARE cutoff DATE = DATE_SUB(CURRENT_DATE(), retention_days);\n\n    PRINT '=== Data Cleanup ===';\n    PRINT 'Index pattern: ' || index_pattern;\n    PRINT 'Retention: ' || retention_days || ' days';\n    PRINT 'Cutoff date: ' || cutoff;\n\n    -- Find old documents\n    DECLARE old_docs CURSOR FOR ESQL_QUERY('\n        FROM ' || index_pattern || '\n        | WHERE @timestamp &lt; \"' || cutoff || '\"\n        | STATS count = COUNT(*), indices = VALUES(_index)\n    ');\n\n    FOR row IN old_docs LOOP\n        DECLARE count NUMBER = DOCUMENT_GET(row, 'count');\n        DECLARE indices ARRAY = DOCUMENT_GET(row, 'indices');\n\n        IF count &gt; 0 THEN\n            PRINT 'Found ' || count || ' documents to clean up';\n            PRINT 'Affected indices: ' || ARRAY_JOIN(indices, ', ');\n\n            -- In production, you would delete these documents\n            -- ES_DELETE_BY_QUERY(index_pattern, '@timestamp &lt; \"' || cutoff || '\"');\n\n            PRINT '\u26a0\ufe0f  Cleanup would delete ' || count || ' documents';\n            PRINT '   (Dry run - no documents deleted)';\n        ELSE\n            PRINT '\u2705 No documents older than retention period';\n        END IF;\n    END LOOP;\nEND PROCEDURE;\n</code></pre>"},{"location":"examples/data-pipeline/#usage","title":"Usage","text":"<pre><code>-- Enrich and transform logs\nCALL enrich_logs('raw-logs', 'enriched-logs');\n\n-- Compute hourly metrics\nCALL aggregate_metrics('1 hour');\n\n-- Migrate index with transformation\nCALL migrate_index('logs-v1', 'logs-v2', 500);\n\n-- Run data quality checks\nCALL data_quality_check('logs-sample');\n\n-- Cleanup old data (dry run)\nCALL cleanup_old_data('logs-*', 90);\n</code></pre>"},{"location":"examples/incident-response/","title":"Incident Response Examples","text":"<p>Automated incident detection, notification, and remediation with elastic-script.</p>"},{"location":"examples/incident-response/#basic-alert-handler","title":"Basic Alert Handler","text":"<p>Detect and notify on critical errors:</p> <pre><code>CREATE PROCEDURE check_critical_errors()\nBEGIN\n    -- Check for critical errors in last 5 minutes\n    DECLARE errors CURSOR FOR ESQL_QUERY('\n        FROM logs-*\n        | WHERE level = \"ERROR\" AND @timestamp &gt; NOW() - 5 minutes\n        | STATS count = COUNT(*) BY service.name\n        | WHERE count &gt; 10\n    ');\n\n    FOR svc IN errors LOOP\n        DECLARE service STRING = DOCUMENT_GET(svc, 'service.name');\n        DECLARE count NUMBER = DOCUMENT_GET(svc, 'count');\n\n        PRINT '\ud83d\udea8 ALERT: ' || service || ' has ' || count || ' errors';\n\n        -- Notify via Slack\n        SLACK_SEND('#alerts', '\ud83d\udea8 *' || service || '* has ' || count || ' errors in the last 5 minutes');\n    END LOOP;\nEND PROCEDURE;\n</code></pre>"},{"location":"examples/incident-response/#full-incident-workflow","title":"Full Incident Workflow","text":"<p>Complete incident lifecycle management:</p> <pre><code>CREATE PROCEDURE handle_incident(service STRING, description STRING, severity STRING)\nBEGIN\n    DECLARE incident_id STRING = 'INC-' || SUBSTR(CURRENT_TIMESTAMP(), 1, 10);\n\n    PRINT '=== Creating Incident: ' || incident_id || ' ===';\n\n    -- 1. Log the incident\n    DECLARE incident DOCUMENT = {\n        \"incident_id\": incident_id,\n        \"service\": service,\n        \"description\": description,\n        \"severity\": severity,\n        \"status\": \"open\",\n        \"created_at\": CURRENT_TIMESTAMP()\n    };\n    ES_INDEX('incidents', incident_id, incident);\n\n    -- 2. Create PagerDuty incident\n    DECLARE pd_key STRING;\n    TRY\n        SET pd_key = PAGERDUTY_CREATE_INCIDENT(\n            '[' || severity || '] ' || service || ': ' || description,\n            severity,\n            service\n        );\n        PRINT 'PagerDuty incident created: ' || pd_key;\n    CATCH error\n        PRINT 'Warning: PagerDuty notification failed: ' || error;\n    END TRY;\n\n    -- 3. Notify Slack\n    DECLARE slack_message STRING = '\ud83d\udea8 *New Incident: ' || incident_id || '*\\n'\n        || '\u2022 Service: ' || service || '\\n'\n        || '\u2022 Severity: ' || severity || '\\n'\n        || '\u2022 Description: ' || description;\n\n    TRY\n        SLACK_SEND('#incidents', slack_message);\n    CATCH error\n        PRINT 'Warning: Slack notification failed: ' || error;\n    END TRY;\n\n    -- 4. Gather context\n    PRINT 'Gathering incident context...';\n    DECLARE recent_errors CURSOR FOR ESQL_QUERY('\n        FROM logs-*\n        | WHERE service.name = \"' || service || '\" AND level = \"ERROR\"\n        | SORT @timestamp DESC\n        | LIMIT 10\n    ');\n\n    DECLARE context_messages ARRAY = [];\n    FOR error IN recent_errors LOOP\n        SET context_messages = ARRAY_APPEND(context_messages, \n            DOCUMENT_GET(error, '@timestamp') || ': ' || DOCUMENT_GET(error, 'message'));\n    END LOOP;\n\n    -- 5. Update incident with context\n    ES_UPDATE('incidents', incident_id, {\n        \"pagerduty_key\": pd_key,\n        \"context\": {\n            \"recent_errors\": context_messages\n        }\n    });\n\n    RETURN incident_id;\nEND PROCEDURE;\n</code></pre>"},{"location":"examples/incident-response/#auto-remediation","title":"Auto-Remediation","text":"<p>Automated recovery actions:</p> <pre><code>CREATE PROCEDURE auto_remediate(service STRING, issue_type STRING)\nBEGIN\n    PRINT '=== Auto-Remediation for ' || service || ' ===';\n    PRINT 'Issue type: ' || issue_type;\n\n    DECLARE action_taken STRING = 'none';\n    DECLARE success BOOLEAN = FALSE;\n\n    TRY\n        IF issue_type = 'high_memory' THEN\n            -- Restart pods with high memory\n            PRINT 'Action: Restarting deployment...';\n            K8S_RESTART_DEPLOYMENT('production', service);\n            SET action_taken = 'deployment_restart';\n            SET success = TRUE;\n\n        ELSEIF issue_type = 'high_load' THEN\n            -- Scale up the service\n            PRINT 'Action: Scaling up deployment...';\n            DECLARE current_pods ARRAY = K8S_GET_PODS('production');\n            DECLARE current_count NUMBER = ARRAY_LENGTH(current_pods);\n            DECLARE new_count NUMBER = current_count + 2;\n\n            K8S_SCALE_DEPLOYMENT('production', service, new_count);\n            SET action_taken = 'scale_up_to_' || new_count;\n            SET success = TRUE;\n\n        ELSEIF issue_type = 'connection_pool_exhausted' THEN\n            -- Restart to reset connections\n            PRINT 'Action: Rolling restart to reset connections...';\n            K8S_RESTART_DEPLOYMENT('production', service);\n            SET action_taken = 'connection_reset';\n            SET success = TRUE;\n\n        ELSE\n            PRINT 'No automatic remediation available for: ' || issue_type;\n            SET action_taken = 'manual_required';\n        END IF;\n\n    CATCH error\n        PRINT 'Remediation failed: ' || error;\n        SET action_taken = 'failed: ' || error;\n    END TRY;\n\n    -- Log remediation attempt\n    DECLARE log DOCUMENT = {\n        \"service\": service,\n        \"issue_type\": issue_type,\n        \"action_taken\": action_taken,\n        \"success\": success,\n        \"timestamp\": CURRENT_TIMESTAMP()\n    };\n    ES_INDEX('remediation-logs', NULL, log);\n\n    -- Notify team\n    IF success THEN\n        SLACK_SEND('#incidents', '\u2705 Auto-remediation for *' || service || '*: ' || action_taken);\n    ELSE\n        SLACK_SEND('#incidents', '\u274c Auto-remediation failed for *' || service || '* - manual intervention required');\n    END IF;\n\n    RETURN action_taken;\nEND PROCEDURE;\n</code></pre>"},{"location":"examples/incident-response/#escalation-workflow","title":"Escalation Workflow","text":"<p>Progressive escalation based on severity and time:</p> <pre><code>CREATE PROCEDURE escalate_incident(incident_id STRING)\nBEGIN\n    -- Get incident details\n    DECLARE incident DOCUMENT = ES_GET('incidents', incident_id);\n    DECLARE status STRING = DOCUMENT_GET(incident, 'status');\n    DECLARE severity STRING = DOCUMENT_GET(incident, 'severity');\n    DECLARE created DATE = DOCUMENT_GET(incident, 'created_at');\n    DECLARE escalation_level NUMBER = DOCUMENT_GET(incident, 'escalation_level');\n\n    IF escalation_level = NULL THEN\n        SET escalation_level = 0;\n    END IF;\n\n    IF status = 'resolved' THEN\n        PRINT 'Incident already resolved, no escalation needed';\n        RETURN 'resolved';\n    END IF;\n\n    -- Calculate age in minutes\n    DECLARE age_minutes NUMBER = DATE_DIFF(CURRENT_TIMESTAMP(), created) * 24 * 60;\n\n    PRINT 'Incident ' || incident_id || ' age: ' || age_minutes || ' minutes';\n    PRINT 'Current escalation level: ' || escalation_level;\n\n    -- Determine if escalation is needed\n    DECLARE escalate BOOLEAN = FALSE;\n\n    IF severity = 'critical' AND age_minutes &gt; 15 AND escalation_level &lt; 3 THEN\n        SET escalate = TRUE;\n    ELSEIF severity = 'high' AND age_minutes &gt; 30 AND escalation_level &lt; 2 THEN\n        SET escalate = TRUE;\n    ELSEIF severity = 'medium' AND age_minutes &gt; 60 AND escalation_level &lt; 1 THEN\n        SET escalate = TRUE;\n    END IF;\n\n    IF escalate THEN\n        SET escalation_level = escalation_level + 1;\n\n        -- Notify escalation\n        DECLARE escalation_message STRING = '\u2b06\ufe0f *Escalation Level ' || escalation_level || '*\\n'\n            || 'Incident: ' || incident_id || '\\n'\n            || 'Severity: ' || severity || '\\n'\n            || 'Age: ' || age_minutes || ' minutes\\n'\n            || 'Awaiting response...';\n\n        -- Different channels for different levels\n        IF escalation_level = 1 THEN\n            SLACK_SEND('#oncall-primary', escalation_message);\n        ELSEIF escalation_level = 2 THEN\n            SLACK_SEND('#oncall-secondary', escalation_message);\n            SLACK_SEND('#engineering-leads', escalation_message);\n        ELSE\n            SLACK_SEND('#incidents-critical', escalation_message);\n            SLACK_SEND('#leadership', escalation_message);\n        END IF;\n\n        -- Update incident\n        ES_UPDATE('incidents', incident_id, {\n            \"escalation_level\": escalation_level,\n            \"last_escalation\": CURRENT_TIMESTAMP()\n        });\n\n        PRINT 'Escalated to level ' || escalation_level;\n    ELSE\n        PRINT 'No escalation needed at this time';\n    END IF;\n\n    RETURN escalation_level;\nEND PROCEDURE;\n</code></pre>"},{"location":"examples/incident-response/#post-incident-report-generation","title":"Post-Incident Report Generation","text":"<p>Generate incident summary with AI:</p> <pre><code>CREATE PROCEDURE generate_postmortem(incident_id STRING)\nBEGIN\n    -- Get incident data\n    DECLARE incident DOCUMENT = ES_GET('incidents', incident_id);\n    DECLARE service STRING = DOCUMENT_GET(incident, 'service');\n    DECLARE description STRING = DOCUMENT_GET(incident, 'description');\n    DECLARE created DATE = DOCUMENT_GET(incident, 'created_at');\n    DECLARE resolved DATE = DOCUMENT_GET(incident, 'resolved_at');\n\n    -- Get related logs\n    DECLARE logs CURSOR FOR ESQL_QUERY('\n        FROM logs-*\n        | WHERE service.name = \"' || service || '\"\n          AND @timestamp &gt;= \"' || created || '\"\n          AND @timestamp &lt;= \"' || resolved || '\"\n          AND level IN (\"ERROR\", \"WARN\")\n        | SORT @timestamp\n        | LIMIT 50\n    ');\n\n    DECLARE log_entries ARRAY = [];\n    FOR log IN logs LOOP\n        DECLARE entry STRING = DOCUMENT_GET(log, '@timestamp') \n            || ' [' || DOCUMENT_GET(log, 'level') || '] '\n            || DOCUMENT_GET(log, 'message');\n        SET log_entries = ARRAY_APPEND(log_entries, entry);\n    END LOOP;\n\n    -- Generate postmortem with AI\n    DECLARE prompt STRING = 'Generate a post-incident report (postmortem) for this incident:\n\nIncident ID: ' || incident_id || '\nService: ' || service || '\nDescription: ' || description || '\nStart Time: ' || created || '\nEnd Time: ' || resolved || '\n\nRelated log entries:\n' || ARRAY_JOIN(log_entries, '\\n') || '\n\nPlease include:\n1. Executive Summary\n2. Timeline of Events  \n3. Root Cause Analysis\n4. Impact Assessment\n5. Action Items for Prevention\n\nFormat as Markdown.';\n\n    DECLARE postmortem STRING = LLM_COMPLETE(prompt);\n\n    -- Store postmortem\n    ES_UPDATE('incidents', incident_id, {\n        \"postmortem\": postmortem,\n        \"postmortem_generated_at\": CURRENT_TIMESTAMP()\n    });\n\n    PRINT '=== Post-Incident Report ===';\n    PRINT postmortem;\n\n    RETURN postmortem;\nEND PROCEDURE;\n</code></pre>"},{"location":"examples/incident-response/#usage","title":"Usage","text":"<pre><code>-- Create an incident\nCALL handle_incident('api-gateway', 'Connection timeout errors spiking', 'high');\n\n-- Attempt auto-remediation\nCALL auto_remediate('api-gateway', 'connection_pool_exhausted');\n\n-- Check for escalation (run periodically)\nCALL escalate_incident('INC-2026-01-09');\n\n-- Generate post-incident report\nCALL generate_postmortem('INC-2026-01-09');\n</code></pre>"},{"location":"examples/log-analysis/","title":"Log Analysis Examples","text":"<p>Real-world examples of log analysis and monitoring with elastic-script.</p>"},{"location":"examples/log-analysis/#basic-error-counting","title":"Basic Error Counting","text":"<p>Count errors by service over the last hour:</p> <pre><code>CREATE PROCEDURE count_errors_by_service()\nBEGIN\n    DECLARE results CURSOR FOR ESQL_QUERY('\n        FROM logs-*\n        | WHERE level = \"ERROR\" AND @timestamp &gt; NOW() - 1 hour\n        | STATS error_count = COUNT(*) BY service.name\n        | SORT error_count DESC\n        | LIMIT 20\n    ');\n\n    PRINT '=== Errors by Service (Last Hour) ===';\n\n    FOR row IN results LOOP\n        DECLARE service STRING = DOCUMENT_GET(row, 'service.name');\n        DECLARE count NUMBER = DOCUMENT_GET(row, 'error_count');\n        PRINT service || ': ' || count || ' errors';\n    END LOOP;\nEND PROCEDURE;\n</code></pre>"},{"location":"examples/log-analysis/#error-pattern-detection","title":"Error Pattern Detection","text":"<p>Identify recurring error patterns:</p> <pre><code>CREATE PROCEDURE find_error_patterns()\nBEGIN\n    -- Get recent errors\n    DECLARE errors CURSOR FOR ESQL_QUERY('\n        FROM logs-*\n        | WHERE level = \"ERROR\"\n        | SORT @timestamp DESC\n        | LIMIT 100\n    ');\n\n    -- Group by message pattern (first 50 chars)\n    DECLARE patterns DOCUMENT = {};\n\n    FOR error IN errors LOOP\n        DECLARE msg STRING = DOCUMENT_GET(error, 'message');\n        DECLARE pattern STRING = SUBSTR(msg, 1, 50);\n\n        -- Count occurrences\n        IF DOCUMENT_CONTAINS(patterns, pattern) THEN\n            DECLARE current NUMBER = DOCUMENT_GET(patterns, pattern);\n            SET patterns = DOCUMENT_MERGE(patterns, {pattern: current + 1});\n        ELSE\n            SET patterns = DOCUMENT_MERGE(patterns, {pattern: 1});\n        END IF;\n    END LOOP;\n\n    PRINT '=== Error Patterns ===';\n    DECLARE keys ARRAY = DOCUMENT_KEYS(patterns);\n    FOR i IN 0..(ARRAY_LENGTH(keys)-1) LOOP\n        DECLARE pattern STRING = keys[i];\n        DECLARE count NUMBER = DOCUMENT_GET(patterns, pattern);\n        IF count &gt; 3 THEN  -- Only show repeated patterns\n            PRINT count || 'x: ' || pattern || '...';\n        END IF;\n    END LOOP;\nEND PROCEDURE;\n</code></pre>"},{"location":"examples/log-analysis/#ai-powered-error-summarization","title":"AI-Powered Error Summarization","text":"<p>Use LLM to summarize and categorize errors:</p> <pre><code>CREATE PROCEDURE summarize_errors()\nBEGIN\n    -- Collect recent errors\n    DECLARE errors CURSOR FOR ESQL_QUERY('\n        FROM logs-*\n        | WHERE level = \"ERROR\"\n        | SORT @timestamp DESC\n        | LIMIT 20\n    ');\n\n    DECLARE messages ARRAY = [];\n    FOR error IN errors LOOP\n        DECLARE msg STRING = DOCUMENT_GET(error, 'message');\n        SET messages = ARRAY_APPEND(messages, msg);\n    END LOOP;\n\n    IF ARRAY_LENGTH(messages) = 0 THEN\n        PRINT 'No errors found in the specified time range.';\n        RETURN 'No errors';\n    END IF;\n\n    -- Create AI prompt\n    DECLARE prompt STRING = 'Analyze these error messages and provide:\n1. A brief summary of the main issues\n2. Likely root causes\n3. Recommended actions\n\nError messages:\n' || ARRAY_JOIN(messages, '\\n');\n\n    DECLARE summary STRING = LLM_COMPLETE(prompt);\n\n    PRINT '=== AI Error Analysis ===';\n    PRINT summary;\n\n    RETURN summary;\nEND PROCEDURE;\n</code></pre>"},{"location":"examples/log-analysis/#anomaly-detection","title":"Anomaly Detection","text":"<p>Detect unusual log patterns:</p> <pre><code>CREATE PROCEDURE detect_anomalies()\nBEGIN\n    -- Get hourly error rates for the past day\n    DECLARE hourly CURSOR FOR ESQL_QUERY('\n        FROM logs-*\n        | WHERE @timestamp &gt; NOW() - 24 hours\n        | EVAL hour = DATE_TRUNC(1 hour, @timestamp)\n        | STATS error_count = COUNT(*) BY hour, level\n        | WHERE level = \"ERROR\"\n        | SORT hour\n    ');\n\n    -- Calculate baseline\n    DECLARE counts ARRAY = [];\n    DECLARE hours ARRAY = [];\n\n    FOR row IN hourly LOOP\n        SET counts = ARRAY_APPEND(counts, DOCUMENT_GET(row, 'error_count'));\n        SET hours = ARRAY_APPEND(hours, DOCUMENT_GET(row, 'hour'));\n    END LOOP;\n\n    -- Simple anomaly detection: flag if &gt; 2x average\n    DECLARE total NUMBER = 0;\n    FOR i IN 0..(ARRAY_LENGTH(counts)-1) LOOP\n        SET total = total + counts[i];\n    END LOOP;\n    DECLARE avg NUMBER = total / ARRAY_LENGTH(counts);\n    DECLARE threshold NUMBER = avg * 2;\n\n    PRINT '=== Anomaly Detection ===';\n    PRINT 'Average hourly errors: ' || ROUND(avg, 1);\n    PRINT 'Anomaly threshold: ' || ROUND(threshold, 1);\n    PRINT '';\n\n    FOR i IN 0..(ARRAY_LENGTH(counts)-1) LOOP\n        IF counts[i] &gt; threshold THEN\n            PRINT '\u26a0\ufe0f ANOMALY at ' || hours[i] || ': ' || counts[i] || ' errors';\n        END IF;\n    END LOOP;\nEND PROCEDURE;\n</code></pre>"},{"location":"examples/log-analysis/#service-health-dashboard","title":"Service Health Dashboard","text":"<p>Create a real-time health summary:</p> <pre><code>CREATE PROCEDURE service_health_check()\nBEGIN\n    PRINT '\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557';\n    PRINT '\u2551        SERVICE HEALTH DASHBOARD          \u2551';\n    PRINT '\u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d';\n    PRINT '';\n\n    -- Get service metrics\n    DECLARE metrics CURSOR FOR ESQL_QUERY('\n        FROM logs-*\n        | WHERE @timestamp &gt; NOW() - 5 minutes\n        | STATS \n            total = COUNT(*),\n            errors = COUNT(*) WHERE level = \"ERROR\",\n            warnings = COUNT(*) WHERE level = \"WARN\"\n          BY service.name\n        | EVAL error_rate = ROUND(errors * 100.0 / total, 1)\n        | SORT error_rate DESC\n    ');\n\n    FOR svc IN metrics LOOP\n        DECLARE name STRING = DOCUMENT_GET(svc, 'service.name');\n        DECLARE error_rate NUMBER = DOCUMENT_GET(svc, 'error_rate');\n        DECLARE errors NUMBER = DOCUMENT_GET(svc, 'errors');\n\n        -- Determine status icon\n        DECLARE status STRING;\n        IF error_rate &gt; 10 THEN\n            SET status = '\ud83d\udd34 CRITICAL';\n        ELSEIF error_rate &gt; 5 THEN\n            SET status = '\ud83d\udfe1 WARNING';\n        ELSE\n            SET status = '\ud83d\udfe2 HEALTHY';\n        END IF;\n\n        PRINT status || ' ' || name;\n        PRINT '    Error Rate: ' || error_rate || '% (' || errors || ' errors)';\n    END LOOP;\nEND PROCEDURE;\n</code></pre>"},{"location":"examples/log-analysis/#scheduled-log-cleanup","title":"Scheduled Log Cleanup","text":"<p>Identify old indices for cleanup:</p> <pre><code>CREATE PROCEDURE identify_old_logs(retention_days NUMBER)\nBEGIN\n    DECLARE cutoff DATE = DATE_SUB(CURRENT_DATE(), retention_days);\n\n    PRINT '=== Logs Older Than ' || retention_days || ' Days ===';\n    PRINT 'Cutoff date: ' || cutoff;\n\n    DECLARE old_logs CURSOR FOR ESQL_QUERY('\n        FROM logs-*\n        | STATS \n            doc_count = COUNT(*),\n            oldest = MIN(@timestamp),\n            newest = MAX(@timestamp)\n          BY _index\n        | WHERE oldest &lt; \"' || cutoff || '\"\n        | SORT oldest\n    ');\n\n    DECLARE total_docs NUMBER = 0;\n\n    FOR idx IN old_logs LOOP\n        DECLARE index_name STRING = DOCUMENT_GET(idx, '_index');\n        DECLARE docs NUMBER = DOCUMENT_GET(idx, 'doc_count');\n        DECLARE oldest DATE = DOCUMENT_GET(idx, 'oldest');\n\n        PRINT index_name;\n        PRINT '    Documents: ' || docs;\n        PRINT '    Oldest: ' || oldest;\n\n        SET total_docs = total_docs + docs;\n    END LOOP;\n\n    PRINT '';\n    PRINT 'Total documents eligible for cleanup: ' || total_docs;\nEND PROCEDURE;\n</code></pre>"},{"location":"examples/log-analysis/#usage","title":"Usage","text":"<p>Call these procedures to analyze your logs:</p> <pre><code>-- Count errors by service\nCALL count_errors_by_service();\n\n-- Find repeating patterns\nCALL find_error_patterns();\n\n-- Get AI summary of errors\nCALL summarize_errors();\n\n-- Check for anomalies\nCALL detect_anomalies();\n\n-- Service health dashboard\nCALL service_health_check();\n</code></pre>"},{"location":"functions/ai-llm/","title":"AI &amp; LLM Functions","text":"<p>Integration with OpenAI and Elasticsearch Inference APIs for AI-powered automation.</p>"},{"location":"functions/ai-llm/#openai-functions","title":"OpenAI Functions","text":""},{"location":"functions/ai-llm/#llm_complete","title":"LLM_COMPLETE","text":"<p>Sends a prompt to OpenAI and returns the completion.</p> <pre><code>DECLARE prompt STRING = 'Explain what Elasticsearch is in one sentence.';\nDECLARE response STRING = LLM_COMPLETE(prompt);\nPRINT response;\n-- Output: Elasticsearch is a distributed search and analytics engine...\n</code></pre> <p>Syntax: <code>LLM_COMPLETE(prompt)</code></p> <p>Parameters:</p> Parameter Type Description prompt STRING The prompt to send to the LLM <p>Returns: STRING - The model's response</p> <p>API Key Required</p> <p>Set the <code>OPENAI_API_KEY</code> environment variable before starting Elasticsearch.</p>"},{"location":"functions/ai-llm/#llm_complete-with-model-selection","title":"LLM_COMPLETE with Model Selection","text":"<p>Specify a particular OpenAI model:</p> <pre><code>DECLARE response STRING = LLM_COMPLETE(prompt, 'gpt-4');\n</code></pre> <p>Syntax: <code>LLM_COMPLETE(prompt, model)</code></p> <p>Available Models:</p> Model Description <code>gpt-4</code> Most capable model <code>gpt-4-turbo</code> Faster GPT-4 variant <code>gpt-3.5-turbo</code> Fast and cost-effective"},{"location":"functions/ai-llm/#llm_summarize","title":"LLM_SUMMARIZE","text":"<p>Summarizes text content.</p> <pre><code>DECLARE long_text STRING = '... lengthy document content ...';\nDECLARE summary STRING = LLM_SUMMARIZE(long_text);\nPRINT summary;\n</code></pre> <p>Syntax: <code>LLM_SUMMARIZE(text)</code></p>"},{"location":"functions/ai-llm/#elasticsearch-inference-api","title":"Elasticsearch Inference API","text":""},{"location":"functions/ai-llm/#es_inference","title":"ES_INFERENCE","text":"<p>Uses Elasticsearch's built-in inference endpoints.</p> <pre><code>DECLARE text STRING = 'The server is experiencing high latency';\nDECLARE embedding ARRAY = ES_INFERENCE('text-embedding', text);\n</code></pre> <p>Syntax: <code>ES_INFERENCE(endpoint_id, input)</code></p> <p>Inference Endpoints</p> <p>Configure inference endpoints in Elasticsearch using the  Inference API.</p>"},{"location":"functions/ai-llm/#example-log-summarization","title":"Example: Log Summarization","text":"<pre><code>CREATE PROCEDURE summarize_errors()\nBEGIN\n    -- Fetch recent errors\n    DECLARE errors CURSOR FOR ESQL_QUERY('\n        FROM logs-*\n        | WHERE level = \"ERROR\"\n        | SORT @timestamp DESC\n        | LIMIT 20\n    ');\n\n    -- Collect error messages\n    DECLARE messages ARRAY = [];\n    FOR error IN errors LOOP\n        SET messages = ARRAY_APPEND(messages, DOCUMENT_GET(error, 'message'));\n    END LOOP;\n\n    IF ARRAY_LENGTH(messages) = 0 THEN\n        PRINT 'No errors found';\n        RETURN 'No errors to summarize';\n    END IF;\n\n    -- Create summary prompt\n    DECLARE prompt STRING = 'Summarize these error messages and identify the root cause:\\n\\n' \n        || ARRAY_JOIN(messages, '\\n');\n\n    -- Get AI summary\n    DECLARE summary STRING = LLM_COMPLETE(prompt);\n\n    PRINT '=== Error Summary ===';\n    PRINT summary;\n\n    RETURN summary;\nEND PROCEDURE;\n</code></pre>"},{"location":"functions/ai-llm/#example-intelligent-alert-classification","title":"Example: Intelligent Alert Classification","text":"<pre><code>CREATE PROCEDURE classify_alert(alert_message STRING)\nBEGIN\n    DECLARE prompt STRING = 'Classify this alert into one of: CRITICAL, HIGH, MEDIUM, LOW.\nOnly respond with the classification level.\n\nAlert: ' || alert_message;\n\n    DECLARE classification STRING = LLM_COMPLETE(prompt);\n    DECLARE level STRING = TRIM(UPPER(classification));\n\n    -- Validate response\n    IF level NOT IN ('CRITICAL', 'HIGH', 'MEDIUM', 'LOW') THEN\n        SET level = 'MEDIUM';  -- Default\n    END IF;\n\n    PRINT 'Alert classified as: ' || level;\n    RETURN level;\nEND PROCEDURE;\n</code></pre>"},{"location":"functions/ai-llm/#example-automated-incident-response","title":"Example: Automated Incident Response","text":"<pre><code>CREATE PROCEDURE generate_runbook(incident DOCUMENT)\nBEGIN\n    DECLARE service STRING = DOCUMENT_GET(incident, 'service');\n    DECLARE error STRING = DOCUMENT_GET(incident, 'error');\n\n    DECLARE prompt STRING = 'Generate a step-by-step runbook to resolve this incident:\n\nService: ' || service || '\nError: ' || error || '\n\nProvide numbered steps that an on-call engineer can follow.';\n\n    DECLARE runbook STRING = LLM_COMPLETE(prompt);\n\n    -- Store runbook\n    DECLARE doc DOCUMENT = {\n        \"incident_id\": DOCUMENT_GET(incident, 'id'),\n        \"generated_runbook\": runbook,\n        \"generated_at\": CURRENT_TIMESTAMP()\n    };\n    ES_INDEX('incident-runbooks', NULL, doc);\n\n    RETURN runbook;\nEND PROCEDURE;\n</code></pre>"},{"location":"functions/ai-llm/#example-semantic-search-enhancement","title":"Example: Semantic Search Enhancement","text":"<pre><code>CREATE PROCEDURE semantic_search(query STRING)\nBEGIN\n    -- Generate embedding for query\n    DECLARE query_embedding ARRAY = ES_INFERENCE('text-embedding', query);\n\n    -- Search using KNN\n    DECLARE results CURSOR FOR ESQL_QUERY('\n        FROM knowledge-base\n        | WHERE knn(embedding, ' || query_embedding || ', 10)\n        | LIMIT 5\n    ');\n\n    FOR result IN results LOOP\n        PRINT DOCUMENT_GET(result, 'title');\n        PRINT '  ' || DOCUMENT_GET(result, 'summary');\n    END LOOP;\nEND PROCEDURE;\n</code></pre>"},{"location":"functions/ai-llm/#best-practices","title":"Best Practices","text":"<p>Prompt Engineering</p> <ul> <li>Be specific in your prompts</li> <li>Include context about the expected output format</li> <li>Use examples when needed (few-shot prompting)</li> </ul> <p>Cost Considerations</p> <ul> <li>OpenAI API calls incur costs</li> <li>Cache results when possible</li> <li>Use smaller models for simple tasks</li> </ul> <p>Error Handling</p> <pre><code>TRY\n    DECLARE response STRING = LLM_COMPLETE(prompt);\nCATCH error\n    PRINT 'AI request failed: ' || error;\n    -- Fallback logic\nEND TRY;\n</code></pre>"},{"location":"functions/array/","title":"Array Functions","text":"<p>Functions for working with arrays and collections.</p>"},{"location":"functions/array/#function-reference","title":"Function Reference","text":""},{"location":"functions/array/#array_length","title":"ARRAY_LENGTH","text":"<p>Returns the number of elements in an array.</p> <pre><code>DECLARE arr ARRAY = [1, 2, 3, 4, 5];\nDECLARE len NUMBER = ARRAY_LENGTH(arr);\n-- Returns: 5\n</code></pre> <p>Syntax: <code>ARRAY_LENGTH(array)</code></p>"},{"location":"functions/array/#array_append","title":"ARRAY_APPEND","text":"<p>Adds an element to the end of an array.</p> <pre><code>DECLARE arr ARRAY = [1, 2, 3];\nDECLARE result ARRAY = ARRAY_APPEND(arr, 4);\n-- Returns: [1, 2, 3, 4]\n</code></pre> <p>Syntax: <code>ARRAY_APPEND(array, element)</code></p>"},{"location":"functions/array/#array_prepend","title":"ARRAY_PREPEND","text":"<p>Adds an element to the beginning of an array.</p> <pre><code>DECLARE arr ARRAY = [2, 3, 4];\nDECLARE result ARRAY = ARRAY_PREPEND(arr, 1);\n-- Returns: [1, 2, 3, 4]\n</code></pre> <p>Syntax: <code>ARRAY_PREPEND(array, element)</code></p>"},{"location":"functions/array/#array_remove","title":"ARRAY_REMOVE","text":"<p>Removes all occurrences of an element from an array.</p> <pre><code>DECLARE arr ARRAY = [1, 2, 3, 2, 4];\nDECLARE result ARRAY = ARRAY_REMOVE(arr, 2);\n-- Returns: [1, 3, 4]\n</code></pre> <p>Syntax: <code>ARRAY_REMOVE(array, element)</code></p>"},{"location":"functions/array/#array_contains","title":"ARRAY_CONTAINS","text":"<p>Checks if an array contains an element.</p> <pre><code>DECLARE arr ARRAY = ['apple', 'banana', 'cherry'];\nDECLARE has_banana BOOLEAN = ARRAY_CONTAINS(arr, 'banana');\n-- Returns: true\n</code></pre> <p>Syntax: <code>ARRAY_CONTAINS(array, element)</code></p> <p>Returns: BOOLEAN</p>"},{"location":"functions/array/#array_reverse","title":"ARRAY_REVERSE","text":"<p>Reverses the order of elements.</p> <pre><code>DECLARE arr ARRAY = [1, 2, 3];\nDECLARE result ARRAY = ARRAY_REVERSE(arr);\n-- Returns: [3, 2, 1]\n</code></pre> <p>Syntax: <code>ARRAY_REVERSE(array)</code></p>"},{"location":"functions/array/#array_slice","title":"ARRAY_SLICE","text":"<p>Extracts a portion of an array.</p> <pre><code>DECLARE arr ARRAY = [1, 2, 3, 4, 5];\nDECLARE result ARRAY = ARRAY_SLICE(arr, 1, 3);\n-- Returns: [2, 3, 4]\n</code></pre> <p>Syntax: <code>ARRAY_SLICE(array, start, end)</code></p> <p>Parameters:</p> Parameter Type Description array ARRAY Input array start NUMBER Start index (0-based, inclusive) end NUMBER End index (exclusive)"},{"location":"functions/array/#array_distinct","title":"ARRAY_DISTINCT","text":"<p>Removes duplicate elements.</p> <pre><code>DECLARE arr ARRAY = [1, 2, 2, 3, 3, 3];\nDECLARE result ARRAY = ARRAY_DISTINCT(arr);\n-- Returns: [1, 2, 3]\n</code></pre> <p>Syntax: <code>ARRAY_DISTINCT(array)</code></p>"},{"location":"functions/array/#array_join","title":"ARRAY_JOIN","text":"<p>Joins array elements into a string.</p> <pre><code>DECLARE words ARRAY = ['hello', 'world'];\nDECLARE result STRING = ARRAY_JOIN(words, ', ');\n-- Returns: 'hello, world'\n</code></pre> <p>Syntax: <code>ARRAY_JOIN(array, delimiter)</code></p>"},{"location":"functions/array/#array_sort","title":"ARRAY_SORT","text":"<p>Sorts array elements.</p> <pre><code>DECLARE arr ARRAY = [3, 1, 4, 1, 5, 9];\nDECLARE result ARRAY = ARRAY_SORT(arr);\n-- Returns: [1, 1, 3, 4, 5, 9]\n</code></pre> <p>Syntax: <code>ARRAY_SORT(array)</code></p>"},{"location":"functions/array/#array_first","title":"ARRAY_FIRST","text":"<p>Returns the first element.</p> <pre><code>DECLARE arr ARRAY = [10, 20, 30];\nDECLARE result NUMBER = ARRAY_FIRST(arr);\n-- Returns: 10\n</code></pre> <p>Syntax: <code>ARRAY_FIRST(array)</code></p>"},{"location":"functions/array/#array_last","title":"ARRAY_LAST","text":"<p>Returns the last element.</p> <pre><code>DECLARE arr ARRAY = [10, 20, 30];\nDECLARE result NUMBER = ARRAY_LAST(arr);\n-- Returns: 30\n</code></pre> <p>Syntax: <code>ARRAY_LAST(array)</code></p>"},{"location":"functions/array/#array_filter","title":"ARRAY_FILTER","text":"<p>Filters elements based on a condition.</p> <pre><code>DECLARE numbers ARRAY = [1, 2, 3, 4, 5, 6];\nDECLARE evens ARRAY = ARRAY_FILTER(numbers, 'x =&gt; x % 2 == 0');\n-- Returns: [2, 4, 6]\n</code></pre> <p>Syntax: <code>ARRAY_FILTER(array, predicate)</code></p>"},{"location":"functions/array/#array_map","title":"ARRAY_MAP","text":"<p>Transforms each element.</p> <pre><code>DECLARE numbers ARRAY = [1, 2, 3];\nDECLARE doubled ARRAY = ARRAY_MAP(numbers, 'x =&gt; x * 2');\n-- Returns: [2, 4, 6]\n</code></pre> <p>Syntax: <code>ARRAY_MAP(array, transform)</code></p>"},{"location":"functions/array/#array-access","title":"Array Access","text":"<p>Access elements using square bracket notation (0-based indexing):</p> <pre><code>DECLARE arr ARRAY = ['a', 'b', 'c'];\nDECLARE first STRING = arr[0];   -- 'a'\nDECLARE second STRING = arr[1];  -- 'b'\n</code></pre>"},{"location":"functions/array/#iterating-arrays","title":"Iterating Arrays","text":"<p>Use <code>FOR</code> loops to iterate:</p> <pre><code>DECLARE items ARRAY = ['apple', 'banana', 'cherry'];\nFOR i IN 0..(ARRAY_LENGTH(items)-1) LOOP\n    PRINT items[i];\nEND LOOP;\n</code></pre>"},{"location":"functions/array/#example-process-log-entries","title":"Example: Process Log Entries","text":"<pre><code>CREATE PROCEDURE process_logs(logs ARRAY)\nBEGIN\n    DECLARE errors ARRAY = [];\n\n    FOR i IN 0..(ARRAY_LENGTH(logs)-1) LOOP\n        DECLARE log DOCUMENT = logs[i];\n        IF DOCUMENT_GET(log, 'level') = 'ERROR' THEN\n            SET errors = ARRAY_APPEND(errors, log);\n        END IF;\n    END LOOP;\n\n    PRINT 'Found ' || ARRAY_LENGTH(errors) || ' errors';\n    RETURN errors;\nEND PROCEDURE;\n</code></pre>"},{"location":"functions/date/","title":"Date Functions","text":"<p>Functions for working with dates and timestamps.</p>"},{"location":"functions/date/#function-reference","title":"Function Reference","text":""},{"location":"functions/date/#current_date","title":"CURRENT_DATE","text":"<p>Returns the current date.</p> <pre><code>DECLARE today DATE = CURRENT_DATE();\n-- Returns: 2026-01-09\n</code></pre> <p>Syntax: <code>CURRENT_DATE()</code></p>"},{"location":"functions/date/#current_timestamp","title":"CURRENT_TIMESTAMP","text":"<p>Returns the current date and time.</p> <pre><code>DECLARE now DATE = CURRENT_TIMESTAMP();\n-- Returns: 2026-01-09T15:30:00Z\n</code></pre> <p>Syntax: <code>CURRENT_TIMESTAMP()</code></p>"},{"location":"functions/date/#date_add","title":"DATE_ADD","text":"<p>Adds days to a date.</p> <pre><code>DECLARE today DATE = CURRENT_DATE();\nDECLARE next_week DATE = DATE_ADD(today, 7);\n-- Adds 7 days\n</code></pre> <p>Syntax: <code>DATE_ADD(date, days)</code></p> <p>Parameters:</p> Parameter Type Description date DATE Starting date days NUMBER Number of days to add"},{"location":"functions/date/#date_sub","title":"DATE_SUB","text":"<p>Subtracts days from a date.</p> <pre><code>DECLARE today DATE = CURRENT_DATE();\nDECLARE last_week DATE = DATE_SUB(today, 7);\n-- Subtracts 7 days\n</code></pre> <p>Syntax: <code>DATE_SUB(date, days)</code></p>"},{"location":"functions/date/#extract_year","title":"EXTRACT_YEAR","text":"<p>Extracts the year from a date.</p> <pre><code>DECLARE now DATE = CURRENT_TIMESTAMP();\nDECLARE year NUMBER = EXTRACT_YEAR(now);\n-- Returns: 2026\n</code></pre> <p>Syntax: <code>EXTRACT_YEAR(date)</code></p>"},{"location":"functions/date/#extract_month","title":"EXTRACT_MONTH","text":"<p>Extracts the month from a date (1-12).</p> <pre><code>DECLARE now DATE = CURRENT_TIMESTAMP();\nDECLARE month NUMBER = EXTRACT_MONTH(now);\n-- Returns: 1 (January)\n</code></pre> <p>Syntax: <code>EXTRACT_MONTH(date)</code></p>"},{"location":"functions/date/#extract_day","title":"EXTRACT_DAY","text":"<p>Extracts the day of month from a date (1-31).</p> <pre><code>DECLARE now DATE = CURRENT_TIMESTAMP();\nDECLARE day NUMBER = EXTRACT_DAY(now);\n-- Returns: 9\n</code></pre> <p>Syntax: <code>EXTRACT_DAY(date)</code></p>"},{"location":"functions/date/#date_diff","title":"DATE_DIFF","text":"<p>Calculates the difference between two dates in days.</p> <pre><code>DECLARE start_date DATE = DATE_SUB(CURRENT_DATE(), 30);\nDECLARE end_date DATE = CURRENT_DATE();\nDECLARE days_between NUMBER = DATE_DIFF(end_date, start_date);\n-- Returns: 30\n</code></pre> <p>Syntax: <code>DATE_DIFF(date1, date2)</code></p> <p>Returns: NUMBER - Days between dates (date1 - date2)</p>"},{"location":"functions/date/#example-date-based-filtering","title":"Example: Date-Based Filtering","text":"<pre><code>CREATE PROCEDURE get_recent_logs(days_back NUMBER)\nBEGIN\n    DECLARE cutoff DATE = DATE_SUB(CURRENT_DATE(), days_back);\n\n    DECLARE logs CURSOR FOR ESQL_QUERY('\n        FROM logs-* \n        | WHERE @timestamp &gt;= \"' || cutoff || '\"\n        | LIMIT 100\n    ');\n\n    FOR log IN logs LOOP\n        PRINT DOCUMENT_GET(log, 'message');\n    END LOOP;\nEND PROCEDURE;\n</code></pre>"},{"location":"functions/date/#example-generate-date-range","title":"Example: Generate Date Range","text":"<pre><code>CREATE PROCEDURE date_range(start_date DATE, num_days NUMBER)\nBEGIN\n    DECLARE dates ARRAY = [];\n\n    FOR i IN 0..(num_days-1) LOOP\n        DECLARE d DATE = DATE_ADD(start_date, i);\n        SET dates = ARRAY_APPEND(dates, d);\n    END LOOP;\n\n    RETURN dates;\nEND PROCEDURE;\n</code></pre>"},{"location":"functions/date/#working-with-timestamps","title":"Working with Timestamps","text":"<p>Dates and timestamps are interchangeable in most contexts:</p> <pre><code>DECLARE event_time DATE = CURRENT_TIMESTAMP();\n\n-- Extract components\nPRINT 'Year: ' || EXTRACT_YEAR(event_time);\nPRINT 'Month: ' || EXTRACT_MONTH(event_time);\nPRINT 'Day: ' || EXTRACT_DAY(event_time);\n</code></pre> <p>Timezone Handling</p> <p>All dates and timestamps are in UTC by default. Timezone conversion  should be handled at the application layer if needed.</p>"},{"location":"functions/document/","title":"Document Functions","text":"<p>Functions for working with document (object/map) data types.</p>"},{"location":"functions/document/#overview","title":"Overview","text":"<p>Documents in elastic-script are key-value maps similar to JSON objects. They're commonly used when working with Elasticsearch documents.</p>"},{"location":"functions/document/#function-reference","title":"Function Reference","text":""},{"location":"functions/document/#document_get","title":"DOCUMENT_GET","text":"<p>Gets a value from a document by key.</p> <pre><code>DECLARE doc DOCUMENT = {\"name\": \"John\", \"age\": 30};\nDECLARE name STRING = DOCUMENT_GET(doc, 'name');\n-- Returns: 'John'\n</code></pre> <p>Syntax: <code>DOCUMENT_GET(document, key)</code></p> <p>Parameters:</p> Parameter Type Description document DOCUMENT Input document key STRING Key to retrieve <p>Returns: Value at the specified key, or NULL if not found</p>"},{"location":"functions/document/#document_keys","title":"DOCUMENT_KEYS","text":"<p>Returns all keys in a document.</p> <pre><code>DECLARE doc DOCUMENT = {\"name\": \"John\", \"age\": 30, \"city\": \"NYC\"};\nDECLARE keys ARRAY = DOCUMENT_KEYS(doc);\n-- Returns: ['name', 'age', 'city']\n</code></pre> <p>Syntax: <code>DOCUMENT_KEYS(document)</code></p> <p>Returns: ARRAY - Array of key names</p>"},{"location":"functions/document/#document_values","title":"DOCUMENT_VALUES","text":"<p>Returns all values in a document.</p> <pre><code>DECLARE doc DOCUMENT = {\"a\": 1, \"b\": 2, \"c\": 3};\nDECLARE values ARRAY = DOCUMENT_VALUES(doc);\n-- Returns: [1, 2, 3]\n</code></pre> <p>Syntax: <code>DOCUMENT_VALUES(document)</code></p> <p>Returns: ARRAY - Array of values</p>"},{"location":"functions/document/#document_contains","title":"DOCUMENT_CONTAINS","text":"<p>Checks if a document contains a key.</p> <pre><code>DECLARE doc DOCUMENT = {\"name\": \"John\"};\nDECLARE has_name BOOLEAN = DOCUMENT_CONTAINS(doc, 'name');\n-- Returns: true\nDECLARE has_email BOOLEAN = DOCUMENT_CONTAINS(doc, 'email');\n-- Returns: false\n</code></pre> <p>Syntax: <code>DOCUMENT_CONTAINS(document, key)</code></p> <p>Returns: BOOLEAN</p>"},{"location":"functions/document/#document_merge","title":"DOCUMENT_MERGE","text":"<p>Merges two documents into one.</p> <pre><code>DECLARE doc1 DOCUMENT = {\"a\": 1, \"b\": 2};\nDECLARE doc2 DOCUMENT = {\"c\": 3, \"d\": 4};\nDECLARE merged DOCUMENT = DOCUMENT_MERGE(doc1, doc2);\n-- Returns: {\"a\": 1, \"b\": 2, \"c\": 3, \"d\": 4}\n</code></pre> <p>Syntax: <code>DOCUMENT_MERGE(document1, document2)</code></p> <p>Conflict Resolution</p> <p>When both documents contain the same key, the value from <code>document2</code> takes precedence.</p>"},{"location":"functions/document/#document_remove","title":"DOCUMENT_REMOVE","text":"<p>Removes a key from a document.</p> <pre><code>DECLARE doc DOCUMENT = {\"a\": 1, \"b\": 2, \"c\": 3};\nDECLARE result DOCUMENT = DOCUMENT_REMOVE(doc, 'b');\n-- Returns: {\"a\": 1, \"c\": 3}\n</code></pre> <p>Syntax: <code>DOCUMENT_REMOVE(document, key)</code></p>"},{"location":"functions/document/#working-with-elasticsearch-documents","title":"Working with Elasticsearch Documents","text":"<p>When querying Elasticsearch, results come back as documents:</p> <pre><code>CREATE PROCEDURE analyze_log(log_id STRING)\nBEGIN\n    -- Get a document from Elasticsearch\n    DECLARE log DOCUMENT = ES_GET('logs-sample', log_id);\n\n    -- Access fields\n    DECLARE level STRING = DOCUMENT_GET(log, 'level');\n    DECLARE message STRING = DOCUMENT_GET(log, 'message');\n    DECLARE timestamp DATE = DOCUMENT_GET(log, '@timestamp');\n\n    -- Check for specific fields\n    IF DOCUMENT_CONTAINS(log, 'error') THEN\n        PRINT 'Error details: ' || DOCUMENT_GET(log, 'error');\n    END IF;\n\n    RETURN log;\nEND PROCEDURE;\n</code></pre>"},{"location":"functions/document/#nested-document-access","title":"Nested Document Access","text":"<p>For nested documents, chain <code>DOCUMENT_GET</code> calls:</p> <pre><code>DECLARE doc DOCUMENT = {\n    \"user\": {\n        \"name\": \"John\",\n        \"address\": {\n            \"city\": \"NYC\"\n        }\n    }\n};\n\nDECLARE user DOCUMENT = DOCUMENT_GET(doc, 'user');\nDECLARE name STRING = DOCUMENT_GET(user, 'name');\nDECLARE address DOCUMENT = DOCUMENT_GET(user, 'address');\nDECLARE city STRING = DOCUMENT_GET(address, 'city');\n</code></pre>"},{"location":"functions/document/#example-transform-document","title":"Example: Transform Document","text":"<pre><code>CREATE PROCEDURE transform_log(log DOCUMENT)\nBEGIN\n    -- Create new document with transformed fields\n    DECLARE result DOCUMENT = {};\n\n    -- Copy and transform fields\n    SET result = DOCUMENT_MERGE(result, {\n        \"timestamp\": DOCUMENT_GET(log, '@timestamp'),\n        \"severity\": UPPER(DOCUMENT_GET(log, 'level')),\n        \"service\": DOCUMENT_GET(log, 'service.name'),\n        \"message\": DOCUMENT_GET(log, 'message')\n    });\n\n    RETURN result;\nEND PROCEDURE;\n</code></pre>"},{"location":"functions/document/#example-iterate-document-keys","title":"Example: Iterate Document Keys","text":"<pre><code>CREATE PROCEDURE print_document(doc DOCUMENT)\nBEGIN\n    DECLARE keys ARRAY = DOCUMENT_KEYS(doc);\n\n    FOR i IN 0..(ARRAY_LENGTH(keys)-1) LOOP\n        DECLARE key STRING = keys[i];\n        DECLARE value STRING = DOCUMENT_GET(doc, key);\n        PRINT key || ': ' || value;\n    END LOOP;\nEND PROCEDURE;\n</code></pre>"},{"location":"functions/elasticsearch/","title":"Elasticsearch Functions","text":"<p>Native integration with Elasticsearch for querying and data manipulation.</p>"},{"location":"functions/elasticsearch/#esql-integration","title":"ESQL Integration","text":""},{"location":"functions/elasticsearch/#esql_query","title":"ESQL_QUERY","text":"<p>Executes an ES|QL query and returns results.</p> <pre><code>DECLARE results CURSOR FOR ESQL_QUERY('\n    FROM logs-* \n    | WHERE level = \"ERROR\"\n    | STATS count = COUNT(*) BY service\n    | SORT count DESC\n    | LIMIT 10\n');\n\nFOR row IN results LOOP\n    PRINT DOCUMENT_GET(row, 'service') || ': ' || DOCUMENT_GET(row, 'count');\nEND LOOP;\n</code></pre> <p>Syntax: <code>ESQL_QUERY(query_string)</code></p> <p>Returns: CURSOR - Iterable result set</p> <p>ES|QL Reference</p> <p>See the Elasticsearch ES|QL documentation for query syntax.</p>"},{"location":"functions/elasticsearch/#using-cursors","title":"Using Cursors","text":"<p>Results from <code>ESQL_QUERY</code> are returned as a cursor, which can be iterated:</p> <pre><code>-- Declare cursor\nDECLARE logs CURSOR FOR ESQL_QUERY('FROM logs-* | LIMIT 100');\n\n-- Iterate results\nFOR log IN logs LOOP\n    DECLARE message STRING = DOCUMENT_GET(log, 'message');\n    PRINT message;\nEND LOOP;\n</code></pre>"},{"location":"functions/elasticsearch/#document-operations","title":"Document Operations","text":""},{"location":"functions/elasticsearch/#es_get","title":"ES_GET","text":"<p>Retrieves a document by ID.</p> <pre><code>DECLARE doc DOCUMENT = ES_GET('my-index', 'doc-id-123');\nPRINT DOCUMENT_GET(doc, 'title');\n</code></pre> <p>Syntax: <code>ES_GET(index, document_id)</code></p>"},{"location":"functions/elasticsearch/#es_index","title":"ES_INDEX","text":"<p>Indexes (creates or updates) a document.</p> <pre><code>DECLARE doc DOCUMENT = {\n    \"title\": \"My Document\",\n    \"content\": \"Hello World\",\n    \"timestamp\": CURRENT_TIMESTAMP()\n};\n\nDECLARE result DOCUMENT = ES_INDEX('my-index', 'doc-id', doc);\nPRINT 'Indexed: ' || DOCUMENT_GET(result, '_id');\n</code></pre> <p>Syntax: <code>ES_INDEX(index, document_id, document)</code></p>"},{"location":"functions/elasticsearch/#es_delete","title":"ES_DELETE","text":"<p>Deletes a document by ID.</p> <pre><code>ES_DELETE('my-index', 'doc-id-123');\n</code></pre> <p>Syntax: <code>ES_DELETE(index, document_id)</code></p>"},{"location":"functions/elasticsearch/#es_update","title":"ES_UPDATE","text":"<p>Updates specific fields in a document.</p> <pre><code>DECLARE updates DOCUMENT = {\n    \"status\": \"processed\",\n    \"processed_at\": CURRENT_TIMESTAMP()\n};\n\nES_UPDATE('my-index', 'doc-id', updates);\n</code></pre> <p>Syntax: <code>ES_UPDATE(index, document_id, partial_document)</code></p>"},{"location":"functions/elasticsearch/#aggregations-with-esql","title":"Aggregations with ES|QL","text":"<p>ES|QL supports powerful aggregations:</p> <pre><code>-- Count by category\nDECLARE stats CURSOR FOR ESQL_QUERY('\n    FROM sales \n    | STATS \n        total_revenue = SUM(amount),\n        avg_order = AVG(amount),\n        order_count = COUNT(*)\n      BY category\n    | SORT total_revenue DESC\n');\n\nFOR row IN stats LOOP\n    PRINT DOCUMENT_GET(row, 'category') || ': $' || DOCUMENT_GET(row, 'total_revenue');\nEND LOOP;\n</code></pre>"},{"location":"functions/elasticsearch/#common-aggregation-functions","title":"Common Aggregation Functions","text":"Function Description <code>COUNT(*)</code> Count documents <code>SUM(field)</code> Sum numeric values <code>AVG(field)</code> Calculate average <code>MIN(field)</code> Find minimum value <code>MAX(field)</code> Find maximum value <code>PERCENTILE(field, n)</code> Calculate percentile"},{"location":"functions/elasticsearch/#example-log-analysis-pipeline","title":"Example: Log Analysis Pipeline","text":"<pre><code>CREATE PROCEDURE analyze_errors(time_range STRING)\nBEGIN\n    -- Get error counts by service\n    DECLARE errors CURSOR FOR ESQL_QUERY('\n        FROM logs-*\n        | WHERE level = \"ERROR\" AND @timestamp &gt; NOW() - ' || time_range || '\n        | STATS error_count = COUNT(*) BY service.name\n        | SORT error_count DESC\n        | LIMIT 20\n    ');\n\n    PRINT '=== Error Summary ===';\n\n    FOR row IN errors LOOP\n        DECLARE service STRING = DOCUMENT_GET(row, 'service.name');\n        DECLARE count NUMBER = DOCUMENT_GET(row, 'error_count');\n        PRINT service || ': ' || count || ' errors';\n    END LOOP;\nEND PROCEDURE;\n\n-- Usage\nCALL analyze_errors('1 hour');\n</code></pre>"},{"location":"functions/elasticsearch/#example-data-enrichment","title":"Example: Data Enrichment","text":"<pre><code>CREATE PROCEDURE enrich_and_index(source_index STRING, target_index STRING)\nBEGIN\n    DECLARE docs CURSOR FOR ESQL_QUERY('FROM ' || source_index || ' | LIMIT 1000');\n    DECLARE processed NUMBER = 0;\n\n    FOR doc IN docs LOOP\n        -- Enrich document\n        DECLARE enriched DOCUMENT = DOCUMENT_MERGE(doc, {\n            \"processed_at\": CURRENT_TIMESTAMP(),\n            \"processed_by\": \"elastic-script\",\n            \"message_length\": LENGTH(DOCUMENT_GET(doc, 'message'))\n        });\n\n        -- Index to new location\n        ES_INDEX(target_index, NULL, enriched);\n        SET processed = processed + 1;\n    END LOOP;\n\n    PRINT 'Processed ' || processed || ' documents';\n    RETURN processed;\nEND PROCEDURE;\n</code></pre>"},{"location":"functions/elasticsearch/#best-practices","title":"Best Practices","text":"<p>Query Performance</p> <ul> <li>Use specific index patterns instead of wildcards when possible</li> <li>Add <code>LIMIT</code> to prevent processing excessive data</li> <li>Use <code>WHERE</code> clauses to filter early in the query</li> </ul> <p>Rate Limiting</p> <p>When processing large datasets, consider adding delays or batch processing to avoid overwhelming the cluster.</p>"},{"location":"functions/integrations/","title":"Integration Functions","text":"<p>Connect elastic-script to external services for automation and orchestration.</p>"},{"location":"functions/integrations/#slack-integration","title":"Slack Integration","text":""},{"location":"functions/integrations/#slack_send","title":"SLACK_SEND","text":"<p>Sends a message to a Slack channel.</p> <pre><code>SLACK_SEND('#alerts', 'High CPU usage detected on prod-server-01');\n</code></pre> <p>Syntax: <code>SLACK_SEND(channel, message)</code></p> <p>Parameters:</p> Parameter Type Description channel STRING Channel name (with #) or channel ID message STRING Message text <p>Configuration</p> <p>Set the <code>SLACK_BOT_TOKEN</code> environment variable with your Slack bot token.</p>"},{"location":"functions/integrations/#slack_send_rich","title":"SLACK_SEND_RICH","text":"<p>Sends a formatted message with blocks.</p> <pre><code>DECLARE blocks ARRAY = [\n    {\"type\": \"header\", \"text\": {\"type\": \"plain_text\", \"text\": \"\ud83d\udea8 Alert\"}},\n    {\"type\": \"section\", \"text\": {\"type\": \"mrkdwn\", \"text\": \"*Service:* api-gateway\\n*Status:* DOWN\"}}\n];\n\nSLACK_SEND_RICH('#incidents', blocks);\n</code></pre> <p>Syntax: <code>SLACK_SEND_RICH(channel, blocks)</code></p>"},{"location":"functions/integrations/#pagerduty-integration","title":"PagerDuty Integration","text":""},{"location":"functions/integrations/#pagerduty_create_incident","title":"PAGERDUTY_CREATE_INCIDENT","text":"<p>Creates a PagerDuty incident.</p> <pre><code>DECLARE incident_key STRING = PAGERDUTY_CREATE_INCIDENT(\n    'Database connection pool exhausted',\n    'critical',\n    'db-service'\n);\nPRINT 'Created incident: ' || incident_key;\n</code></pre> <p>Syntax: <code>PAGERDUTY_CREATE_INCIDENT(title, severity, service)</code></p> <p>Severity Levels:</p> Level Description <code>critical</code> System down, immediate action required <code>error</code> Major functionality impacted <code>warning</code> Degraded performance <code>info</code> Informational alert"},{"location":"functions/integrations/#pagerduty_resolve","title":"PAGERDUTY_RESOLVE","text":"<p>Resolves an existing incident.</p> <pre><code>PAGERDUTY_RESOLVE(incident_key, 'Issue resolved - connection pool increased');\n</code></pre> <p>Syntax: <code>PAGERDUTY_RESOLVE(incident_key, resolution_message)</code></p>"},{"location":"functions/integrations/#aws-integration","title":"AWS Integration","text":""},{"location":"functions/integrations/#aws_lambda_invoke","title":"AWS_LAMBDA_INVOKE","text":"<p>Invokes an AWS Lambda function.</p> <pre><code>DECLARE payload DOCUMENT = {\"action\": \"scale_up\", \"count\": 2};\nDECLARE result DOCUMENT = AWS_LAMBDA_INVOKE('my-lambda-function', payload);\nPRINT DOCUMENT_GET(result, 'status');\n</code></pre> <p>Syntax: <code>AWS_LAMBDA_INVOKE(function_name, payload)</code></p>"},{"location":"functions/integrations/#s3_get_object","title":"S3_GET_OBJECT","text":"<p>Retrieves an object from S3.</p> <pre><code>DECLARE content STRING = S3_GET_OBJECT('my-bucket', 'config/settings.json');\n</code></pre> <p>Syntax: <code>S3_GET_OBJECT(bucket, key)</code></p>"},{"location":"functions/integrations/#s3_put_object","title":"S3_PUT_OBJECT","text":"<p>Uploads content to S3.</p> <pre><code>S3_PUT_OBJECT('my-bucket', 'reports/daily.json', report_content);\n</code></pre> <p>Syntax: <code>S3_PUT_OBJECT(bucket, key, content)</code></p>"},{"location":"functions/integrations/#kubernetes-integration","title":"Kubernetes Integration","text":""},{"location":"functions/integrations/#k8s_get_pods","title":"K8S_GET_PODS","text":"<p>Lists pods in a namespace.</p> <pre><code>DECLARE pods ARRAY = K8S_GET_PODS('production');\n\nFOR i IN 0..(ARRAY_LENGTH(pods)-1) LOOP\n    DECLARE pod DOCUMENT = pods[i];\n    PRINT DOCUMENT_GET(pod, 'name') || ': ' || DOCUMENT_GET(pod, 'status');\nEND LOOP;\n</code></pre> <p>Syntax: <code>K8S_GET_PODS(namespace)</code></p>"},{"location":"functions/integrations/#k8s_scale_deployment","title":"K8S_SCALE_DEPLOYMENT","text":"<p>Scales a Kubernetes deployment.</p> <pre><code>K8S_SCALE_DEPLOYMENT('production', 'api-gateway', 5);\nPRINT 'Scaled api-gateway to 5 replicas';\n</code></pre> <p>Syntax: <code>K8S_SCALE_DEPLOYMENT(namespace, deployment, replicas)</code></p>"},{"location":"functions/integrations/#k8s_restart_deployment","title":"K8S_RESTART_DEPLOYMENT","text":"<p>Triggers a rolling restart.</p> <pre><code>K8S_RESTART_DEPLOYMENT('production', 'api-gateway');\n</code></pre> <p>Syntax: <code>K8S_RESTART_DEPLOYMENT(namespace, deployment)</code></p>"},{"location":"functions/integrations/#http-functions","title":"HTTP Functions","text":""},{"location":"functions/integrations/#http_get","title":"HTTP_GET","text":"<p>Makes an HTTP GET request.</p> <pre><code>DECLARE response STRING = HTTP_GET('https://api.example.com/status');\n</code></pre> <p>Syntax: <code>HTTP_GET(url)</code></p>"},{"location":"functions/integrations/#http_post","title":"HTTP_POST","text":"<p>Makes an HTTP POST request.</p> <pre><code>DECLARE body DOCUMENT = {\"key\": \"value\"};\nDECLARE response STRING = HTTP_POST('https://api.example.com/data', body);\n</code></pre> <p>Syntax: <code>HTTP_POST(url, body)</code></p>"},{"location":"functions/integrations/#http_request","title":"HTTP_REQUEST","text":"<p>Makes a custom HTTP request.</p> <pre><code>DECLARE headers DOCUMENT = {\n    \"Authorization\": \"Bearer \" || api_token,\n    \"Content-Type\": \"application/json\"\n};\n\nDECLARE response STRING = HTTP_REQUEST(\n    'PUT',\n    'https://api.example.com/resource/123',\n    body,\n    headers\n);\n</code></pre> <p>Syntax: <code>HTTP_REQUEST(method, url, body, headers)</code></p>"},{"location":"functions/integrations/#cicd-integration","title":"CI/CD Integration","text":""},{"location":"functions/integrations/#github_create_issue","title":"GITHUB_CREATE_ISSUE","text":"<p>Creates a GitHub issue.</p> <pre><code>GITHUB_CREATE_ISSUE(\n    'myorg/myrepo',\n    'Automated bug report: Memory leak detected',\n    'The service is experiencing memory growth over time.\\n\\nDetails: ...'\n);\n</code></pre> <p>Syntax: <code>GITHUB_CREATE_ISSUE(repo, title, body)</code></p>"},{"location":"functions/integrations/#example-complete-incident-response","title":"Example: Complete Incident Response","text":"<pre><code>CREATE PROCEDURE handle_outage(service STRING, severity STRING)\nBEGIN\n    PRINT 'Handling outage for ' || service;\n\n    -- 1. Create PagerDuty incident\n    DECLARE pd_key STRING = PAGERDUTY_CREATE_INCIDENT(\n        service || ' is DOWN',\n        severity,\n        service\n    );\n\n    -- 2. Notify Slack\n    SLACK_SEND('#incidents', '\ud83d\udea8 *' || service || '* is experiencing an outage. PD incident created.');\n\n    -- 3. Attempt auto-remediation\n    TRY\n        K8S_RESTART_DEPLOYMENT('production', service);\n        PRINT 'Initiated restart of ' || service;\n\n        -- Wait and check status\n        -- SLEEP(30);\n\n        DECLARE pods ARRAY = K8S_GET_PODS('production');\n        DECLARE healthy BOOLEAN = TRUE;\n\n        -- Check pod status logic here...\n\n        IF healthy THEN\n            PAGERDUTY_RESOLVE(pd_key, 'Auto-remediation successful');\n            SLACK_SEND('#incidents', '\u2705 *' || service || '* recovered after restart');\n        END IF;\n\n    CATCH error\n        SLACK_SEND('#incidents', '\u274c Auto-remediation failed: ' || error);\n    END TRY;\n\n    RETURN pd_key;\nEND PROCEDURE;\n</code></pre>"},{"location":"functions/integrations/#environment-variables","title":"Environment Variables","text":"Variable Service Description <code>SLACK_BOT_TOKEN</code> Slack Bot OAuth token <code>PAGERDUTY_API_KEY</code> PagerDuty API key <code>AWS_ACCESS_KEY_ID</code> AWS Access key <code>AWS_SECRET_ACCESS_KEY</code> AWS Secret key <code>GITHUB_TOKEN</code> GitHub Personal access token"},{"location":"functions/integrations/#best-practices","title":"Best Practices","text":"<p>Idempotency</p> <p>Design procedures to be idempotent - safe to run multiple times without side effects.</p> <p>Rate Limits</p> <p>External APIs often have rate limits. Add appropriate delays or batching.</p> <p>Error Handling</p> <p>Always wrap external calls in TRY/CATCH blocks:</p> <pre><code>TRY\n    SLACK_SEND('#alerts', message);\nCATCH error\n    PRINT 'Slack notification failed: ' || error;\n    -- Fallback to another notification method\nEND TRY;\n</code></pre>"},{"location":"functions/number/","title":"Number Functions","text":"<p>Mathematical and numeric operations.</p>"},{"location":"functions/number/#function-reference","title":"Function Reference","text":""},{"location":"functions/number/#abs","title":"ABS","text":"<p>Returns the absolute value of a number.</p> <pre><code>DECLARE result NUMBER = ABS(-42);\n-- Returns: 42\n</code></pre> <p>Syntax: <code>ABS(number)</code></p>"},{"location":"functions/number/#ceil","title":"CEIL","text":"<p>Rounds up to the nearest integer.</p> <pre><code>DECLARE result NUMBER = CEIL(4.2);\n-- Returns: 5\n</code></pre> <p>Syntax: <code>CEIL(number)</code></p>"},{"location":"functions/number/#floor","title":"FLOOR","text":"<p>Rounds down to the nearest integer.</p> <pre><code>DECLARE result NUMBER = FLOOR(4.8);\n-- Returns: 4\n</code></pre> <p>Syntax: <code>FLOOR(number)</code></p>"},{"location":"functions/number/#round","title":"ROUND","text":"<p>Rounds to a specified number of decimal places.</p> <pre><code>DECLARE result NUMBER = ROUND(3.14159, 2);\n-- Returns: 3.14\n</code></pre> <p>Syntax: <code>ROUND(number, decimals)</code></p> <p>Parameters:</p> Parameter Type Description number NUMBER Value to round decimals NUMBER Number of decimal places (default: 0)"},{"location":"functions/number/#trunc","title":"TRUNC","text":"<p>Truncates to a specified number of decimal places.</p> <pre><code>DECLARE result NUMBER = TRUNC(3.14159, 2);\n-- Returns: 3.14\n</code></pre> <p>Syntax: <code>TRUNC(number, decimals)</code></p> <p>TRUNC vs ROUND</p> <p><code>TRUNC</code> always removes digits toward zero, while <code>ROUND</code> uses standard rounding rules.</p>"},{"location":"functions/number/#mod","title":"MOD","text":"<p>Returns the remainder of division.</p> <pre><code>DECLARE result NUMBER = MOD(17, 5);\n-- Returns: 2\n</code></pre> <p>Syntax: <code>MOD(dividend, divisor)</code></p>"},{"location":"functions/number/#power","title":"POWER","text":"<p>Raises a number to a power.</p> <pre><code>DECLARE result NUMBER = POWER(2, 10);\n-- Returns: 1024\n</code></pre> <p>Syntax: <code>POWER(base, exponent)</code></p>"},{"location":"functions/number/#sqrt","title":"SQRT","text":"<p>Returns the square root.</p> <pre><code>DECLARE result NUMBER = SQRT(144);\n-- Returns: 12\n</code></pre> <p>Syntax: <code>SQRT(number)</code></p>"},{"location":"functions/number/#exp","title":"EXP","text":"<p>Returns e raised to a power.</p> <pre><code>DECLARE result NUMBER = EXP(1);\n-- Returns: 2.718281828...\n</code></pre> <p>Syntax: <code>EXP(number)</code></p>"},{"location":"functions/number/#log","title":"LOG","text":"<p>Returns the logarithm of a number.</p> <pre><code>DECLARE result NUMBER = LOG(100, 10);\n-- Returns: 2 (log base 10 of 100)\n</code></pre> <p>Syntax: <code>LOG(number, base)</code></p> <p>Parameters:</p> Parameter Type Description number NUMBER Value to take logarithm of base NUMBER Logarithm base"},{"location":"functions/number/#sign","title":"SIGN","text":"<p>Returns the sign of a number (-1, 0, or 1).</p> <pre><code>DECLARE result NUMBER = SIGN(-42);\n-- Returns: -1\n</code></pre> <p>Syntax: <code>SIGN(number)</code></p> <p>Returns:</p> Value Meaning -1 Negative number 0 Zero 1 Positive number"},{"location":"functions/number/#arithmetic-operators","title":"Arithmetic Operators","text":"<p>Standard arithmetic operators are available:</p> <pre><code>DECLARE a NUMBER = 10 + 5;   -- Addition: 15\nDECLARE b NUMBER = 10 - 5;   -- Subtraction: 5\nDECLARE c NUMBER = 10 * 5;   -- Multiplication: 50\nDECLARE d NUMBER = 10 / 5;   -- Division: 2\n</code></pre>"},{"location":"functions/number/#example-calculate-statistics","title":"Example: Calculate Statistics","text":"<pre><code>CREATE PROCEDURE calculate_stats(values ARRAY)\nBEGIN\n    DECLARE sum NUMBER = 0;\n    DECLARE count NUMBER = ARRAY_LENGTH(values);\n\n    FOR i IN 0..(count-1) LOOP\n        SET sum = sum + values[i];\n    END LOOP;\n\n    DECLARE mean NUMBER = sum / count;\n    PRINT 'Mean: ' || ROUND(mean, 2);\n\n    RETURN mean;\nEND PROCEDURE;\n</code></pre>"},{"location":"functions/overview/","title":"Functions Overview","text":"<p>elastic-script includes 106 built-in functions across 12 categories.</p>"},{"location":"functions/overview/#function-categories","title":"Function Categories","text":"Category Count Description String 18 Text manipulation Number 11 Mathematical operations Array 18 List operations Date 8 Date/time handling Document 6 JSON object manipulation Elasticsearch 5 ES operations AI &amp; LLM 14 AI/ML functions Integrations 26 External services"},{"location":"functions/overview/#quick-reference","title":"Quick Reference","text":""},{"location":"functions/overview/#string-functions","title":"String Functions","text":"<pre><code>LENGTH(str)              -- String length\nSUBSTR(str, start, len)  -- Substring\nUPPER(str)               -- Uppercase\nLOWER(str)               -- Lowercase\nTRIM(str)                -- Remove whitespace\nREPLACE(str, old, new)   -- Replace text\nCONCAT(str1, str2, ...)  -- Concatenate\nSPLIT(str, delimiter)    -- Split to array\n</code></pre>"},{"location":"functions/overview/#array-functions","title":"Array Functions","text":"<pre><code>ARRAY_LENGTH(arr)        -- Array size\nARRAY_APPEND(arr, val)   -- Add element\nARRAY_CONTAINS(arr, val) -- Check membership\nARRAY_FILTER(arr, fn)    -- Filter elements\nARRAY_MAP(arr, fn)       -- Transform elements\nARRAY_JOIN(arr, sep)     -- Join to string\n</code></pre>"},{"location":"functions/overview/#elasticsearch-functions","title":"Elasticsearch Functions","text":"<pre><code>ESQL_QUERY(query)        -- Execute ES|QL\nINDEX_DOCUMENT(idx, doc) -- Index document\nGET_DOCUMENT(idx, id)    -- Get by ID\nREFRESH_INDEX(idx)       -- Refresh index\n</code></pre>"},{"location":"functions/overview/#aillm-functions","title":"AI/LLM Functions","text":"<pre><code>LLM_COMPLETE(prompt)     -- Generate text\nLLM_SUMMARIZE(text)      -- Summarize text\nLLM_CLASSIFY(text, labels) -- Classify text\nINFERENCE(endpoint, input) -- ES Inference API\n</code></pre>"},{"location":"functions/overview/#integration-functions","title":"Integration Functions","text":"<pre><code>SLACK_SEND(channel, msg) -- Send to Slack\nPAGERDUTY_TRIGGER(...)   -- Create incident\nK8S_SCALE(ns, deploy, n) -- Scale deployment\nAWS_LAMBDA_INVOKE(...)   -- Invoke Lambda\n</code></pre>"},{"location":"functions/overview/#calling-functions","title":"Calling Functions","text":"<p>Functions are called like in SQL:</p> <pre><code>DECLARE len NUMBER = LENGTH('Hello');\nDECLARE upper STRING = UPPER(name);\nDECLARE logs ARRAY = ESQL_QUERY('FROM logs | LIMIT 10');\n</code></pre>"},{"location":"functions/overview/#chaining-functions","title":"Chaining Functions","text":"<pre><code>DECLARE result = UPPER(TRIM(SUBSTR(text, 1, 10)));\n</code></pre>"},{"location":"functions/overview/#function-discovery","title":"Function Discovery","text":"<p>List all available functions:</p> <pre><code>DECLARE functions ARRAY = ESCRIPT_FUNCTIONS();\n\nFOR func IN functions LOOP\n    PRINT func.name || ': ' || func.description;\nEND LOOP;\n</code></pre> <p>Get details for a specific function:</p> <pre><code>DECLARE info DOCUMENT = ESCRIPT_FUNCTION('ARRAY_MAP');\nPRINT info.signature;\nPRINT info.description;\nPRINT info.examples;\n</code></pre>"},{"location":"functions/overview/#next-steps","title":"Next Steps","text":"<p>Explore each category:</p> <ul> <li>String Functions - Text manipulation</li> <li>Array Functions - List operations</li> <li>Elasticsearch Functions - ES integration</li> <li>AI &amp; LLM Functions - AI capabilities</li> </ul>"},{"location":"functions/string/","title":"String Functions","text":"<p>String manipulation functions for text processing.</p>"},{"location":"functions/string/#function-reference","title":"Function Reference","text":""},{"location":"functions/string/#length","title":"LENGTH","text":"<p>Returns the length of a string.</p> <pre><code>DECLARE len NUMBER = LENGTH('Hello World');\n-- Returns: 11\n</code></pre> <p>Syntax: <code>LENGTH(string)</code></p> <p>Parameters:</p> Parameter Type Description string STRING Input string <p>Returns: NUMBER - The length of the string</p>"},{"location":"functions/string/#substr","title":"SUBSTR","text":"<p>Extracts a substring from a string.</p> <pre><code>DECLARE sub STRING = SUBSTR('Hello World', 1, 5);\n-- Returns: 'Hello'\n</code></pre> <p>Syntax: <code>SUBSTR(string, start, length)</code></p> <p>Parameters:</p> Parameter Type Description string STRING Input string start NUMBER Starting position (1-based) length NUMBER Number of characters to extract <p>Returns: STRING - The extracted substring</p>"},{"location":"functions/string/#upper","title":"UPPER","text":"<p>Converts a string to uppercase.</p> <pre><code>DECLARE result STRING = UPPER('hello');\n-- Returns: 'HELLO'\n</code></pre> <p>Syntax: <code>UPPER(string)</code></p>"},{"location":"functions/string/#lower","title":"LOWER","text":"<p>Converts a string to lowercase.</p> <pre><code>DECLARE result STRING = LOWER('HELLO');\n-- Returns: 'hello'\n</code></pre> <p>Syntax: <code>LOWER(string)</code></p>"},{"location":"functions/string/#trim","title":"TRIM","text":"<p>Removes leading and trailing whitespace.</p> <pre><code>DECLARE result STRING = TRIM('  hello  ');\n-- Returns: 'hello'\n</code></pre> <p>Syntax: <code>TRIM(string)</code></p>"},{"location":"functions/string/#ltrim","title":"LTRIM","text":"<p>Removes leading whitespace.</p> <pre><code>DECLARE result STRING = LTRIM('  hello');\n-- Returns: 'hello'\n</code></pre> <p>Syntax: <code>LTRIM(string)</code></p>"},{"location":"functions/string/#rtrim","title":"RTRIM","text":"<p>Removes trailing whitespace.</p> <pre><code>DECLARE result STRING = RTRIM('hello  ');\n-- Returns: 'hello'\n</code></pre> <p>Syntax: <code>RTRIM(string)</code></p>"},{"location":"functions/string/#replace","title":"REPLACE","text":"<p>Replaces occurrences of a substring.</p> <pre><code>DECLARE result STRING = REPLACE('hello world', 'world', 'everyone');\n-- Returns: 'hello everyone'\n</code></pre> <p>Syntax: <code>REPLACE(string, search, replacement)</code></p>"},{"location":"functions/string/#instr","title":"INSTR","text":"<p>Finds the position of a substring.</p> <pre><code>DECLARE pos NUMBER = INSTR('hello world', 'world');\n-- Returns: 7\n</code></pre> <p>Syntax: <code>INSTR(string, search)</code></p> <p>Returns: NUMBER - Position (1-based), or 0 if not found</p>"},{"location":"functions/string/#lpad","title":"LPAD","text":"<p>Left-pads a string to a specified length.</p> <pre><code>DECLARE result STRING = LPAD('42', 5, '0');\n-- Returns: '00042'\n</code></pre> <p>Syntax: <code>LPAD(string, length, pad_string)</code></p>"},{"location":"functions/string/#rpad","title":"RPAD","text":"<p>Right-pads a string to a specified length.</p> <pre><code>DECLARE result STRING = RPAD('42', 5, '0');\n-- Returns: '42000'\n</code></pre> <p>Syntax: <code>RPAD(string, length, pad_string)</code></p>"},{"location":"functions/string/#split","title":"SPLIT","text":"<p>Splits a string into an array.</p> <pre><code>DECLARE parts ARRAY = SPLIT('a,b,c', ',');\n-- Returns: ['a', 'b', 'c']\n</code></pre> <p>Syntax: <code>SPLIT(string, delimiter)</code></p> <p>Returns: ARRAY - Array of substrings</p>"},{"location":"functions/string/#regexp_replace","title":"REGEXP_REPLACE","text":"<p>Replaces text matching a regular expression.</p> <pre><code>DECLARE result STRING = REGEXP_REPLACE('hello 123 world', '[0-9]+', 'XXX');\n-- Returns: 'hello XXX world'\n</code></pre> <p>Syntax: <code>REGEXP_REPLACE(string, pattern, replacement)</code></p>"},{"location":"functions/string/#regexp_substr","title":"REGEXP_SUBSTR","text":"<p>Extracts text matching a regular expression.</p> <pre><code>DECLARE result STRING = REGEXP_SUBSTR('hello 123 world', '[0-9]+');\n-- Returns: '123'\n</code></pre> <p>Syntax: <code>REGEXP_SUBSTR(string, pattern)</code></p>"},{"location":"functions/string/#reverse","title":"REVERSE","text":"<p>Reverses a string.</p> <pre><code>DECLARE result STRING = REVERSE('hello');\n-- Returns: 'olleh'\n</code></pre> <p>Syntax: <code>REVERSE(string)</code></p>"},{"location":"functions/string/#initcap","title":"INITCAP","text":"<p>Capitalizes the first letter of each word.</p> <pre><code>DECLARE result STRING = INITCAP('hello world');\n-- Returns: 'Hello World'\n</code></pre> <p>Syntax: <code>INITCAP(string)</code></p>"},{"location":"functions/string/#env","title":"ENV","text":"<p>Reads an environment variable.</p> <pre><code>DECLARE home STRING = ENV('HOME');\n</code></pre> <p>Syntax: <code>ENV(variable_name)</code></p> <p>Security Note</p> <p>Environment variable access may be restricted in production environments.</p>"},{"location":"functions/string/#string-concatenation","title":"String Concatenation","text":"<p>Use the <code>||</code> operator to concatenate strings:</p> <pre><code>DECLARE greeting STRING = 'Hello' || ' ' || 'World';\n-- Returns: 'Hello World'\n</code></pre>"},{"location":"getting-started/installation/","title":"Installation","text":""},{"location":"getting-started/installation/#prerequisites","title":"Prerequisites","text":"<p>Before installing elastic-script, ensure you have:</p> <ul> <li>Java 21+ - Required for Elasticsearch 9.x</li> <li>Git - For cloning the repository</li> <li>8GB+ RAM - Elasticsearch needs memory</li> </ul> <p>Optional for development: - Python 3.9+ - For Jupyter notebooks - OpenAI API Key - For AI/LLM features</p>"},{"location":"getting-started/installation/#quick-start-recommended","title":"Quick Start (Recommended)","text":"<p>The fastest way to get started:</p> <pre><code># Clone the repository\ngit clone https://github.com/bahaaldine/elastic-script.git\ncd elastic-script\n\n# Run the quick-start script\n./scripts/quick-start.sh\n</code></pre> <p>This will:</p> <ol> <li>\u2705 Check prerequisites</li> <li>\u2705 Build the elastic-script plugin</li> <li>\u2705 Start Elasticsearch with the plugin</li> <li>\u2705 Load sample data (360 documents across 6 indices)</li> <li>\u2705 Set up Jupyter notebooks</li> <li>\u2705 Print curl examples</li> </ol> <p>OpenAI API Key</p> <p>The script will prompt for your OpenAI API key (optional). This enables AI functions like <code>LLM_COMPLETE()</code> and <code>LLM_SUMMARIZE()</code>.</p>"},{"location":"getting-started/installation/#manual-installation","title":"Manual Installation","text":""},{"location":"getting-started/installation/#1-clone-the-repository","title":"1. Clone the Repository","text":"<pre><code>git clone https://github.com/bahaaldine/elastic-script.git\ncd elastic-script\n\n# Initialize the Elasticsearch submodule\ngit submodule init\ngit submodule update\n</code></pre>"},{"location":"getting-started/installation/#2-build-the-plugin","title":"2. Build the Plugin","text":"<pre><code>cd elasticsearch\n./gradlew :x-pack:plugin:elastic-script:assemble\n</code></pre> <p>The plugin ZIP will be at: <pre><code>x-pack/plugin/elastic-script/build/distributions/elastic-script-*.zip\n</code></pre></p>"},{"location":"getting-started/installation/#3-start-elasticsearch","title":"3. Start Elasticsearch","text":"<p>For development:</p> <pre><code>./gradlew :run\n</code></pre> <p>For production, install the plugin:</p> <pre><code>bin/elasticsearch-plugin install file:///path/to/elastic-script-9.4.0-SNAPSHOT.zip\nbin/elasticsearch\n</code></pre>"},{"location":"getting-started/installation/#verify-installation","title":"Verify Installation","text":"<p>Check that elastic-script is working:</p> <pre><code># Health check\ncurl -u elastic-admin:elastic-password http://localhost:9200/_escript \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"query\": \"CREATE PROCEDURE test() BEGIN RETURN 42; END PROCEDURE;\"}'\n\n# Expected: {\"result\":{\"id\":\"test\",\"index\":\".elastic_script_procedures\",\"result\":\"created\"}}\n\ncurl -u elastic-admin:elastic-password http://localhost:9200/_escript \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"query\": \"CALL test()\"}'\n\n# Expected: {\"result\": 42}\n</code></pre>"},{"location":"getting-started/installation/#default-credentials","title":"Default Credentials","text":"<p>When using <code>./gradlew :run</code> (development mode):</p> Setting Value URL <code>http://localhost:9200</code> Username <code>elastic-admin</code> Password <code>elastic-password</code>"},{"location":"getting-started/installation/#sample-data","title":"Sample Data","text":"<p>The quick-start script loads sample data into these indices:</p> Index Documents Description <code>logs-sample</code> 100 Application logs with ERROR, WARN, INFO levels <code>metrics-sample</code> 80 System metrics (CPU, memory, latency) <code>users-sample</code> 30 User profiles with roles <code>orders-sample</code> 50 E-commerce orders <code>products-sample</code> 40 Product catalog <code>security-events</code> 60 Audit events"},{"location":"getting-started/installation/#stopping-services","title":"Stopping Services","text":"<pre><code># Stop everything\n./scripts/quick-start.sh --stop\n\n# Stop only Jupyter\n./scripts/quick-start.sh --stop-notebooks\n\n# Stop only Kibana (if running)\n./scripts/quick-start.sh --stop-kibana\n</code></pre>"},{"location":"getting-started/installation/#check-status","title":"Check Status","text":"<pre><code>./scripts/quick-start.sh --status\n</code></pre>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start Guide - Your first procedure</li> <li>Jupyter Setup - Interactive development</li> <li>Language Overview - Learn the syntax</li> </ul>"},{"location":"getting-started/jupyter-setup/","title":"Jupyter Notebook Setup","text":"<p>elastic-script includes a custom Jupyter kernel for interactive development.</p>"},{"location":"getting-started/jupyter-setup/#quick-setup","title":"Quick Setup","text":"<p>If you used <code>quick-start.sh</code>, Jupyter is already configured. Access it at:</p> <pre><code>http://localhost:8888\n</code></pre>"},{"location":"getting-started/jupyter-setup/#manual-setup","title":"Manual Setup","text":""},{"location":"getting-started/jupyter-setup/#1-install-python-dependencies","title":"1. Install Python Dependencies","text":"<pre><code>cd notebooks\npip install -r requirements.txt\n</code></pre>"},{"location":"getting-started/jupyter-setup/#2-install-the-kernel","title":"2. Install the Kernel","text":"<pre><code>cd kernel\n./install.sh\n</code></pre> <p>This installs <code>plesql_kernel</code> as a Jupyter kernel.</p>"},{"location":"getting-started/jupyter-setup/#3-start-jupyter","title":"3. Start Jupyter","text":"<pre><code>jupyter notebook\n</code></pre> <p>Or via quick-start: <pre><code>./scripts/quick-start.sh --notebooks\n</code></pre></p>"},{"location":"getting-started/jupyter-setup/#using-the-kernel","title":"Using the Kernel","text":""},{"location":"getting-started/jupyter-setup/#create-a-new-notebook","title":"Create a New Notebook","text":"<ol> <li>Open Jupyter at <code>http://localhost:8888</code></li> <li>Click \"New\" \u2192 \"plesql_kernel\"</li> <li>Start writing procedures!</li> </ol>"},{"location":"getting-started/jupyter-setup/#example-cells","title":"Example Cells","text":"<p>Cell 1: Create a procedure <pre><code>CREATE PROCEDURE hello()\nBEGIN\n    RETURN 'Hello from Jupyter!';\nEND PROCEDURE\n</code></pre></p> <p>Cell 2: Call it <pre><code>CALL hello()\n</code></pre></p> <p>Output: <pre><code>Hello from Jupyter!\n</code></pre></p>"},{"location":"getting-started/jupyter-setup/#available-notebooks","title":"Available Notebooks","text":"<p>The <code>notebooks/</code> directory includes example notebooks:</p> Notebook Description <code>01-getting-started.ipynb</code> Basic language features <code>02-esql-integration.ipynb</code> ES <code>03-ai-observability.ipynb</code> LLM functions <code>04-async-execution.ipynb</code> ON_DONE, PARALLEL <code>05-runbook-integrations.ipynb</code> Slack, K8s, PagerDuty <code>00-complete-reference.ipynb</code> All functions showcase"},{"location":"getting-started/jupyter-setup/#kernel-configuration","title":"Kernel Configuration","text":"<p>The kernel connects to Elasticsearch at:</p> <pre><code># notebooks/kernel/plesql_kernel.py\nself.es_endpoint = \"http://localhost:9200/_escript\"\nself.es_auth = (\"elastic-admin\", \"elastic-password\")\n</code></pre> <p>To change credentials, edit the kernel file.</p>"},{"location":"getting-started/jupyter-setup/#troubleshooting","title":"Troubleshooting","text":""},{"location":"getting-started/jupyter-setup/#kernel-not-found","title":"Kernel Not Found","text":"<pre><code># Reinstall the kernel\ncd notebooks/kernel\n./install.sh\n\n# Verify installation\njupyter kernelspec list\n</code></pre>"},{"location":"getting-started/jupyter-setup/#connection-refused","title":"Connection Refused","text":"<p>Ensure Elasticsearch is running: <pre><code>curl -u elastic-admin:elastic-password http://localhost:9200\n</code></pre></p>"},{"location":"getting-started/jupyter-setup/#syntax-errors","title":"Syntax Errors","text":"<p>The kernel expects elastic-script syntax, not Python:</p> <pre><code>-- \u2705 Correct\nCREATE PROCEDURE test() BEGIN RETURN 42; END PROCEDURE;\n\n-- \u274c Wrong (Python syntax)\ndef test():\n    return 42\n</code></pre>"},{"location":"getting-started/jupyter-setup/#tips","title":"Tips","text":""},{"location":"getting-started/jupyter-setup/#use-print-for-debugging","title":"Use PRINT for Debugging","text":"<pre><code>CREATE PROCEDURE debug_demo()\nBEGIN\n    DECLARE x NUMBER = 10;\n    PRINT 'Value of x: ' || x;\n\n    SET x = x * 2;\n    PRINT 'After doubling: ' || x;\n\n    RETURN x;\nEND PROCEDURE;\n</code></pre>"},{"location":"getting-started/jupyter-setup/#comments","title":"Comments","text":"<pre><code>-- Single line comment\n\n/*\n * Multi-line\n * comment\n */\n</code></pre>"},{"location":"getting-started/jupyter-setup/#view-all-procedures","title":"View All Procedures","text":"<pre><code>-- List stored procedures\nCALL ESCRIPT_PROCEDURES()\n</code></pre>"},{"location":"getting-started/quick-start/","title":"Quick Start","text":"<p>This guide will have you running elastic-script procedures in 5 minutes.</p>"},{"location":"getting-started/quick-start/#hello-world","title":"Hello World","text":"<p>Create your first procedure:</p> <pre><code>curl -u elastic-admin:elastic-password http://localhost:9200/_escript \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"query\": \"CREATE PROCEDURE hello_world() BEGIN RETURN '\\''Hello, World!'\\''; END PROCEDURE;\"\n  }'\n</code></pre> <p>Call it:</p> <pre><code>curl -u elastic-admin:elastic-password http://localhost:9200/_escript \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"query\": \"CALL hello_world()\"}'\n</code></pre> <p>Response: <pre><code>{\"result\": \"Hello, World!\"}\n</code></pre></p>"},{"location":"getting-started/quick-start/#with-parameters","title":"With Parameters","text":"<pre><code>CREATE PROCEDURE greet(name STRING)\nBEGIN\n    RETURN 'Hello, ' || name || '!';\nEND PROCEDURE;\n</code></pre> <pre><code>curl -u elastic-admin:elastic-password http://localhost:9200/_escript \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"query\": \"CALL greet('\\''Alice'\\'')\"}'\n</code></pre> <p>Response: <pre><code>{\"result\": \"Hello, Alice!\"}\n</code></pre></p>"},{"location":"getting-started/quick-start/#variables-and-types","title":"Variables and Types","text":"<pre><code>CREATE PROCEDURE demo_types()\nBEGIN\n    -- String\n    DECLARE message STRING = 'Hello';\n\n    -- Number\n    DECLARE count NUMBER = 42;\n\n    -- Boolean\n    DECLARE is_active BOOLEAN = TRUE;\n\n    -- Array\n    DECLARE items ARRAY = ['apple', 'banana', 'cherry'];\n\n    -- Document (JSON object)\n    DECLARE user DOCUMENT = {\"name\": \"John\", \"age\": 30};\n\n    PRINT 'Message: ' || message;\n    PRINT 'Count: ' || count;\n    PRINT 'Active: ' || is_active;\n    PRINT 'First item: ' || items[0];\n    PRINT 'User name: ' || user.name;\n\n    RETURN 'Demo complete!';\nEND PROCEDURE;\n</code></pre>"},{"location":"getting-started/quick-start/#control-flow","title":"Control Flow","text":""},{"location":"getting-started/quick-start/#ifthenelse","title":"IF/THEN/ELSE","text":"<pre><code>CREATE PROCEDURE check_severity(error_count NUMBER)\nBEGIN\n    DECLARE status STRING;\n\n    IF error_count == 0 THEN\n        SET status = 'Healthy';\n    ELSEIF error_count &lt; 10 THEN\n        SET status = 'Warning';\n    ELSE\n        SET status = 'Critical';\n    END IF;\n\n    RETURN status;\nEND PROCEDURE;\n</code></pre>"},{"location":"getting-started/quick-start/#for-loop","title":"FOR Loop","text":"<pre><code>CREATE PROCEDURE count_to(n NUMBER)\nBEGIN\n    FOR i IN 1..n LOOP\n        PRINT 'Count: ' || i;\n    END LOOP;\n\n    RETURN 'Done!';\nEND PROCEDURE;\n</code></pre>"},{"location":"getting-started/quick-start/#array-iteration","title":"Array Iteration","text":"<pre><code>CREATE PROCEDURE process_items()\nBEGIN\n    DECLARE fruits ARRAY = ['apple', 'banana', 'cherry'];\n\n    FOR fruit IN fruits LOOP\n        PRINT 'Processing: ' || fruit;\n    END LOOP;\n\n    RETURN ARRAY_LENGTH(fruits) || ' items processed';\nEND PROCEDURE;\n</code></pre>"},{"location":"getting-started/quick-start/#query-elasticsearch","title":"Query Elasticsearch","text":"<pre><code>CREATE PROCEDURE get_recent_logs()\nBEGIN\n    -- Execute ES|QL query\n    DECLARE logs ARRAY = ESQL_QUERY('FROM logs-sample | LIMIT 10');\n\n    PRINT 'Found ' || ARRAY_LENGTH(logs) || ' logs';\n\n    RETURN logs;\nEND PROCEDURE;\n</code></pre>"},{"location":"getting-started/quick-start/#error-handling","title":"Error Handling","text":"<pre><code>CREATE PROCEDURE safe_divide(a NUMBER, b NUMBER)\nBEGIN\n    TRY\n        IF b == 0 THEN\n            THROW 'Division by zero!';\n        END IF;\n        RETURN a / b;\n    CATCH\n        RETURN 'Error: Cannot divide by zero';\n    END TRY;\nEND PROCEDURE;\n</code></pre>"},{"location":"getting-started/quick-start/#next-steps","title":"Next Steps","text":"<ul> <li>Jupyter Setup - Interactive development</li> <li>Language Overview - Full syntax guide</li> <li>Function Reference - All 106 functions</li> </ul>"},{"location":"language/async-execution/","title":"Async Execution","text":"<p>elastic-script supports pipe-driven asynchronous execution, allowing you to chain procedures with continuations and run tasks in parallel.</p>"},{"location":"language/async-execution/#on_done-on_fail","title":"ON_DONE / ON_FAIL","text":"<p>Chain procedures with success and failure handlers:</p> <pre><code>CREATE PROCEDURE run_analysis()\nBEGIN\n    analyze_logs()\n        | ON_DONE handle_success(@result)\n        | ON_FAIL handle_error(@error);\n\n    RETURN 'Analysis started';\nEND PROCEDURE;\n</code></pre>"},{"location":"language/async-execution/#how-it-works","title":"How It Works","text":"<ol> <li><code>analyze_logs()</code> executes asynchronously</li> <li>On success: <code>handle_success()</code> is called with <code>@result</code></li> <li>On failure: <code>handle_error()</code> is called with <code>@error</code></li> <li>The calling procedure returns immediately</li> </ol>"},{"location":"language/async-execution/#bindings","title":"Bindings","text":"Binding Description Available In <code>@result</code> Return value of previous procedure <code>ON_DONE</code> <code>@error</code> Error message from failed procedure <code>ON_FAIL</code> <code>@results</code> Array of results from parallel execution <code>ON_ALL_DONE</code>"},{"location":"language/async-execution/#parallel-execution","title":"PARALLEL Execution","text":"<p>Run multiple procedures concurrently:</p> <pre><code>CREATE PROCEDURE fetch_all_data()\nBEGIN\n    PARALLEL [fetch_logs(), fetch_metrics(), fetch_events()]\n        | ON_ALL_DONE merge_results(@results);\n\n    RETURN 'Parallel fetch started';\nEND PROCEDURE;\n\nCREATE PROCEDURE merge_results(results ARRAY)\nBEGIN\n    PRINT 'Received ' || ARRAY_LENGTH(results) || ' results';\n    -- Process merged results\n    RETURN results;\nEND PROCEDURE;\n</code></pre>"},{"location":"language/async-execution/#parallel-continuations","title":"Parallel Continuations","text":"Continuation Triggered When <code>ON_ALL_DONE</code> All procedures complete successfully <code>ON_ANY_FAIL</code> Any procedure fails"},{"location":"language/async-execution/#track-as","title":"TRACK AS","text":"<p>Track execution state for later querying:</p> <pre><code>analyze_logs()\n    | ON_DONE handle_success(@result)\n    | TRACK AS 'daily-analysis';\n</code></pre> <p>Execution state is stored in <code>.escript_executions</code> index.</p>"},{"location":"language/async-execution/#execution-control","title":"EXECUTION Control","text":"<p>Query and control tracked executions:</p> <pre><code>-- Check status\nEXECUTION('daily-analysis') | STATUS;\n\n-- Cancel execution\nEXECUTION('daily-analysis') | CANCEL;\n\n-- Retry failed execution\nEXECUTION('daily-analysis') | RETRY;\n\n-- Wait for completion\nEXECUTION('daily-analysis') | WAIT;\n</code></pre>"},{"location":"language/async-execution/#finally","title":"FINALLY","text":"<p>Execute cleanup code regardless of success/failure:</p> <pre><code>process_data()\n    | ON_DONE save_results(@result)\n    | ON_FAIL log_error(@error)\n    | FINALLY cleanup();\n</code></pre>"},{"location":"language/async-execution/#complete-example","title":"Complete Example","text":"<pre><code>-- Main analysis procedure\nCREATE PROCEDURE analyze_logs(index_pattern STRING)\nBEGIN\n    PRINT 'Analyzing logs from: ' || index_pattern;\n\n    DECLARE errors CURSOR FOR\n        FROM logs-*\n        | WHERE level == \"ERROR\"\n        | WHERE @timestamp &gt; NOW() - 1 HOUR\n        | LIMIT 100;\n\n    DECLARE count NUMBER = 0;\n    FOR error IN errors LOOP\n        SET count = count + 1;\n    END LOOP;\n\n    RETURN { \"error_count\": count, \"index\": index_pattern };\nEND PROCEDURE;\n\n-- Success handler\nCREATE PROCEDURE handle_success(result DOCUMENT)\nBEGIN\n    PRINT 'Analysis complete: ' || result;\n\n    IF result.error_count &gt; 50 THEN\n        -- Trigger alert\n        SLACK_SEND('#alerts', 'High error count: ' || result.error_count);\n    END IF;\n\n    RETURN 'handled';\nEND PROCEDURE;\n\n-- Error handler\nCREATE PROCEDURE handle_error(error STRING)\nBEGIN\n    PRINT 'Analysis failed: ' || error;\n    PAGERDUTY_TRIGGER('Analysis pipeline failed', error);\n    RETURN 'error_handled';\nEND PROCEDURE;\n\n-- Run the pipeline\nCREATE PROCEDURE run_daily_analysis()\nBEGIN\n    analyze_logs('logs-*')\n        | ON_DONE handle_success(@result)\n        | ON_FAIL handle_error(@error)\n        | TRACK AS 'daily-analysis';\n\n    RETURN 'Analysis pipeline started';\nEND PROCEDURE;\n</code></pre>"},{"location":"language/async-execution/#execution-state","title":"Execution State","text":"<p>Tracked executions are stored in <code>.escript_executions</code>:</p> <pre><code>{\n  \"execution_id\": \"exec-abc123\",\n  \"track_name\": \"daily-analysis\",\n  \"status\": \"COMPLETED\",\n  \"procedure_name\": \"analyze_logs\",\n  \"result\": { \"error_count\": 42, \"index\": \"logs-*\" },\n  \"started_at\": \"2026-01-09T10:00:00Z\",\n  \"completed_at\": \"2026-01-09T10:00:05Z\",\n  \"duration_ms\": 5000\n}\n</code></pre>"},{"location":"language/async-execution/#best-practices","title":"Best Practices","text":"<p>Keep handlers simple</p> <p>Continuation handlers should be lightweight. Heavy processing should happen in the main procedure.</p> <p>Use TRACK for important workflows</p> <p>Track executions that you need to monitor or retry.</p> <p>Async is inside procedures only</p> <p>Async syntax (<code>|</code>) is only valid inside procedures, not as top-level API calls.</p>"},{"location":"language/control-flow/","title":"Control Flow","text":""},{"location":"language/control-flow/#if-then-else","title":"IF / THEN / ELSE","text":"<p>Conditional execution:</p> <pre><code>IF condition THEN\n    -- statements\nEND IF;\n</code></pre> <p>With ELSE:</p> <pre><code>IF error_count == 0 THEN\n    SET status = 'Healthy';\nELSE\n    SET status = 'Has errors';\nEND IF;\n</code></pre> <p>With ELSEIF:</p> <pre><code>IF error_count == 0 THEN\n    SET status = 'Healthy';\nELSEIF error_count &lt; 10 THEN\n    SET status = 'Warning';\nELSEIF error_count &lt; 100 THEN\n    SET status = 'Critical';\nELSE\n    SET status = 'Emergency';\nEND IF;\n</code></pre>"},{"location":"language/control-flow/#for-loop","title":"FOR Loop","text":""},{"location":"language/control-flow/#range-based","title":"Range-based","text":"<p>Iterate over a numeric range:</p> <pre><code>FOR i IN 1..10 LOOP\n    PRINT 'Count: ' || i;\nEND LOOP;\n</code></pre>"},{"location":"language/control-flow/#array-iteration","title":"Array iteration","text":"<p>Iterate over array elements:</p> <pre><code>DECLARE fruits ARRAY = ['apple', 'banana', 'cherry'];\n\nFOR fruit IN fruits LOOP\n    PRINT 'Processing: ' || fruit;\nEND LOOP;\n</code></pre>"},{"location":"language/control-flow/#cursor-iteration","title":"CURSOR iteration","text":"<p>Iterate over query results:</p> <pre><code>DECLARE logs CURSOR FOR\n    FROM logs-sample\n    | WHERE level == \"ERROR\"\n    | LIMIT 100;\n\nFOR log IN logs LOOP\n    PRINT log.message;\nEND LOOP;\n</code></pre>"},{"location":"language/control-flow/#while-loop","title":"WHILE Loop","text":"<p>Repeat while condition is true:</p> <pre><code>DECLARE i NUMBER = 0;\n\nWHILE i &lt; 10 LOOP\n    PRINT 'i = ' || i;\n    SET i = i + 1;\nEND LOOP;\n</code></pre> <p>Avoid infinite loops</p> <p>Always ensure the condition will eventually become false.</p>"},{"location":"language/control-flow/#loop-with-exit","title":"LOOP with EXIT","text":"<p>Manual loop control:</p> <pre><code>DECLARE i NUMBER = 0;\n\nLOOP\n    SET i = i + 1;\n\n    IF i &gt; 10 THEN\n        EXIT;  -- Break out of loop\n    END IF;\n\n    PRINT 'i = ' || i;\nEND LOOP;\n</code></pre>"},{"location":"language/control-flow/#continue","title":"CONTINUE","text":"<p>Skip to next iteration:</p> <pre><code>FOR i IN 1..10 LOOP\n    IF i % 2 == 0 THEN\n        CONTINUE;  -- Skip even numbers\n    END IF;\n\n    PRINT 'Odd: ' || i;\nEND LOOP;\n</code></pre>"},{"location":"language/control-flow/#nested-loops","title":"Nested Loops","text":"<pre><code>FOR i IN 1..3 LOOP\n    FOR j IN 1..3 LOOP\n        PRINT i || ' x ' || j || ' = ' || (i * j);\n    END LOOP;\nEND LOOP;\n</code></pre>"},{"location":"language/control-flow/#case-expression","title":"CASE Expression","text":"<p>Pattern matching (in expressions):</p> <pre><code>DECLARE status STRING;\nDECLARE severity NUMBER = 5;\n\nSET status = CASE severity\n    WHEN 1 THEN 'Low'\n    WHEN 2 THEN 'Medium'\n    WHEN 3 THEN 'High'\n    ELSE 'Unknown'\nEND;\n</code></pre>"},{"location":"language/control-flow/#early-return","title":"Early Return","text":"<p>Exit procedure early:</p> <pre><code>CREATE PROCEDURE find_user(id NUMBER)\nBEGIN\n    IF id &lt;= 0 THEN\n        RETURN NULL;  -- Early exit\n    END IF;\n\n    -- Continue processing...\n    RETURN user;\nEND PROCEDURE;\n</code></pre>"},{"location":"language/error-handling/","title":"Error Handling","text":""},{"location":"language/error-handling/#try-catch-finally","title":"TRY / CATCH / FINALLY","text":"<p>Handle errors gracefully:</p> <pre><code>TRY\n    -- Code that might fail\n    DECLARE result = risky_operation();\nCATCH\n    -- Handle error\n    PRINT 'An error occurred';\nFINALLY\n    -- Always executed\n    cleanup();\nEND TRY;\n</code></pre>"},{"location":"language/error-handling/#basic-example","title":"Basic Example","text":"<pre><code>CREATE PROCEDURE safe_divide(a NUMBER, b NUMBER)\nBEGIN\n    TRY\n        IF b == 0 THEN\n            THROW 'Division by zero!';\n        END IF;\n        RETURN a / b;\n    CATCH\n        RETURN NULL;\n    END TRY;\nEND PROCEDURE;\n</code></pre>"},{"location":"language/error-handling/#throw","title":"THROW","text":"<p>Raise an error:</p> <pre><code>THROW 'Error message';\n</code></pre> <p>With context:</p> <pre><code>IF user == NULL THEN\n    THROW 'User not found: ' || user_id;\nEND IF;\n</code></pre>"},{"location":"language/error-handling/#catching-specific-errors","title":"Catching Specific Errors","text":"<p>The <code>@error</code> variable contains the error message:</p> <pre><code>TRY\n    -- Code\nCATCH\n    PRINT 'Caught error: ' || @error;\n\n    IF @error LIKE '%timeout%' THEN\n        -- Handle timeout\n    ELSEIF @error LIKE '%not found%' THEN\n        -- Handle not found\n    ELSE\n        -- Re-throw unknown errors\n        THROW @error;\n    END IF;\nEND TRY;\n</code></pre>"},{"location":"language/error-handling/#finally-block","title":"FINALLY Block","text":"<p>Always executed, even if an error occurred:</p> <pre><code>TRY\n    -- Open resources\n    DECLARE conn = open_connection();\n    -- Use connection\nCATCH\n    PRINT 'Error: ' || @error;\nFINALLY\n    -- Always close\n    close_connection(conn);\nEND TRY;\n</code></pre>"},{"location":"language/error-handling/#nested-try-blocks","title":"Nested TRY Blocks","text":"<pre><code>TRY\n    TRY\n        -- Inner operation\n        risky_call();\n    CATCH\n        PRINT 'Inner error handled';\n    END TRY;\n\n    -- Continue outer block\n    another_call();\nCATCH\n    PRINT 'Outer error: ' || @error;\nEND TRY;\n</code></pre>"},{"location":"language/error-handling/#error-propagation","title":"Error Propagation","text":"<p>Errors propagate up if not caught:</p> <pre><code>CREATE PROCEDURE inner_proc()\nBEGIN\n    THROW 'Something went wrong!';\nEND PROCEDURE;\n\nCREATE PROCEDURE outer_proc()\nBEGIN\n    TRY\n        CALL inner_proc();  -- Error propagates here\n    CATCH\n        PRINT 'Caught from inner: ' || @error;\n    END TRY;\nEND PROCEDURE;\n</code></pre>"},{"location":"language/error-handling/#validation-pattern","title":"Validation Pattern","text":"<pre><code>CREATE PROCEDURE validate_order(order DOCUMENT)\nBEGIN\n    IF order.quantity &lt;= 0 THEN\n        THROW 'Quantity must be positive';\n    END IF;\n\n    IF order.price &lt; 0 THEN\n        THROW 'Price cannot be negative';\n    END IF;\n\n    IF order.customer_id == NULL THEN\n        THROW 'Customer ID is required';\n    END IF;\n\n    RETURN TRUE;\nEND PROCEDURE;\n</code></pre>"},{"location":"language/error-handling/#retry-pattern","title":"Retry Pattern","text":"<pre><code>CREATE PROCEDURE with_retry(max_attempts NUMBER)\nBEGIN\n    DECLARE attempt NUMBER = 0;\n\n    WHILE attempt &lt; max_attempts LOOP\n        SET attempt = attempt + 1;\n\n        TRY\n            DECLARE result = call_api();\n            RETURN result;  -- Success, exit\n        CATCH\n            PRINT 'Attempt ' || attempt || ' failed: ' || @error;\n\n            IF attempt &gt;= max_attempts THEN\n                THROW 'Max retries exceeded: ' || @error;\n            END IF;\n\n            -- Wait before retry (if available)\n            -- SLEEP(1000);\n        END TRY;\n    END LOOP;\nEND PROCEDURE;\n</code></pre>"},{"location":"language/error-handling/#best-practices","title":"Best Practices","text":"<p>Be Specific</p> <p>Catch specific error types when possible.</p> <p>Log Errors</p> <p>Always log errors for debugging.</p> <p>Don't Swallow Errors</p> <p>Empty CATCH blocks hide problems.</p> <pre><code>-- \u274c Bad: swallowing errors\nTRY\n    risky_call();\nCATCH\n    -- Silent failure\nEND TRY;\n\n-- \u2705 Good: handle or log\nTRY\n    risky_call();\nCATCH\n    PRINT 'Error in risky_call: ' || @error;\n    -- Take appropriate action\nEND TRY;\n</code></pre>"},{"location":"language/overview/","title":"Language Overview","text":"<p>elastic-script is a procedural scripting language designed to run inside Elasticsearch. It combines familiar SQL-like syntax with modern programming constructs.</p>"},{"location":"language/overview/#key-concepts","title":"Key Concepts","text":""},{"location":"language/overview/#procedures","title":"Procedures","text":"<p>Everything in elastic-script is organized into procedures:</p> <pre><code>CREATE PROCEDURE my_procedure(param1 STRING, param2 NUMBER)\nBEGIN\n    -- Your code here\n    RETURN result;\nEND PROCEDURE;\n</code></pre> <p>Procedures are: - Stored in the <code>.elastic_script_procedures</code> index - Called with <code>CALL procedure_name(args)</code> - Persistent across Elasticsearch restarts</p>"},{"location":"language/overview/#statements","title":"Statements","text":"<p>Procedures contain statements:</p> Statement Purpose <code>DECLARE</code> Create variables <code>SET</code> Assign values <code>PRINT</code> Output to logs <code>IF/THEN/ELSE</code> Conditionals <code>FOR/WHILE</code> Loops <code>TRY/CATCH</code> Error handling <code>RETURN</code> Return value <code>THROW</code> Raise errors"},{"location":"language/overview/#expressions","title":"Expressions","text":"<p>Expressions evaluate to values:</p> <pre><code>-- Arithmetic\nSET x = 10 + 5 * 2;\n\n-- String concatenation\nSET message = 'Hello, ' || name || '!';\n\n-- Comparison\nIF x &gt; 10 THEN ...\n\n-- Function calls\nSET len = LENGTH(message);\n</code></pre>"},{"location":"language/overview/#data-types","title":"Data Types","text":"Type Description Example <code>STRING</code> Text <code>'Hello'</code> or <code>\"World\"</code> <code>NUMBER</code> Numeric <code>42</code>, <code>3.14</code>, <code>-5</code> <code>BOOLEAN</code> True/False <code>TRUE</code>, <code>FALSE</code> <code>DATE</code> Date/timestamp <code>CURRENT_DATE()</code> <code>ARRAY</code> List <code>[1, 2, 3]</code>, <code>['a', 'b']</code> <code>DOCUMENT</code> JSON object <code>{\"key\": \"value\"}</code> <code>CURSOR</code> Query result iterator <code>CURSOR FOR FROM ...</code>"},{"location":"language/overview/#operators","title":"Operators","text":""},{"location":"language/overview/#arithmetic","title":"Arithmetic","text":"<pre><code>+   -- Addition\n-   -- Subtraction\n*   -- Multiplication\n/   -- Division\n%   -- Modulo\n</code></pre>"},{"location":"language/overview/#comparison","title":"Comparison","text":"<pre><code>==  -- Equal\n&lt;&gt;  -- Not equal\n!=  -- Not equal (alias)\n&lt;   -- Less than\n&gt;   -- Greater than\n&lt;=  -- Less than or equal\n&gt;=  -- Greater than or equal\n</code></pre>"},{"location":"language/overview/#logical","title":"Logical","text":"<pre><code>AND -- Logical AND\nOR  -- Logical OR\nNOT -- Logical NOT\n</code></pre>"},{"location":"language/overview/#string","title":"String","text":"<pre><code>||  -- Concatenation\n</code></pre>"},{"location":"language/overview/#special","title":"Special","text":"<pre><code>??  -- Null coalescing\n?.  -- Safe navigation\n..  -- Range (for loops)\n</code></pre>"},{"location":"language/overview/#comments","title":"Comments","text":"<pre><code>-- Single line comment\n\n/* Multi-line\n   comment */\n</code></pre>"},{"location":"language/overview/#api-endpoints","title":"API Endpoints","text":"<p>elastic-script exposes REST endpoints:</p> Endpoint Method Purpose <code>/_escript</code> POST Execute queries <code>/_escript/procedures/{id}</code> GET Get procedure <code>/_escript/procedures/{id}</code> DELETE Delete procedure <code>/_escript/procedures/{id}/_call</code> POST Call with params"},{"location":"language/overview/#query-structure","title":"Query Structure","text":"<p>All queries go through <code>POST /_escript</code>:</p> <pre><code>curl -u user:pass http://localhost:9200/_escript \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"query\": \"YOUR QUERY HERE\"}'\n</code></pre> <p>Valid top-level queries: - <code>CREATE PROCEDURE ...</code> - <code>DELETE PROCEDURE ...</code> - <code>CALL procedure_name(...)</code> - <code>DEFINE INTENT ...</code></p>"},{"location":"language/overview/#next-steps","title":"Next Steps","text":"<ul> <li>Variables &amp; Types</li> <li>Control Flow</li> <li>Procedures</li> <li>Async Execution</li> </ul>"},{"location":"language/procedures/","title":"Procedures","text":"<p>Procedures are the fundamental building blocks of elastic-script.</p>"},{"location":"language/procedures/#creating-procedures","title":"Creating Procedures","text":"<pre><code>CREATE PROCEDURE procedure_name(parameters)\nBEGIN\n    -- statements\nEND PROCEDURE;\n</code></pre>"},{"location":"language/procedures/#example","title":"Example","text":"<pre><code>CREATE PROCEDURE greet(name STRING)\nBEGIN\n    RETURN 'Hello, ' || name || '!';\nEND PROCEDURE;\n</code></pre>"},{"location":"language/procedures/#parameters","title":"Parameters","text":""},{"location":"language/procedures/#parameter-modes","title":"Parameter Modes","text":"Mode Description <code>IN</code> Input only (default) <code>OUT</code> Output only <code>INOUT</code> Both input and output <pre><code>CREATE PROCEDURE calculate(IN x NUMBER, IN y NUMBER, OUT result NUMBER)\nBEGIN\n    SET result = x + y;\nEND PROCEDURE;\n</code></pre>"},{"location":"language/procedures/#parameter-types","title":"Parameter Types","text":"<pre><code>CREATE PROCEDURE example(\n    name STRING,\n    count NUMBER,\n    is_active BOOLEAN,\n    items ARRAY,\n    config DOCUMENT\n)\nBEGIN\n    -- Use parameters\nEND PROCEDURE;\n</code></pre>"},{"location":"language/procedures/#default-values","title":"Default Values","text":"<pre><code>CREATE PROCEDURE greet(name STRING DEFAULT 'World')\nBEGIN\n    RETURN 'Hello, ' || name || '!';\nEND PROCEDURE;\n</code></pre>"},{"location":"language/procedures/#calling-procedures","title":"Calling Procedures","text":"<pre><code>CALL procedure_name(arguments)\n</code></pre>"},{"location":"language/procedures/#examples","title":"Examples","text":"<pre><code>-- Simple call\nCALL greet('Alice')\n\n-- With multiple arguments\nCALL calculate(10, 20)\n\n-- With named arguments (future)\nCALL send_email(to: 'user@example.com', subject: 'Hello')\n</code></pre>"},{"location":"language/procedures/#return-values","title":"Return Values","text":""},{"location":"language/procedures/#single-value","title":"Single Value","text":"<pre><code>CREATE PROCEDURE add(a NUMBER, b NUMBER)\nBEGIN\n    RETURN a + b;\nEND PROCEDURE;\n</code></pre>"},{"location":"language/procedures/#document-object","title":"Document (Object)","text":"<pre><code>CREATE PROCEDURE get_stats()\nBEGIN\n    RETURN {\n        \"count\": 42,\n        \"average\": 3.14,\n        \"status\": \"ok\"\n    };\nEND PROCEDURE;\n</code></pre>"},{"location":"language/procedures/#array","title":"Array","text":"<pre><code>CREATE PROCEDURE get_items()\nBEGIN\n    RETURN ['apple', 'banana', 'cherry'];\nEND PROCEDURE;\n</code></pre>"},{"location":"language/procedures/#no-return","title":"No Return","text":"<p>Procedures without <code>RETURN</code> return <code>NULL</code>:</p> <pre><code>CREATE PROCEDURE log_event(message STRING)\nBEGIN\n    PRINT message;\n    INDEX_DOCUMENT('audit-log', {\"message\": message});\nEND PROCEDURE;\n</code></pre>"},{"location":"language/procedures/#deleting-procedures","title":"Deleting Procedures","text":"<pre><code>DELETE PROCEDURE procedure_name;\n</code></pre>"},{"location":"language/procedures/#listing-procedures","title":"Listing Procedures","text":"<pre><code>-- Get all procedures\nDECLARE procs ARRAY = ESCRIPT_PROCEDURES();\n\n-- Get specific procedure\nDECLARE proc DOCUMENT = ESCRIPT_PROCEDURE('greet');\n</code></pre>"},{"location":"language/procedures/#stored-procedures","title":"Stored Procedures","text":"<p>Procedures are stored in <code>.elastic_script_procedures</code>:</p> <pre><code>{\n  \"_id\": \"greet\",\n  \"_source\": {\n    \"id\": \"greet\",\n    \"body\": \"CREATE PROCEDURE greet(name STRING) BEGIN RETURN 'Hello, ' || name || '!'; END PROCEDURE;\",\n    \"created_at\": \"2026-01-09T10:00:00Z\"\n  }\n}\n</code></pre>"},{"location":"language/procedures/#calling-other-procedures","title":"Calling Other Procedures","text":"<p>Procedures can call other procedures:</p> <pre><code>CREATE PROCEDURE helper()\nBEGIN\n    RETURN 'I helped!';\nEND PROCEDURE;\n\nCREATE PROCEDURE main()\nBEGIN\n    DECLARE result STRING = CALL helper();\n    PRINT 'Helper said: ' || result;\n    RETURN result;\nEND PROCEDURE;\n</code></pre>"},{"location":"language/procedures/#best-practices","title":"Best Practices","text":"<p>Single Responsibility</p> <p>Each procedure should do one thing well.</p> <p>Meaningful Names</p> <p>Use descriptive names: <code>calculate_order_total</code> not <code>proc1</code>.</p> <p>Document Parameters</p> <p>Use comments to explain what each parameter does.</p> <pre><code>CREATE PROCEDURE process_order(\n    order_id STRING,     -- Unique order identifier\n    apply_discount BOOLEAN DEFAULT FALSE  -- Apply loyalty discount\n)\nBEGIN\n    -- Implementation\nEND PROCEDURE;\n</code></pre>"},{"location":"language/variables-types/","title":"Variables &amp; Types","text":""},{"location":"language/variables-types/#declaring-variables","title":"Declaring Variables","text":"<p>Use <code>DECLARE</code> to create variables:</p> <pre><code>DECLARE name STRING = 'Alice';\nDECLARE count NUMBER = 42;\nDECLARE is_active BOOLEAN = TRUE;\n</code></pre> <p>Or use <code>VAR</code> for shorthand:</p> <pre><code>VAR name = 'Alice';  -- Type inferred as STRING\n</code></pre>"},{"location":"language/variables-types/#data-types","title":"Data Types","text":""},{"location":"language/variables-types/#string","title":"STRING","text":"<p>Text values with single or double quotes:</p> <pre><code>DECLARE message STRING = 'Hello, World!';\nDECLARE alt STRING = \"Also valid\";\n</code></pre> <p>Operations: <pre><code>-- Concatenation\nSET full_name = first_name || ' ' || last_name;\n\n-- Length\nSET len = LENGTH(message);\n\n-- Substring\nSET part = SUBSTR(message, 1, 5);  -- 'Hello'\n</code></pre></p>"},{"location":"language/variables-types/#number","title":"NUMBER","text":"<p>Integer and floating-point values:</p> <pre><code>DECLARE count NUMBER = 42;\nDECLARE price NUMBER = 19.99;\nDECLARE negative NUMBER = -5;\n</code></pre> <p>Operations: <pre><code>SET total = price * quantity;\nSET average = total / count;\nSET remainder = count % 10;\n</code></pre></p>"},{"location":"language/variables-types/#boolean","title":"BOOLEAN","text":"<p>True or false values (case-insensitive):</p> <pre><code>DECLARE is_active BOOLEAN = TRUE;\nDECLARE is_deleted BOOLEAN = false;\nDECLARE flag BOOLEAN = True;\n</code></pre> <p>Operations: <pre><code>IF is_active AND NOT is_deleted THEN\n    PRINT 'Active record';\nEND IF;\n</code></pre></p>"},{"location":"language/variables-types/#array","title":"ARRAY","text":"<p>Ordered list of values:</p> <pre><code>DECLARE numbers ARRAY = [1, 2, 3, 4, 5];\nDECLARE fruits ARRAY = ['apple', 'banana', 'cherry'];\nDECLARE mixed ARRAY = [1, 'two', TRUE];\n</code></pre> <p>Access: <pre><code>SET first = numbers[0];    -- 1\nSET last = numbers[4];     -- 5\n</code></pre></p> <p>Operations: <pre><code>SET len = ARRAY_LENGTH(fruits);            -- 3\nSET extended = ARRAY_APPEND(fruits, 'date');\nSET found = ARRAY_CONTAINS(fruits, 'apple');  -- TRUE\n</code></pre></p>"},{"location":"language/variables-types/#document","title":"DOCUMENT","text":"<p>JSON objects:</p> <pre><code>DECLARE user DOCUMENT = {\n    \"name\": \"John\",\n    \"age\": 30,\n    \"email\": \"john@example.com\"\n};\n</code></pre> <p>Access: <pre><code>SET name = user.name;           -- Dot notation\nSET age = DOCUMENT_GET(user, 'age');\n</code></pre></p> <p>Operations: <pre><code>SET keys = DOCUMENT_KEYS(user);      -- ['name', 'age', 'email']\nSET values = DOCUMENT_VALUES(user);   -- ['John', 30, 'john@...']\nSET has_name = DOCUMENT_CONTAINS(user, 'name');  -- TRUE\n</code></pre></p>"},{"location":"language/variables-types/#date","title":"DATE","text":"<p>Date and timestamp values:</p> <pre><code>DECLARE today DATE = CURRENT_DATE();\nDECLARE now DATE = CURRENT_TIMESTAMP();\n</code></pre> <p>Operations: <pre><code>SET tomorrow = DATE_ADD(today, 1, 'DAY');\nSET year = EXTRACT_YEAR(today);\nSET month = EXTRACT_MONTH(today);\n</code></pre></p>"},{"location":"language/variables-types/#cursor","title":"CURSOR","text":"<p>Iterator for query results:</p> <pre><code>DECLARE logs CURSOR FOR\n    FROM logs-sample\n    | WHERE level == \"ERROR\"\n    | LIMIT 100;\n\nFOR log IN logs LOOP\n    PRINT log.message;\nEND LOOP;\n</code></pre>"},{"location":"language/variables-types/#assigning-values","title":"Assigning Values","text":"<p>Use <code>SET</code> to assign values:</p> <pre><code>DECLARE x NUMBER = 0;\nSET x = 10;\nSET x = x + 5;\n</code></pre>"},{"location":"language/variables-types/#constants","title":"Constants","text":"<p>Use <code>CONST</code> for immutable values:</p> <pre><code>CONST MAX_RETRIES = 3;\nCONST API_URL = 'https://api.example.com';\n</code></pre>"},{"location":"language/variables-types/#type-conversion","title":"Type Conversion","text":"<p>Implicit conversion happens in many cases:</p> <pre><code>DECLARE num NUMBER = 42;\nPRINT 'Value: ' || num;  -- NUMBER converted to STRING\n</code></pre>"},{"location":"language/variables-types/#null-handling","title":"Null Handling","text":"<pre><code>DECLARE maybe_null STRING;  -- NULL by default\n\n-- Null coalescing\nSET value = maybe_null ?? 'default';\n\n-- Safe navigation\nSET name = user?.profile?.name;\n</code></pre>"},{"location":"language/variables-types/#scope","title":"Scope","text":"<p>Variables are scoped to their procedure:</p> <pre><code>CREATE PROCEDURE outer()\nBEGIN\n    DECLARE x NUMBER = 10;\n\n    -- x is visible here\n    CALL inner();  -- inner() cannot see x\n\n    RETURN x;\nEND PROCEDURE;\n</code></pre>"},{"location":"notebooks/","title":"Interactive Notebooks","text":"<p>Learn elastic-script through hands-on Jupyter notebooks.</p>"},{"location":"notebooks/#overview","title":"Overview","text":"<p>These notebooks provide interactive tutorials for learning elastic-script. Each notebook focuses on a specific topic and includes runnable code examples.</p> <p>Running the Notebooks</p> <p>The quickest way to get started:</p> <pre><code>git clone https://github.com/bahaaldine/elastic-script.git\ncd elastic-script\n./scripts/quick-start.sh\n</code></pre> <p>This starts Elasticsearch, loads sample data, and launches Jupyter at <code>http://localhost:8888</code></p>"},{"location":"notebooks/#available-notebooks","title":"Available Notebooks","text":""},{"location":"notebooks/#1-getting-started","title":"1. Getting Started","text":"<p>File: <code>01-getting-started.ipynb</code></p> <p>Learn the fundamentals:</p> <ul> <li>Creating your first procedure</li> <li>Variables and data types</li> <li>Control flow (IF/ELSE, FOR loops)</li> <li>Error handling with TRY/CATCH</li> </ul> <p>View Notebook \u2192</p>"},{"location":"notebooks/#2-esql-integration","title":"2. ES|QL Integration","text":"<p>File: <code>02-esql-integration.ipynb</code></p> <p>Query Elasticsearch data:</p> <ul> <li>Using <code>ESQL_QUERY()</code> to fetch data</li> <li>Working with cursors for result iteration</li> <li>Aggregations and statistics</li> <li>Data transformation pipelines</li> </ul> <p>View Notebook \u2192</p>"},{"location":"notebooks/#3-ai-observability","title":"3. AI &amp; Observability","text":"<p>File: <code>03-ai-observability.ipynb</code></p> <p>AI-powered automation:</p> <ul> <li>Log summarization with LLMs</li> <li>Intelligent error classification</li> <li>Anomaly detection</li> <li>Automated root cause analysis</li> </ul> <p>Requires OpenAI API Key</p> <p>Set <code>OPENAI_API_KEY</code> environment variable before running.</p> <p>View Notebook \u2192</p>"},{"location":"notebooks/#4-async-execution","title":"4. Async Execution","text":"<p>File: <code>04-async-execution.ipynb</code></p> <p>Pipe-driven workflows:</p> <ul> <li>Async procedure execution with <code>ON_DONE</code>/<code>ON_FAIL</code></li> <li>Error handling with <code>FINALLY</code></li> <li>Parallel execution with <code>PARALLEL</code></li> <li>Execution tracking with <code>EXECUTION() | STATUS</code></li> </ul> <p>View Notebook \u2192</p>"},{"location":"notebooks/#5-runbook-integrations","title":"5. Runbook Integrations","text":"<p>File: <code>05-runbook-integrations.ipynb</code></p> <p>External service integration:</p> <ul> <li>Kubernetes operations</li> <li>PagerDuty incident management</li> <li>AWS Lambda invocation</li> <li>Slack notifications</li> <li>HTTP requests</li> </ul> <p>View Notebook \u2192</p>"},{"location":"notebooks/#complete-reference","title":"Complete Reference","text":"<p>File: <code>00-complete-reference.ipynb</code></p> <p>Comprehensive examples of all features:</p> <ul> <li>All 106 built-in functions</li> <li>Every language construct</li> <li>Edge cases and advanced patterns</li> </ul> <p>View Notebook \u2192</p>"},{"location":"notebooks/#notebook-requirements","title":"Notebook Requirements","text":"<p>The notebooks use a custom Jupyter kernel (<code>plesql_kernel</code>) that communicates with Elasticsearch.</p>"},{"location":"notebooks/#prerequisites","title":"Prerequisites","text":"<ul> <li>Python 3.9+</li> <li>Elasticsearch running with elastic-script plugin</li> <li>Jupyter Notebook or JupyterLab</li> </ul>"},{"location":"notebooks/#manual-setup","title":"Manual Setup","text":"<p>If you prefer manual setup over the quick-start script:</p> <pre><code># Install Python dependencies\ncd notebooks\npip install -r requirements.txt\n\n# Install the kernel\ncd kernel\n./install.sh\n\n# Start Jupyter\njupyter notebook\n</code></pre>"},{"location":"notebooks/#sample-data","title":"Sample Data","text":"<p>The notebooks expect sample data to be loaded. The quick-start script handles this automatically, but you can also load it manually:</p> <pre><code># Load sample logs data\ncurl -u elastic-admin:elastic-password -X POST \"localhost:9200/logs-sample/_doc\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"@timestamp\": \"2026-01-09T10:00:00Z\", \"level\": \"ERROR\", \"message\": \"Connection timeout\"}'\n</code></pre>"},{"location":"notebooks/#troubleshooting","title":"Troubleshooting","text":""},{"location":"notebooks/#kernel-not-found","title":"Kernel Not Found","text":"<p>If Jupyter doesn't show the <code>plesql_kernel</code>:</p> <pre><code>cd notebooks/kernel\n./install.sh\n# Restart Jupyter\n</code></pre>"},{"location":"notebooks/#connection-refused","title":"Connection Refused","text":"<p>Make sure Elasticsearch is running:</p> <pre><code>curl -u elastic-admin:elastic-password http://localhost:9200\n</code></pre>"},{"location":"notebooks/#syntax-errors","title":"Syntax Errors","text":"<p>Ensure you're using the <code>plesql_kernel</code>, not Python:</p> <ol> <li>In Jupyter, go to Kernel \u2192 Change Kernel</li> <li>Select \"PL|ESQL (elastic-script)\"</li> </ol>"},{"location":"notebooks/ai-observability/","title":"AI &amp; Observability","text":"<p>Interactive Notebook</p> <p>This page is generated from a Jupyter notebook. For the best experience,  run it interactively in Jupyter:</p> <pre><code>./scripts/quick-start.sh\n# Then open http://localhost:8888/notebooks/03-ai-observability.ipynb\n</code></pre> <p> View on GitHub</p>"},{"location":"notebooks/ai-observability/#ai-powered-observability","title":"\ud83e\udd16 AI-Powered Observability","text":"<p>This notebook demonstrates how to use elastic-script with AI/LLM capabilities for intelligent log analysis and observability automation.</p>"},{"location":"notebooks/ai-observability/#features-covered","title":"Features Covered","text":"<ul> <li>Using LLM_COMPLETE() for natural language analysis</li> <li>Semantic search with embeddings</li> <li>Intelligent incident investigation</li> <li>Automated report generation</li> </ul>"},{"location":"notebooks/ai-observability/#error-log-summarization","title":"Error Log Summarization","text":"<p>Query Elasticsearch for error logs and use an LLM to analyze patterns:</p> <pre><code>CREATE PROCEDURE summarize_errors()\nBEGIN\n    DECLARE error_logs CURSOR FOR\n        FROM logs-sample\n        | WHERE level == \"ERROR\"\n        | LIMIT 50;\n\n    DECLARE error_messages STRING = '';\n    DECLARE error_count NUMBER = 0;\n\n    FOR log_entry IN error_logs LOOP\n        SET error_messages = error_messages || log_entry['message'] || '\\n';\n        SET error_count = error_count + 1;\n    END LOOP\n\n    IF error_count &gt; 0 THEN\n        DECLARE prompt STRING = 'Analyze these error logs and provide a summary:\\n\\n' || error_messages;\n        DECLARE summary STRING = LLM_COMPLETE(prompt);\n\n        PRINT 'Found ' || error_count || ' errors. Summary:';\n        PRINT summary;\n        RETURN summary;\n    ELSE\n        PRINT 'No errors found in the logs.';\n        RETURN 'No errors found';\n    END IF\nEND PROCEDURE\n</code></pre> <pre><code>CALL summarize_errors()\n</code></pre>"},{"location":"notebooks/ai-observability/#anomaly-detection","title":"Anomaly Detection","text":"<p>Scan for unusual patterns and get AI-powered analysis:</p> <pre><code>CREATE PROCEDURE detect_anomalies()\nBEGIN\n    DECLARE recent_errors CURSOR FOR\n        FROM logs-sample\n        | WHERE level == \"ERROR\"\n        | SORT @timestamp DESC\n        | LIMIT 30;\n\n    DECLARE error_timeline STRING = 'Recent errors:\\n';\n    DECLARE count NUMBER = 0;\n\n    FOR err IN recent_errors LOOP\n        SET error_timeline = error_timeline || err['service'] || ': ' || err['message'] || '\\n';\n        SET count = count + 1;\n    END LOOP\n\n    IF count &gt; 10 THEN\n        DECLARE prompt STRING = 'Analyze this error timeline for anomalies. Provide urgency level (LOW/MEDIUM/HIGH/CRITICAL):\\n\\n' || error_timeline;\n        DECLARE analysis STRING = LLM_COMPLETE(prompt);\n\n        PRINT '\u26a0\ufe0f ANOMALY DETECTION ALERT';\n        PRINT 'Error count: ' || count;\n        PRINT analysis;\n        RETURN analysis;\n    ELSE\n        PRINT '\u2713 System appears healthy. Only ' || count || ' errors detected.';\n        RETURN 'Healthy';\n    END IF\nEND PROCEDURE\n</code></pre> <pre><code>CALL detect_anomalies()\n</code></pre>"},{"location":"notebooks/ai-observability/#semantic-search","title":"Semantic Search","text":"<p>Use embeddings for semantic log search:</p> <pre><code>CREATE PROCEDURE semantic_search(query STRING)\nBEGIN\n    DECLARE embedding ARRAY = INFERENCE_EMBED('.multilingual-e5-small-elasticsearch', query);\n    PRINT 'Query: ' || query;\n    PRINT 'Embedding dimensions: ' || ARRAY_LENGTH(embedding);\n    RETURN embedding;\nEND PROCEDURE\n</code></pre> <pre><code>CALL semantic_search('database connection timeout error')\n</code></pre>"},{"location":"notebooks/async-execution/","title":"Async Execution","text":"<p>Interactive Notebook</p> <p>This page is generated from a Jupyter notebook. For the best experience,  run it interactively in Jupyter:</p> <pre><code>./scripts/quick-start.sh\n# Then open http://localhost:8888/notebooks/04-async-execution.ipynb\n</code></pre> <p> View on GitHub</p> <p>This notebook demonstrates elastic-script's pipe-driven async execution model - a modern approach to asynchronous workflows.</p>"},{"location":"notebooks/async-execution/#syntax-overview","title":"Syntax Overview","text":"<pre><code>-- Async with continuations\nprocedure() | ON_DONE handler(@result) | ON_FAIL handler(@error) | TRACK AS 'name';\n\n-- Execution control\nEXECUTION('name') | STATUS;\nEXECUTION('name') | CANCEL;\n\n-- Parallel execution\nPARALLEL [proc1(), proc2()] | ON_ALL_DONE merge(@results);\n</code></pre>"},{"location":"notebooks/async-execution/#step-1-create-helper-procedures","title":"Step 1: Create Helper Procedures","text":"<pre><code>-- Create a procedure that simulates log analysis\nCREATE PROCEDURE analyze_logs(index_pattern STRING)\nBEGIN\n    PRINT 'Analyzing logs from: ' || index_pattern;\n    DECLARE result DOCUMENT = { \"analyzed\": true, \"pattern\": index_pattern, \"count\": 1000 };\n    RETURN result;\nEND PROCEDURE\n</code></pre> <pre><code>-- Create a success handler\nCREATE PROCEDURE handle_success(result DOCUMENT)\nBEGIN\n    PRINT 'SUCCESS: Analysis complete!';\n    PRINT 'Result: ' || result;\n    RETURN 'handled';\nEND PROCEDURE\n</code></pre> <pre><code>-- Create an error handler\nCREATE PROCEDURE handle_error(error STRING)\nBEGIN\n    PRINT 'ERROR: ' || error;\n    PRINT 'Alerting on-call team...';\n    RETURN 'error_handled';\nEND PROCEDURE\n</code></pre>"},{"location":"notebooks/async-execution/#step-2-test-async-with-on_done","title":"Step 2: Test Async with ON_DONE","text":"<pre><code>CREATE PROCEDURE test_async_basic()\nBEGIN\n    analyze_logs('logs-*')\n    | ON_DONE handle_success(@result)\n    | TRACK AS 'basic-test';\n\n    RETURN 'Async execution started';\nEND PROCEDURE\n</code></pre> <pre><code>CALL test_async_basic()\n</code></pre>"},{"location":"notebooks/async-execution/#step-3-check-execution-status","title":"Step 3: Check Execution Status","text":"<pre><code>CREATE PROCEDURE check_status()\nBEGIN\n    EXECUTION('basic-test') | STATUS;\nEND PROCEDURE\n</code></pre> <pre><code>CALL check_status()\n</code></pre>"},{"location":"notebooks/async-execution/#step-4-parallel-execution","title":"Step 4: Parallel Execution","text":"<pre><code>CREATE PROCEDURE fetch_logs()\nBEGIN\n    PRINT 'Fetching logs...';\n    RETURN { \"source\": \"logs\", \"count\": 500 };\nEND PROCEDURE\n</code></pre> <pre><code>CREATE PROCEDURE fetch_metrics()\nBEGIN\n    PRINT 'Fetching metrics...';\n    RETURN { \"source\": \"metrics\", \"count\": 200 };\nEND PROCEDURE\n</code></pre> <pre><code>CREATE PROCEDURE merge_results(results ARRAY)\nBEGIN\n    PRINT 'Merging ' || ARRAY_LENGTH(results) || ' results...';\n    RETURN { \"merged\": true, \"total\": ARRAY_LENGTH(results) };\nEND PROCEDURE\n</code></pre> <pre><code>CREATE PROCEDURE test_parallel()\nBEGIN\n    PARALLEL [fetch_logs(), fetch_metrics()]\n    | ON_ALL_DONE merge_results(@results)\n    | TRACK AS 'parallel-fetch';\n\n    RETURN 'Parallel execution started';\nEND PROCEDURE\n</code></pre> <pre><code>CALL test_parallel()\n</code></pre>"},{"location":"notebooks/async-execution/#summary","title":"Summary","text":"Feature Syntax Async with continuation <code>proc() \\| ON_DONE handler(@result)</code> Error handling <code>\\| ON_FAIL handler(@error)</code> Track execution <code>\\| TRACK AS 'name'</code> Check status <code>EXECUTION('name') \\| STATUS</code> Parallel execution <code>PARALLEL [p1(), p2()] \\| ON_ALL_DONE merge(@results)</code> <p>Query Executions with ESQL: <pre><code>FROM .escript_executions | WHERE status == 'RUNNING'\n</code></pre></p>"},{"location":"notebooks/complete-reference/","title":"Complete Reference","text":"<p>Interactive Notebook</p> <p>This page is generated from a Jupyter notebook. For the best experience,  run it interactively in Jupyter:</p> <pre><code>./scripts/quick-start.sh\n# Then open http://localhost:8888/notebooks/00-complete-reference.ipynb\n</code></pre> <p> View on GitHub</p> <p>This notebook provides a comprehensive reference for all elastic-script features.</p>"},{"location":"notebooks/complete-reference/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Language Basics</li> <li>String Functions (18)</li> <li>Number Functions (11)</li> <li>Array Functions (18)</li> <li>Date Functions (8)</li> <li>Document Functions (6)</li> <li>Elasticsearch Functions (5)</li> <li>OpenAI/LLM Functions (6)</li> <li>Introspection Functions (8)</li> <li>Integration Functions</li> </ol>"},{"location":"notebooks/complete-reference/#1-language-basics","title":"1. Language Basics","text":""},{"location":"notebooks/complete-reference/#11-variables-and-types","title":"1.1 Variables and Types","text":"<pre><code>-- Variable declarations with all supported types\nCREATE PROCEDURE demo_types()\nBEGIN\n    -- String types\n    DECLARE name STRING = 'Alice';\n    DECLARE greeting STRING = \"Hello, World!\";\n\n    -- Numeric types\n    DECLARE count INT = 42;\n    DECLARE price FLOAT = 19.99;\n    DECLARE total NUMBER = 1000.50;\n\n    -- Boolean (case-insensitive)\n    DECLARE is_active BOOLEAN = TRUE;\n    DECLARE is_deleted BOOLEAN = false;\n    DECLARE is_pending BOOLEAN = True;\n\n    -- Arrays (single or double quotes)\n    DECLARE tags ARRAY = ['prod', 'urgent', \"critical\"];\n    DECLARE numbers ARRAY = [1, 2, 3, 4, 5];\n\n    -- Documents (JSON objects)\n    DECLARE config DOCUMENT = {\"host\": \"localhost\", \"port\": 9200};\n\n    -- Output\n    PRINT 'Name: ' || name;\n    PRINT 'Count: ' || count;\n    PRINT 'Is Active: ' || is_active;\n    PRINT 'Tags: ' || tags;\n    PRINT 'Config: ' || config;\nEND PROCEDURE;\n</code></pre> <pre><code>CALL demo_types()\n</code></pre>"},{"location":"notebooks/complete-reference/#12-control-flow-ifthenelse","title":"1.2 Control Flow - IF/THEN/ELSE","text":"<pre><code>CREATE PROCEDURE demo_if(severity STRING)\nBEGIN\n    DECLARE action STRING;\n\n    IF severity == 'critical' THEN\n        SET action = 'PAGE_ONCALL';\n    ELSEIF severity == 'high' THEN\n        SET action = 'SEND_ALERT';\n    ELSEIF severity == 'medium' THEN\n        SET action = 'LOG_WARNING';\n    ELSE\n        SET action = 'LOG_INFO';\n    END IF;\n\n    PRINT 'Severity: ' || severity || ' -&gt; Action: ' || action;\nEND PROCEDURE;\n</code></pre> <pre><code>CALL demo_if('critical')\n</code></pre> <pre><code>CALL demo_if('low')\n</code></pre>"},{"location":"notebooks/complete-reference/#13-for-loops","title":"1.3 FOR Loops","text":"<pre><code>CREATE PROCEDURE demo_for_loop()\nBEGIN\n    -- Range-based loop\n    PRINT '--- Counting 1 to 5 ---';\n    FOR i IN 1..5 LOOP\n        PRINT 'Count: ' || i;\n    END LOOP;\n\n    -- Array iteration\n    PRINT '--- Iterating array ---';\n    DECLARE fruits ARRAY = ['apple', 'banana', 'cherry'];\n    FOR fruit IN fruits LOOP\n        PRINT 'Fruit: ' || fruit;\n    END LOOP;\nEND PROCEDURE;\n</code></pre> <pre><code>CALL demo_for_loop()\n</code></pre> <pre><code>CREATE PROCEDURE demo_string_functions()\nBEGIN\n    DECLARE text STRING = '  Hello, World!  ';\n\n    -- Basic string operations\n    PRINT 'Original: [' || text || ']';\n    PRINT 'LENGTH: ' || LENGTH(text);\n    PRINT 'TRIM: [' || TRIM(text) || ']';\n    PRINT 'LTRIM: [' || LTRIM(text) || ']';\n    PRINT 'RTRIM: [' || RTRIM(text) || ']';\n    PRINT 'UPPER: ' || UPPER(TRIM(text));\n    PRINT 'LOWER: ' || LOWER(TRIM(text));\n    PRINT 'INITCAP: ' || INITCAP('hello world');\n    PRINT 'REVERSE: ' || REVERSE('hello');\n\n    -- Substring operations\n    PRINT 'SUBSTR(text, 3, 5): ' || SUBSTR(TRIM(text), 3, 5);\n    PRINT 'INSTR(text, o): ' || INSTR(text, 'o');\n\n    -- Padding\n    PRINT 'LPAD(42, 5, 0): ' || LPAD('42', 5, '0');\n    PRINT 'RPAD(42, 5, 0): ' || RPAD('42', 5, '0');\n\n    -- Replace and split\n    PRINT 'REPLACE: ' || REPLACE('hello', 'l', 'L');\n    PRINT 'SPLIT: ' || SPLIT('a,b,c', ',');\n    PRINT 'CONCAT: ' || 'Hello' || ' ' || 'World';\n\n    -- Regex operations\n    PRINT 'REGEXP_REPLACE: ' || REGEXP_REPLACE('abc123def', '[0-9]+', 'NUM');\nEND PROCEDURE;\n</code></pre> <pre><code>CALL demo_string_functions()\n</code></pre>"},{"location":"notebooks/complete-reference/#3-number-functions-11-functions","title":"3. Number Functions (11 functions)","text":"<p>Mathematical operations.</p> <pre><code>CREATE PROCEDURE demo_number_functions()\nBEGIN\n    DECLARE num NUMBER = -15.7;\n\n    PRINT 'Number: ' || num;\n    PRINT 'ABS: ' || ABS(num);\n    PRINT 'CEIL: ' || CEIL(num);\n    PRINT 'FLOOR: ' || FLOOR(num);\n    PRINT 'ROUND: ' || ROUND(15.678, 2);\n    PRINT 'TRUNC: ' || TRUNC(15.678, 1);\n    PRINT 'MOD(17, 5): ' || MOD(17, 5);\n    PRINT 'POWER(2, 10): ' || POWER(2, 10);\n    PRINT 'SQRT(144): ' || SQRT(144);\n    PRINT 'EXP(1): ' || EXP(1);\n    PRINT 'LOG(100, 10): ' || LOG(100, 10);\n    PRINT 'SIGN(-42): ' || SIGN(-42);\nEND PROCEDURE;\n</code></pre> <pre><code>CALL demo_number_functions()\n</code></pre>"},{"location":"notebooks/complete-reference/#4-array-functions-18-functions","title":"4. Array Functions (18 functions)","text":"<p>Array manipulation including functional programming patterns.</p> <pre><code>CREATE PROCEDURE demo_array_basic()\nBEGIN\n    DECLARE arr ARRAY = [1, 2, 3, 4, 5];\n\n    PRINT 'Array: ' || arr;\n    PRINT 'ARRAY_LENGTH: ' || ARRAY_LENGTH(arr);\n    PRINT 'ARRAY_APPEND(arr, 6): ' || ARRAY_APPEND(arr, 6);\n    PRINT 'ARRAY_PREPEND(arr, 0): ' || ARRAY_PREPEND(arr, 0);\n    PRINT 'ARRAY_REMOVE(arr, 3): ' || ARRAY_REMOVE(arr, 3);\n    PRINT 'ARRAY_CONTAINS(arr, 3): ' || ARRAY_CONTAINS(arr, 3);\n    PRINT 'ARRAY_REVERSE: ' || ARRAY_REVERSE(arr);\n    PRINT 'ARRAY_SLICE(arr, 1, 3): ' || ARRAY_SLICE(arr, 1, 3);\n\n    -- Distinct\n    DECLARE with_dups ARRAY = [1, 2, 2, 3, 3, 3];\n    PRINT 'ARRAY_DISTINCT: ' || ARRAY_DISTINCT(with_dups);\n\n    -- Join\n    DECLARE words ARRAY = ['hello', 'world'];\n    PRINT 'ARRAY_JOIN: ' || ARRAY_JOIN(words, ', ');\nEND PROCEDURE;\n</code></pre> <pre><code>CALL demo_array_basic()\n</code></pre>"},{"location":"notebooks/complete-reference/#5-date-functions-8-functions","title":"5. Date Functions (8 functions)","text":"<pre><code>CREATE PROCEDURE demo_date_functions()\nBEGIN\n    DECLARE today DATE = CURRENT_DATE();\n    DECLARE now DATE = CURRENT_TIMESTAMP();\n\n    PRINT 'CURRENT_DATE: ' || today;\n    PRINT 'CURRENT_TIMESTAMP: ' || now;\n    PRINT 'DATE_ADD (7 days): ' || DATE_ADD(today, 7);\n    PRINT 'DATE_SUB (30 days): ' || DATE_SUB(today, 30);\n    PRINT 'EXTRACT_YEAR: ' || EXTRACT_YEAR(now);\n    PRINT 'EXTRACT_MONTH: ' || EXTRACT_MONTH(now);\n    PRINT 'EXTRACT_DAY: ' || EXTRACT_DAY(now);\nEND PROCEDURE;\n</code></pre> <pre><code>CALL demo_date_functions()\n</code></pre>"},{"location":"notebooks/complete-reference/#6-document-functions-6-functions","title":"6. Document Functions (6 functions)","text":"<p>Working with JSON documents.</p> <pre><code>CREATE PROCEDURE demo_document_functions()\nBEGIN\n    DECLARE doc DOCUMENT = {\"name\": \"John\", \"age\": 30, \"city\": \"NYC\"};\n\n    PRINT 'Document: ' || doc;\n    PRINT 'DOCUMENT_GET(name): ' || DOCUMENT_GET(doc, 'name');\n    PRINT 'DOCUMENT_KEYS: ' || DOCUMENT_KEYS(doc);\n    PRINT 'DOCUMENT_VALUES: ' || DOCUMENT_VALUES(doc);\n    PRINT 'DOCUMENT_CONTAINS(age): ' || DOCUMENT_CONTAINS(doc, 'age');\n\n    DECLARE extra DOCUMENT = {\"email\": \"john@test.com\"};\n    PRINT 'DOCUMENT_MERGE: ' || DOCUMENT_MERGE(doc, extra);\n    PRINT 'DOCUMENT_REMOVE(city): ' || DOCUMENT_REMOVE(doc, 'city');\nEND PROCEDURE;\n</code></pre> <pre><code>CALL demo_document_functions()\n</code></pre>"},{"location":"notebooks/complete-reference/#7-elasticsearch-functions","title":"7. Elasticsearch Functions","text":"<p>Query and index data directly.</p> <pre><code>-- Query with ESQL_QUERY and CURSOR\nCREATE PROCEDURE demo_esql_query()\nBEGIN\n    DECLARE results CURSOR FOR\n        FROM logs-sample\n        | WHERE level == \"ERROR\"\n        | KEEP @timestamp, level, message, service\n        | SORT @timestamp DESC\n        | LIMIT 5;\n\n    PRINT '=== Recent Error Logs ===';\n    FOR row IN results LOOP\n        PRINT DOCUMENT_GET(row, 'service') || ': ' || DOCUMENT_GET(row, 'message');\n    END LOOP;\nEND PROCEDURE;\n</code></pre> <pre><code>CALL demo_esql_query()\n</code></pre> <pre><code>-- Aggregations\nCREATE PROCEDURE demo_aggregation()\nBEGIN\n    DECLARE stats CURSOR FOR\n        FROM logs-sample\n        | STATS count = COUNT(*) BY level\n        | SORT count DESC;\n\n    PRINT '=== Log Level Distribution ===';\n    FOR stat IN stats LOOP\n        PRINT DOCUMENT_GET(stat, 'level') || ': ' || DOCUMENT_GET(stat, 'count');\n    END LOOP;\nEND PROCEDURE;\n</code></pre> <pre><code>CALL demo_aggregation()\n</code></pre>"},{"location":"notebooks/complete-reference/#8-openaillm-functions-requires-openai_api_key","title":"8. OpenAI/LLM Functions (requires OPENAI_API_KEY)","text":"<p>AI-powered text processing.</p> <pre><code>-- LLM_COMPLETE - Text completion\nCREATE PROCEDURE demo_llm_complete()\nBEGIN\n    DECLARE prompt STRING = 'Explain Elasticsearch in one sentence.';\n    DECLARE response STRING = LLM_COMPLETE(prompt);\n\n    PRINT 'Prompt: ' || prompt;\n    PRINT 'Response: ' || response;\nEND PROCEDURE;\n</code></pre> <pre><code>CALL demo_llm_complete()\n</code></pre> <pre><code>-- LLM_SUMMARIZE - Summarize errors from logs\nCREATE PROCEDURE demo_llm_summarize()\nBEGIN\n    DECLARE error_logs CURSOR FOR\n        FROM logs-sample\n        | WHERE level == \"ERROR\"\n        | LIMIT 10;\n\n    DECLARE messages STRING = '';\n    FOR log IN error_logs LOOP\n        SET messages = messages || DOCUMENT_GET(log, 'message') || '\\n';\n    END LOOP;\n\n    DECLARE summary STRING = LLM_SUMMARIZE(messages);\n    PRINT '=== Error Summary ===';\n    PRINT summary;\nEND PROCEDURE;\n</code></pre> <pre><code>CALL demo_llm_summarize()\n</code></pre>"},{"location":"notebooks/complete-reference/#9-introspection-functions","title":"9. Introspection Functions","text":"<p>Discover available capabilities.</p> <pre><code>-- List all available functions\nCREATE PROCEDURE demo_introspection()\nBEGIN\n    DECLARE functions ARRAY = ESCRIPT_FUNCTIONS();\n    DECLARE count NUMBER = ARRAY_LENGTH(functions);\n    DECLARE func DOCUMENT;\n\n    PRINT 'Total functions available: ' || count;\n\n    -- Show first 10\n    PRINT '=== Sample Functions ===';\n    FOR i IN 0..9 LOOP\n        SET func = functions[i];\n        PRINT DOCUMENT_GET(func, 'name');\n    END LOOP;\nEND PROCEDURE;\n</code></pre> <pre><code>CALL demo_introspection()\n</code></pre>"},{"location":"notebooks/complete-reference/#summary","title":"Summary","text":"<p>elastic-script provides 106+ built-in functions across these categories:</p> Category Count Examples String 18 LENGTH, SUBSTR, UPPER, REGEX_REPLACE Number 11 ABS, ROUND, POWER, SQRT Array 18 ARRAY_MAP, ARRAY_FILTER, ARRAY_REDUCE Date 8 DATE_ADD, DATE_DIFF, EXTRACT_YEAR Document 6 DOCUMENT_GET, DOCUMENT_MERGE Elasticsearch 5 ESQL_QUERY, INDEX_DOCUMENT OpenAI/LLM 6 LLM_COMPLETE, LLM_SUMMARIZE, LLM_CLASSIFY Inference API 8 INFERENCE, INFERENCE_EMBED Introspection 8 ESCRIPT_FUNCTIONS, ESCRIPT_PROCEDURES Integrations ~30 Slack, PagerDuty, AWS, K8s, HTTP <p>Plus full language support for: - Variables &amp; Types (STRING, INT, FLOAT, BOOLEAN, ARRAY, DOCUMENT) - Control Flow (IF/THEN/ELSE, FOR, WHILE, TRY/CATCH) - Procedures &amp; Functions with IN/OUT/INOUT parameters - Async Execution with Continuations (ON_DONE, ON_FAIL)</p>"},{"location":"notebooks/esql-integration/","title":"ES|QL Integration","text":"<p>Interactive Notebook</p> <p>This page is generated from a Jupyter notebook. For the best experience,  run it interactively in Jupyter:</p> <pre><code>./scripts/quick-start.sh\n# Then open http://localhost:8888/notebooks/02-esql-integration.ipynb\n</code></pre> <p> View on GitHub</p>"},{"location":"notebooks/esql-integration/#esql-integration_1","title":"\ud83d\udcca ESQL Integration","text":"<p>elastic-script is built on top of ESQL, Elasticsearch's query language. This notebook shows how to combine procedural logic with powerful ESQL queries.</p>"},{"location":"notebooks/esql-integration/#prerequisites","title":"Prerequisites","text":"<p>This notebook uses sample data. Load it with: <pre><code>./scripts/quick-start.sh --load-data\n</code></pre></p>"},{"location":"notebooks/esql-integration/#esql_query-function","title":"ESQL_QUERY() Function","text":"<p>Use <code>ESQL_QUERY()</code> to run any ESQL query and get results as an array:</p> <pre><code>CREATE PROCEDURE get_recent_logs()\nBEGIN\n    DECLARE logs ARRAY = ESQL_QUERY('FROM logs-sample | LIMIT 10');\n    PRINT 'Found ' || ARRAY_LENGTH(logs) || ' logs';\n    RETURN logs;\nEND PROCEDURE\n</code></pre> <pre><code>CALL get_recent_logs()\n</code></pre>"},{"location":"notebooks/esql-integration/#cursor-iterate-over-query-results","title":"CURSOR - Iterate Over Query Results","text":"<p>For large result sets, use a CURSOR to iterate row by row:</p> <pre><code>CREATE PROCEDURE analyze_log_levels()\nBEGIN\n    DECLARE logs CURSOR FOR FROM logs-sample | LIMIT 50;\n\n    DECLARE info_count NUMBER = 0;\n    DECLARE warn_count NUMBER = 0;\n    DECLARE error_count NUMBER = 0;\n\n    FOR log IN logs LOOP\n        IF log['level'] == 'INFO' THEN\n            SET info_count = info_count + 1;\n        ELSEIF log['level'] == 'WARN' THEN\n            SET warn_count = warn_count + 1;\n        ELSEIF log['level'] == 'ERROR' THEN\n            SET error_count = error_count + 1;\n        END IF\n    END LOOP\n\n    RETURN {\n        \"info\": info_count,\n        \"warn\": warn_count,\n        \"error\": error_count\n    };\nEND PROCEDURE\n</code></pre> <pre><code>CALL analyze_log_levels()\n</code></pre>"},{"location":"notebooks/esql-integration/#aggregations-with-stats","title":"Aggregations with STATS","text":"<pre><code>CREATE PROCEDURE get_service_stats()\nBEGIN\n    DECLARE stats ARRAY = ESQL_QUERY(\n        'FROM logs-sample | STATS count = COUNT(*) BY service'\n    );\n\n    PRINT 'Service distribution:';\n    FOR stat IN stats LOOP\n        PRINT stat['service'] || ': ' || stat['count'] || ' logs';\n    END LOOP\n\n    RETURN stats;\nEND PROCEDURE\n</code></pre> <pre><code>CALL get_service_stats()\n</code></pre>"},{"location":"notebooks/event-triggers/","title":"Event Triggers","text":"<p>This notebook demonstrates how to create event-driven triggers that react to new documents in Elasticsearch indices.</p>"},{"location":"notebooks/event-triggers/#what-are-triggers","title":"What are Triggers?","text":"<p>Triggers are event-driven handlers that automatically execute EScript code when specific conditions are met in your Elasticsearch data. Unlike scheduled jobs that run at fixed times, triggers poll indices for new or matching documents and fire when they're found.</p> <p>Use cases include:</p> <ul> <li>Real-time alerting: Notify when errors or anomalies appear in logs</li> <li>Data processing: Process documents as they arrive</li> <li>Workflow automation: Trigger actions based on document state changes</li> <li>Security monitoring: Detect and respond to suspicious activity</li> </ul>"},{"location":"notebooks/event-triggers/#1-creating-a-simple-trigger","title":"1. Creating a Simple Trigger","text":"<p>Let's create a trigger that watches for ERROR level log entries:</p> <pre><code>CREATE TRIGGER error_alert\nON INDEX 'logs-*'\nWHEN level == 'ERROR'\nAS BEGIN\n    PRINT 'Found ' || @document_count || ' new errors';\nEND TRIGGER\n</code></pre>"},{"location":"notebooks/event-triggers/#2-viewing-triggers","title":"2. Viewing Triggers","text":"<p>Use <code>SHOW TRIGGERS</code> to list all triggers:</p> <pre><code>SHOW TRIGGERS\n</code></pre> <p>View details of a specific trigger:</p> <pre><code>SHOW TRIGGER error_alert\n</code></pre>"},{"location":"notebooks/event-triggers/#3-polling-intervals","title":"3. Polling Intervals","text":"<p>By default, triggers poll every 60 seconds. You can customize this:</p>"},{"location":"notebooks/event-triggers/#poll-every-30-seconds","title":"Poll Every 30 Seconds","text":"<pre><code>CREATE TRIGGER fast_trigger\nON INDEX 'events-*'\nWHEN priority == 'high'\nEVERY 30 SECONDS\nAS BEGIN\n    PRINT 'High priority event detected!';\nEND TRIGGER\n</code></pre>"},{"location":"notebooks/event-triggers/#poll-every-5-minutes","title":"Poll Every 5 Minutes","text":"<pre><code>CREATE TRIGGER slow_trigger\nON INDEX 'metrics-*'\nWHEN cpu_usage &gt; 90\nEVERY 5 MINUTES\nDESCRIPTION 'Checks for high CPU usage'\nAS BEGIN\n    PRINT 'High CPU detected';\nEND TRIGGER\n</code></pre>"},{"location":"notebooks/event-triggers/#interval-options","title":"Interval Options","text":"Interval Example Seconds <code>EVERY 30 SECONDS</code> Minutes <code>EVERY 5 MINUTES</code> Hours <code>EVERY 2 HOURS</code>"},{"location":"notebooks/event-triggers/#4-complex-conditions","title":"4. Complex Conditions","text":"<p>Triggers support compound conditions using AND/OR:</p> <pre><code>CREATE TRIGGER payment_error_alert\nON INDEX 'logs-*'\nWHEN (level == 'ERROR' OR level == 'FATAL') AND service == 'payment'\nEVERY 10 SECONDS\nDESCRIPTION 'Monitors payment service for errors'\nAS BEGIN\n    PRINT 'Payment service error detected!';\n    -- Send notification\n    -- CALL SLACK_SEND('#payment-alerts', 'Payment error detected');\nEND TRIGGER\n</code></pre>"},{"location":"notebooks/event-triggers/#5-processing-matched-documents","title":"5. Processing Matched Documents","text":"<p>When a trigger fires, it provides access to the matched documents through special bindings:</p> <ul> <li><code>@documents</code> - An array of matched documents</li> <li><code>@document_count</code> - The number of matched documents</li> </ul> <pre><code>CREATE TRIGGER document_processor\nON INDEX 'queue-*'\nWHEN status == 'pending'\nEVERY 30 SECONDS\nAS BEGIN\n    PRINT 'Processing ' || @document_count || ' pending documents';\n\n    -- Iterate through matched documents\n    DECLARE doc DOCUMENT;\n    FOR doc IN @documents LOOP\n        PRINT 'Processing document: ' || doc._id;\n        -- Process each document here\n    END LOOP\nEND TRIGGER\n</code></pre>"},{"location":"notebooks/event-triggers/#6-managing-triggers","title":"6. Managing Triggers","text":""},{"location":"notebooks/event-triggers/#disable-a-trigger","title":"Disable a Trigger","text":"<pre><code>ALTER TRIGGER error_alert DISABLE\n</code></pre>"},{"location":"notebooks/event-triggers/#enable-a-trigger","title":"Enable a Trigger","text":"<pre><code>ALTER TRIGGER error_alert ENABLE\n</code></pre>"},{"location":"notebooks/event-triggers/#change-polling-interval","title":"Change Polling Interval","text":"<pre><code>ALTER TRIGGER error_alert EVERY 45 SECONDS\n</code></pre>"},{"location":"notebooks/event-triggers/#7-viewing-trigger-history","title":"7. Viewing Trigger History","text":"<p>See when a trigger has fired and what it processed:</p> <pre><code>SHOW TRIGGER RUNS FOR error_alert\n</code></pre>"},{"location":"notebooks/event-triggers/#8-how-triggers-work","title":"8. How Triggers Work","text":""},{"location":"notebooks/event-triggers/#checkpoint-based-processing","title":"Checkpoint-Based Processing","text":"<p>Triggers use checkpoint tracking to avoid reprocessing documents:</p> <ol> <li>On first poll, the trigger records the current timestamp as checkpoint</li> <li>Subsequent polls only query for documents newer than the checkpoint</li> <li>After processing, the checkpoint advances to the newest document's timestamp</li> </ol> <p>This ensures each document is processed exactly once.</p>"},{"location":"notebooks/event-triggers/#index-pattern-support","title":"Index Pattern Support","text":"<p>Triggers support Elasticsearch index patterns:</p> <ul> <li><code>logs-*</code> - All indices starting with \"logs-\"</li> <li><code>logs-2026.01.*</code> - All January 2026 log indices</li> <li><code>my-exact-index</code> - A specific index</li> </ul>"},{"location":"notebooks/event-triggers/#9-cleanup","title":"9. Cleanup","text":"<p>Delete triggers when no longer needed:</p> <pre><code>DROP TRIGGER error_alert\nDROP TRIGGER fast_trigger\nDROP TRIGGER slow_trigger\nDROP TRIGGER payment_error_alert\nDROP TRIGGER document_processor\n</code></pre>"},{"location":"notebooks/event-triggers/#summary","title":"Summary","text":"Statement Description <code>CREATE TRIGGER</code> Define event-driven triggers on indices <code>SHOW TRIGGERS</code> List all triggers or view specific details <code>ALTER TRIGGER</code> Enable, disable, or change polling interval <code>SHOW TRIGGER RUNS</code> View execution history <code>DROP TRIGGER</code> Delete a trigger"},{"location":"notebooks/event-triggers/#key-features","title":"Key Features","text":"<ul> <li>Index patterns: Watch multiple indices with wildcards</li> <li>Flexible conditions: Simple or compound conditions</li> <li>Configurable polling: From seconds to hours</li> <li>Document access: Process matched documents with <code>@documents</code></li> <li>Checkpoint tracking: Process each document exactly once</li> </ul> <p>View the interactive notebook \u2192</p>"},{"location":"notebooks/getting-started/","title":"Getting Started","text":"<p>Interactive Notebook</p> <p>This page is generated from a Jupyter notebook. For the best experience,  run it interactively in Jupyter:</p> <pre><code>./scripts/quick-start.sh\n# Then open http://localhost:8888/notebooks/01-getting-started.ipynb\n</code></pre> <p> View on GitHub</p> <p>Welcome to elastic-script! This notebook will guide you through the basics of writing procedures that run directly in Elasticsearch.</p>"},{"location":"notebooks/getting-started/#what-is-elastic-script","title":"What is elastic-script?","text":"<p>elastic-script (also known as PL|ESQL) is a procedural extension to ESQL that adds: - Variables and control flow (IF, WHILE, FOR) - Stored procedures - Built-in functions for common operations - Integration with external services (Kubernetes, PagerDuty, AWS, etc.) - AI/LLM capabilities for intelligent automation</p>"},{"location":"notebooks/getting-started/#prerequisites","title":"Prerequisites","text":"<p>Make sure Elasticsearch is running with elastic-script: <pre><code>cd /path/to/elastic-script\n./scripts/quick-start.sh --start\n</code></pre></p>"},{"location":"notebooks/getting-started/#your-first-procedure","title":"Your First Procedure","text":"<p>Let's start with a simple \"Hello, World!\" procedure:</p> <pre><code>CREATE PROCEDURE hello_world()\nBEGIN\n    RETURN 'Hello, World!';\nEND PROCEDURE\n</code></pre> <pre><code>CALL hello_world()\n</code></pre>"},{"location":"notebooks/getting-started/#procedures-with-parameters","title":"Procedures with Parameters","text":"<p>Let's create a procedure that takes a parameter:</p> <pre><code>CREATE PROCEDURE greet(name STRING)\nBEGIN\n    RETURN 'Hello, ' || name || '!';\nEND PROCEDURE\n</code></pre> <pre><code>CALL greet('Elastic User')\n</code></pre>"},{"location":"notebooks/getting-started/#variables-and-types","title":"Variables and Types","text":"<p>elastic-script supports several data types: - <code>STRING</code> - Text values - <code>NUMBER</code> - Numeric values (integers or decimals) - <code>BOOLEAN</code> - TRUE or FALSE - <code>DOCUMENT</code> - JSON-like key-value structure - <code>ARRAY</code> - List of values - <code>DATE</code> - Date/time values</p> <pre><code>CREATE PROCEDURE demo_types()\nBEGIN\n    -- Declare variables with DECLARE\n    DECLARE message STRING = 'Hello';\n    DECLARE count NUMBER = 42;\n    DECLARE is_active BOOLEAN = TRUE;\n    DECLARE user DOCUMENT = { \"name\": \"Alice\", \"role\": \"admin\" };\n    DECLARE items ARRAY = ['apple', 'banana', 'cherry'];\n\n    -- Use VAR for type inference\n    VAR inferred_type = 'This is a string';\n\n    -- Use CONST for immutable values\n    CONST PI = 3.14159;\n\n    PRINT 'Message: ' || message;\n    PRINT 'Count: ' || count;\n    PRINT 'User: ' || user['name'];\n    PRINT 'First item: ' || items[0];\n\n    RETURN 'Types demo complete!';\nEND PROCEDURE\n</code></pre> <pre><code>CALL demo_types()\n</code></pre>"},{"location":"notebooks/getting-started/#control-flow","title":"Control Flow","text":""},{"location":"notebooks/getting-started/#ifelse","title":"IF/ELSE","text":"<pre><code>CREATE PROCEDURE check_severity(error_count NUMBER)\nBEGIN\n    DECLARE status STRING;\n\n    IF error_count == 0 THEN\n        SET status = 'Healthy';\n    ELSEIF error_count &lt; 10 THEN\n        SET status = 'Warning';\n    ELSE\n        SET status = 'Critical';\n    END IF\n\n    RETURN status;\nEND PROCEDURE\n</code></pre> <pre><code>CALL check_severity(5)\n</code></pre>"},{"location":"notebooks/getting-started/#for-loops","title":"FOR Loops","text":"<pre><code>CREATE PROCEDURE count_to(n NUMBER)\nBEGIN\n    DECLARE result STRING = '';\n\n    FOR i IN 1..n LOOP\n        SET result = result || i || ' ';\n    END LOOP\n\n    RETURN TRIM(result);\nEND PROCEDURE\n</code></pre> <pre><code>CALL count_to(5)\n</code></pre>"},{"location":"notebooks/getting-started/#error-handling-with-trycatch","title":"Error Handling with TRY/CATCH","text":"<pre><code>CREATE PROCEDURE safe_divide(a NUMBER, b NUMBER)\nBEGIN\n    TRY\n        IF b == 0 THEN\n            THROW 'Division by zero!';\n        END IF\n        RETURN a / b;\n    CATCH\n        RETURN 'Error: Cannot divide by zero';\n    END TRY\nEND PROCEDURE\n</code></pre> <pre><code>CALL safe_divide(10, 0)\n</code></pre>"},{"location":"notebooks/getting-started/#next-steps","title":"Next Steps","text":"<p>Now that you know the basics, explore:</p> <ol> <li>02-esql-integration.ipynb - Query Elasticsearch data with ESQL</li> <li>03-ai-observability.ipynb - AI-powered log analysis</li> <li>04-async-execution.ipynb - Pipe-driven async workflows</li> <li>05-runbook-integrations.ipynb - K8s, AWS, PagerDuty integrations</li> </ol>"},{"location":"notebooks/runbook-integrations/","title":"Runbook Integrations","text":"<p>Interactive Notebook</p> <p>This page is generated from a Jupyter notebook. For the best experience,  run it interactively in Jupyter:</p> <pre><code>./scripts/quick-start.sh\n# Then open http://localhost:8888/notebooks/05-runbook-integrations.ipynb\n</code></pre> <p> View on GitHub</p> <p>This notebook demonstrates elastic-script's built-in integrations with external services for SRE automation.</p>"},{"location":"notebooks/runbook-integrations/#available-integrations","title":"Available Integrations","text":"Service Functions Use Cases Kubernetes <code>K8S_GET_PODS()</code>, <code>K8S_SCALE_DEPLOYMENT()</code>, <code>K8S_GET_LOGS()</code> Pod management, scaling PagerDuty <code>PAGERDUTY_TRIGGER()</code>, <code>PAGERDUTY_RESOLVE()</code> Incident management AWS <code>AWS_EC2_DESCRIBE()</code>, <code>AWS_LAMBDA_INVOKE()</code> Cloud operations CI/CD <code>GITHUB_TRIGGER_WORKFLOW()</code>, <code>JENKINS_TRIGGER_BUILD()</code> Deployments"},{"location":"notebooks/runbook-integrations/#kubernetes-integration","title":"Kubernetes Integration","text":"<pre><code>-- List pods in a namespace\nCREATE PROCEDURE list_pods(namespace STRING)\nBEGIN\n    DECLARE pods ARRAY = K8S_GET_PODS(namespace);\n    PRINT 'Pods in ' || namespace || ':';\n\n    FOR pod IN pods LOOP\n        PRINT pod['name'] || ' - ' || pod['status'];\n    END LOOP\n\n    RETURN pods;\nEND PROCEDURE\n</code></pre> <pre><code>-- Auto-scale based on error rate\nCREATE PROCEDURE auto_scale_on_errors(namespace STRING, deployment STRING, threshold NUMBER)\nBEGIN\n    DECLARE error_count NUMBER = 0;\n    DECLARE logs CURSOR FOR\n        FROM logs-sample\n        | WHERE level == \"ERROR\"\n        | LIMIT 100;\n\n    FOR log IN logs LOOP\n        SET error_count = error_count + 1;\n    END LOOP\n\n    IF error_count &gt; threshold THEN\n        PRINT '\u26a0\ufe0f High error rate detected: ' || error_count;\n        -- Scale up the deployment\n        DECLARE result DOCUMENT = K8S_SCALE_DEPLOYMENT(namespace, deployment, 3);\n        PRINT 'Scaled deployment to 3 replicas';\n        RETURN result;\n    ELSE\n        PRINT '\u2713 Error rate normal: ' || error_count;\n        RETURN { \"status\": \"ok\", \"errors\": error_count };\n    END IF\nEND PROCEDURE\n</code></pre>"},{"location":"notebooks/runbook-integrations/#pagerduty-integration","title":"PagerDuty Integration","text":"<pre><code>-- Create an incident when errors exceed threshold\nCREATE PROCEDURE alert_on_critical_errors()\nBEGIN\n    DECLARE error_count NUMBER = 0;\n    DECLARE logs CURSOR FOR\n        FROM logs-sample\n        | WHERE level == \"ERROR\"\n        | LIMIT 100;\n\n    FOR log IN logs LOOP\n        SET error_count = error_count + 1;\n    END LOOP\n\n    IF error_count &gt; 50 THEN\n        DECLARE incident DOCUMENT = PAGERDUTY_TRIGGER(\n            'Critical error rate detected',\n            'Error count: ' || error_count || ' in the last hour',\n            'critical'\n        );\n        PRINT '\ud83d\udea8 PagerDuty incident created: ' || incident['id'];\n        RETURN incident;\n    ELSE\n        RETURN { \"status\": \"ok\", \"message\": \"No alert needed\" };\n    END IF\nEND PROCEDURE\n</code></pre>"},{"location":"notebooks/runbook-integrations/#github-actions-integration","title":"GitHub Actions Integration","text":"<pre><code>-- Trigger deployment workflow\nCREATE PROCEDURE deploy_hotfix(repo STRING, branch STRING)\nBEGIN\n    PRINT 'Triggering deployment for ' || repo || ' branch: ' || branch;\n\n    DECLARE result DOCUMENT = GITHUB_TRIGGER_WORKFLOW(\n        repo,\n        'deploy.yml',\n        branch,\n        { \"environment\": \"production\", \"hotfix\": true }\n    );\n\n    PRINT '\u2713 Workflow triggered: ' || result['run_id'];\n    RETURN result;\nEND PROCEDURE\n</code></pre>"},{"location":"notebooks/runbook-integrations/#complete-incident-response-runbook","title":"Complete Incident Response Runbook","text":"<pre><code>-- Full automated incident response\nCREATE PROCEDURE incident_response(service STRING)\nBEGIN\n    PRINT '\ud83d\udd0d Starting incident response for: ' || service;\n\n    -- 1. Analyze logs\n    DECLARE errors CURSOR FOR\n        FROM logs-sample\n        | WHERE level == \"ERROR\"\n        | LIMIT 20;\n\n    DECLARE error_count NUMBER = 0;\n    FOR err IN errors LOOP\n        SET error_count = error_count + 1;\n    END LOOP\n\n    -- 2. Check if critical\n    IF error_count &gt; 10 THEN\n        PRINT '\u26a0\ufe0f Critical error rate: ' || error_count;\n\n        -- 3. Scale up pods\n        K8S_SCALE_DEPLOYMENT('production', service, 5);\n        PRINT '\ud83d\udcc8 Scaled ' || service || ' to 5 replicas';\n\n        -- 4. Create PagerDuty incident\n        DECLARE incident DOCUMENT = PAGERDUTY_TRIGGER(\n            service || ' critical errors',\n            'Auto-scaled to 5 replicas. Error count: ' || error_count,\n            'high'\n        );\n        PRINT '\ud83d\udcdf PagerDuty incident: ' || incident['id'];\n\n        -- 5. Generate AI analysis\n        DECLARE prompt STRING = 'Analyze ' || error_count || ' errors for ' || service;\n        DECLARE analysis STRING = LLM_COMPLETE(prompt);\n\n        RETURN {\n            \"service\": service,\n            \"errors\": error_count,\n            \"actions_taken\": [\"scaled_up\", \"pagerduty_created\"],\n            \"analysis\": analysis\n        };\n    ELSE\n        PRINT '\u2713 ' || service || ' is healthy. Errors: ' || error_count;\n        RETURN { \"service\": service, \"status\": \"healthy\", \"errors\": error_count };\n    END IF\nEND PROCEDURE\n</code></pre>"},{"location":"notebooks/scheduled-jobs/","title":"Scheduled Jobs","text":"<p>This notebook demonstrates how to create, manage, and monitor scheduled jobs in Elastic-Script.</p>"},{"location":"notebooks/scheduled-jobs/#what-are-scheduled-jobs","title":"What are Scheduled Jobs?","text":"<p>Scheduled jobs allow you to run EScript procedures automatically based on cron-like schedules. This is useful for:</p> <ul> <li>Periodic reports: Generate and send daily/weekly summaries</li> <li>Data cleanup: Archive or delete old data on a schedule</li> <li>Monitoring: Run health checks at regular intervals</li> <li>ETL processes: Move and transform data between indices</li> </ul>"},{"location":"notebooks/scheduled-jobs/#1-creating-a-simple-job","title":"1. Creating a Simple Job","text":"<p>Let's create a basic job that runs every minute and prints a message:</p> <pre><code>CREATE JOB hello_job\nSCHEDULE '* * * * *'\nAS BEGIN\n    PRINT 'Hello from scheduled job at ' || NOW();\nEND JOB\n</code></pre>"},{"location":"notebooks/scheduled-jobs/#2-viewing-jobs","title":"2. Viewing Jobs","text":"<p>Use <code>SHOW JOBS</code> to list all scheduled jobs:</p> <pre><code>SHOW JOBS\n</code></pre> <p>View details of a specific job:</p> <pre><code>SHOW JOB hello_job\n</code></pre>"},{"location":"notebooks/scheduled-jobs/#3-schedule-formats","title":"3. Schedule Formats","text":""},{"location":"notebooks/scheduled-jobs/#cron-expressions","title":"Cron Expressions","text":"<p>Jobs use standard 5-field cron expressions:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 minute (0 - 59)\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 hour (0 - 23)\n\u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 day of month (1 - 31)\n\u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 month (1 - 12)\n\u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 day of week (0 - 6, Sunday = 0)\n\u2502 \u2502 \u2502 \u2502 \u2502\n* * * * *\n</code></pre>"},{"location":"notebooks/scheduled-jobs/#common-examples","title":"Common Examples","text":"Expression Description <code>* * * * *</code> Every minute <code>0 * * * *</code> Every hour at :00 <code>0 2 * * *</code> Daily at 2:00 AM <code>0 0 * * 0</code> Weekly on Sunday at midnight <code>0 0 1 * *</code> Monthly on the 1<sup>st</sup> at midnight <code>*/5 * * * *</code> Every 5 minutes <code>0 9-17 * * 1-5</code> Every hour 9-5 on weekdays"},{"location":"notebooks/scheduled-jobs/#aliases","title":"Aliases","text":"<p>For convenience, you can use these aliases:</p> <ul> <li><code>@hourly</code> - Run at the top of every hour</li> <li><code>@daily</code> or <code>@midnight</code> - Run at midnight</li> <li><code>@weekly</code> - Run at midnight on Sunday</li> <li><code>@monthly</code> - Run at midnight on the 1<sup>st</sup></li> <li><code>@yearly</code> - Run at midnight on January 1<sup>st</sup></li> </ul> <pre><code>-- Create a job that runs every hour\nCREATE JOB hourly_report\nSCHEDULE '@hourly'\nDESCRIPTION 'Generates hourly system report'\nAS BEGIN\n    PRINT 'Running hourly report at ' || NOW();\nEND JOB\n</code></pre>"},{"location":"notebooks/scheduled-jobs/#4-jobs-with-timezone-support","title":"4. Jobs with Timezone Support","text":"<p>You can specify a timezone for your schedule. This is important for jobs that need to run at specific local times:</p> <pre><code>-- Run at 9 AM New York time on weekdays\nCREATE JOB morning_briefing\nSCHEDULE '0 9 * * 1-5'\nTIMEZONE 'America/New_York'\nDESCRIPTION 'Daily morning briefing'\nAS BEGIN\n    PRINT 'Good morning! Starting daily briefing...';\nEND JOB\n</code></pre>"},{"location":"notebooks/scheduled-jobs/#5-managing-jobs","title":"5. Managing Jobs","text":""},{"location":"notebooks/scheduled-jobs/#disable-a-job","title":"Disable a Job","text":"<p>Temporarily stop a job from running:</p> <pre><code>ALTER JOB hello_job DISABLE\n</code></pre>"},{"location":"notebooks/scheduled-jobs/#enable-a-job","title":"Enable a Job","text":"<pre><code>ALTER JOB hello_job ENABLE\n</code></pre>"},{"location":"notebooks/scheduled-jobs/#change-job-schedule","title":"Change Job Schedule","text":"<pre><code>ALTER JOB hello_job SCHEDULE '*/2 * * * *'\n</code></pre>"},{"location":"notebooks/scheduled-jobs/#6-viewing-job-history","title":"6. Viewing Job History","text":"<p>See the execution history of a job:</p> <pre><code>SHOW JOB RUNS FOR hello_job\n</code></pre>"},{"location":"notebooks/scheduled-jobs/#7-cleanup","title":"7. Cleanup","text":"<p>Delete jobs when no longer needed:</p> <pre><code>DROP JOB hello_job\n</code></pre>"},{"location":"notebooks/scheduled-jobs/#summary","title":"Summary","text":"Statement Description <code>CREATE JOB</code> Define a new scheduled job with a cron schedule <code>SHOW JOBS</code> List all jobs or view specific job details <code>ALTER JOB</code> Enable, disable, or change schedule <code>SHOW JOB RUNS</code> View execution history <code>DROP JOB</code> Delete a job"},{"location":"notebooks/scheduled-jobs/#key-features","title":"Key Features","text":"<ul> <li>Cron expressions: Full cron syntax with aliases</li> <li>Timezone support: Run jobs at specific local times</li> <li>Complex logic: Full EScript support in job body</li> <li>Execution tracking: Monitor job runs and status</li> </ul> <p>View the interactive notebook \u2192</p>"}]}